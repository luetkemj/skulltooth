var Eb=Object.defineProperty;var Ab=(i,t,e)=>t in i?Eb(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var le=(i,t,e)=>(Ab(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();var Ui=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sb(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ie={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(i,t){(function(){var e,n="4.17.21",r=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",l="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",g=1,m=2,_=4,x=1,T=2,y=1,E=2,S=4,A=8,I=16,D=32,N=64,L=128,F=256,V=512,J=30,$="...",Q=800,X=16,G=1,dt=2,_t=3,j=1/0,vt=9007199254740991,kt=17976931348623157e292,H=0/0,it=4294967295,yt=it-1,Ct=it>>>1,Rt=[["ary",L],["bind",y],["bindKey",E],["curry",A],["curryRight",I],["flip",V],["partial",D],["partialRight",N],["rearg",F]],Ft="[object Arguments]",Lt="[object Array]",Jt="[object AsyncFunction]",$t="[object Boolean]",Qt="[object Date]",ie="[object DOMException]",Pt="[object Error]",Ot="[object Function]",Vt="[object GeneratorFunction]",Yt="[object Map]",pe="[object Number]",fn="[object Null]",gi="[object Object]",su="[object Promise]",Hg="[object Proxy]",wr="[object RegExp]",Ze="[object Set]",Tr="[object String]",cs="[object Symbol]",Xg="[object Undefined]",Er="[object WeakMap]",zg="[object WeakSet]",Ar="[object ArrayBuffer]",Nn="[object DataView]",aa="[object Float32Array]",ha="[object Float64Array]",la="[object Int8Array]",ua="[object Int16Array]",ca="[object Int32Array]",fa="[object Uint8Array]",da="[object Uint8ClampedArray]",pa="[object Uint16Array]",ga="[object Uint32Array]",$g=/\b__p \+= '';/g,Vg=/\b(__p \+=) '' \+/g,Yg=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ou=/&(?:amp|lt|gt|quot|#39);/g,au=/[&<>"']/g,jg=RegExp(ou.source),qg=RegExp(au.source),Kg=/<%-([\s\S]+?)%>/g,Zg=/<%([\s\S]+?)%>/g,hu=/<%=([\s\S]+?)%>/g,Jg=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qg=/^\w*$/,tm=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ma=/[\\^$.*+?()[\]{}|]/g,em=RegExp(ma.source),_a=/^\s+/,im=/\s/,nm=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,rm=/\{\n\/\* \[wrapped with (.+)\] \*/,sm=/,? & /,om=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,am=/[()=,{}\[\]\/\s]/,hm=/\\(\\)?/g,lm=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,lu=/\w*$/,um=/^[-+]0x[0-9a-f]+$/i,cm=/^0b[01]+$/i,fm=/^\[object .+?Constructor\]$/,dm=/^0o[0-7]+$/i,pm=/^(?:0|[1-9]\d*)$/,gm=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fs=/($^)/,mm=/['\n\r\u2028\u2029\\]/g,ds="\\ud800-\\udfff",_m="\\u0300-\\u036f",vm="\\ufe20-\\ufe2f",xm="\\u20d0-\\u20ff",uu=_m+vm+xm,cu="\\u2700-\\u27bf",fu="a-z\\xdf-\\xf6\\xf8-\\xff",ym="\\xac\\xb1\\xd7\\xf7",bm="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",wm="\\u2000-\\u206f",Tm=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",du="A-Z\\xc0-\\xd6\\xd8-\\xde",pu="\\ufe0e\\ufe0f",gu=ym+bm+wm+Tm,va="['’]",Em="["+ds+"]",mu="["+gu+"]",ps="["+uu+"]",_u="\\d+",Am="["+cu+"]",vu="["+fu+"]",xu="[^"+ds+gu+_u+cu+fu+du+"]",xa="\\ud83c[\\udffb-\\udfff]",Sm="(?:"+ps+"|"+xa+")",yu="[^"+ds+"]",ya="(?:\\ud83c[\\udde6-\\uddff]){2}",ba="[\\ud800-\\udbff][\\udc00-\\udfff]",kn="["+du+"]",bu="\\u200d",wu="(?:"+vu+"|"+xu+")",Cm="(?:"+kn+"|"+xu+")",Tu="(?:"+va+"(?:d|ll|m|re|s|t|ve))?",Eu="(?:"+va+"(?:D|LL|M|RE|S|T|VE))?",Au=Sm+"?",Su="["+pu+"]?",Im="(?:"+bu+"(?:"+[yu,ya,ba].join("|")+")"+Su+Au+")*",Rm="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Pm="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Cu=Su+Au+Im,Mm="(?:"+[Am,ya,ba].join("|")+")"+Cu,Dm="(?:"+[yu+ps+"?",ps,ya,ba,Em].join("|")+")",Bm=RegExp(va,"g"),Fm=RegExp(ps,"g"),wa=RegExp(xa+"(?="+xa+")|"+Dm+Cu,"g"),Lm=RegExp([kn+"?"+vu+"+"+Tu+"(?="+[mu,kn,"$"].join("|")+")",Cm+"+"+Eu+"(?="+[mu,kn+wu,"$"].join("|")+")",kn+"?"+wu+"+"+Tu,kn+"+"+Eu,Pm,Rm,_u,Mm].join("|"),"g"),Om=RegExp("["+bu+ds+uu+pu+"]"),Nm=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,km=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Um=-1,Nt={};Nt[aa]=Nt[ha]=Nt[la]=Nt[ua]=Nt[ca]=Nt[fa]=Nt[da]=Nt[pa]=Nt[ga]=!0,Nt[Ft]=Nt[Lt]=Nt[Ar]=Nt[$t]=Nt[Nn]=Nt[Qt]=Nt[Pt]=Nt[Ot]=Nt[Yt]=Nt[pe]=Nt[gi]=Nt[wr]=Nt[Ze]=Nt[Tr]=Nt[Er]=!1;var Bt={};Bt[Ft]=Bt[Lt]=Bt[Ar]=Bt[Nn]=Bt[$t]=Bt[Qt]=Bt[aa]=Bt[ha]=Bt[la]=Bt[ua]=Bt[ca]=Bt[Yt]=Bt[pe]=Bt[gi]=Bt[wr]=Bt[Ze]=Bt[Tr]=Bt[cs]=Bt[fa]=Bt[da]=Bt[pa]=Bt[ga]=!0,Bt[Pt]=Bt[Ot]=Bt[Er]=!1;var Gm={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Wm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Hm={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Xm={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},zm=parseFloat,$m=parseInt,Iu=typeof Ui=="object"&&Ui&&Ui.Object===Object&&Ui,Vm=typeof self=="object"&&self&&self.Object===Object&&self,ae=Iu||Vm||Function("return this")(),Ta=t&&!t.nodeType&&t,dn=Ta&&!0&&i&&!i.nodeType&&i,Ru=dn&&dn.exports===Ta,Ea=Ru&&Iu.process,Ge=function(){try{var P=dn&&dn.require&&dn.require("util").types;return P||Ea&&Ea.binding&&Ea.binding("util")}catch{}}(),Pu=Ge&&Ge.isArrayBuffer,Mu=Ge&&Ge.isDate,Du=Ge&&Ge.isMap,Bu=Ge&&Ge.isRegExp,Fu=Ge&&Ge.isSet,Lu=Ge&&Ge.isTypedArray;function Re(P,O,B){switch(B.length){case 0:return P.call(O);case 1:return P.call(O,B[0]);case 2:return P.call(O,B[0],B[1]);case 3:return P.call(O,B[0],B[1],B[2])}return P.apply(O,B)}function Ym(P,O,B,Z){for(var ut=-1,St=P==null?0:P.length;++ut<St;){var ne=P[ut];O(Z,ne,B(ne),P)}return Z}function We(P,O){for(var B=-1,Z=P==null?0:P.length;++B<Z&&O(P[B],B,P)!==!1;);return P}function jm(P,O){for(var B=P==null?0:P.length;B--&&O(P[B],B,P)!==!1;);return P}function Ou(P,O){for(var B=-1,Z=P==null?0:P.length;++B<Z;)if(!O(P[B],B,P))return!1;return!0}function Yi(P,O){for(var B=-1,Z=P==null?0:P.length,ut=0,St=[];++B<Z;){var ne=P[B];O(ne,B,P)&&(St[ut++]=ne)}return St}function gs(P,O){var B=P==null?0:P.length;return!!B&&Un(P,O,0)>-1}function Aa(P,O,B){for(var Z=-1,ut=P==null?0:P.length;++Z<ut;)if(B(O,P[Z]))return!0;return!1}function Ut(P,O){for(var B=-1,Z=P==null?0:P.length,ut=Array(Z);++B<Z;)ut[B]=O(P[B],B,P);return ut}function ji(P,O){for(var B=-1,Z=O.length,ut=P.length;++B<Z;)P[ut+B]=O[B];return P}function Sa(P,O,B,Z){var ut=-1,St=P==null?0:P.length;for(Z&&St&&(B=P[++ut]);++ut<St;)B=O(B,P[ut],ut,P);return B}function qm(P,O,B,Z){var ut=P==null?0:P.length;for(Z&&ut&&(B=P[--ut]);ut--;)B=O(B,P[ut],ut,P);return B}function Ca(P,O){for(var B=-1,Z=P==null?0:P.length;++B<Z;)if(O(P[B],B,P))return!0;return!1}var Km=Ia("length");function Zm(P){return P.split("")}function Jm(P){return P.match(om)||[]}function Nu(P,O,B){var Z;return B(P,function(ut,St,ne){if(O(ut,St,ne))return Z=St,!1}),Z}function ms(P,O,B,Z){for(var ut=P.length,St=B+(Z?1:-1);Z?St--:++St<ut;)if(O(P[St],St,P))return St;return-1}function Un(P,O,B){return O===O?u_(P,O,B):ms(P,ku,B)}function Qm(P,O,B,Z){for(var ut=B-1,St=P.length;++ut<St;)if(Z(P[ut],O))return ut;return-1}function ku(P){return P!==P}function Uu(P,O){var B=P==null?0:P.length;return B?Pa(P,O)/B:H}function Ia(P){return function(O){return O==null?e:O[P]}}function Ra(P){return function(O){return P==null?e:P[O]}}function Gu(P,O,B,Z,ut){return ut(P,function(St,ne,Dt){B=Z?(Z=!1,St):O(B,St,ne,Dt)}),B}function t_(P,O){var B=P.length;for(P.sort(O);B--;)P[B]=P[B].value;return P}function Pa(P,O){for(var B,Z=-1,ut=P.length;++Z<ut;){var St=O(P[Z]);St!==e&&(B=B===e?St:B+St)}return B}function Ma(P,O){for(var B=-1,Z=Array(P);++B<P;)Z[B]=O(B);return Z}function e_(P,O){return Ut(O,function(B){return[B,P[B]]})}function Wu(P){return P&&P.slice(0,$u(P)+1).replace(_a,"")}function Pe(P){return function(O){return P(O)}}function Da(P,O){return Ut(O,function(B){return P[B]})}function Sr(P,O){return P.has(O)}function Hu(P,O){for(var B=-1,Z=P.length;++B<Z&&Un(O,P[B],0)>-1;);return B}function Xu(P,O){for(var B=P.length;B--&&Un(O,P[B],0)>-1;);return B}function i_(P,O){for(var B=P.length,Z=0;B--;)P[B]===O&&++Z;return Z}var n_=Ra(Gm),r_=Ra(Wm);function s_(P){return"\\"+Xm[P]}function o_(P,O){return P==null?e:P[O]}function Gn(P){return Om.test(P)}function a_(P){return Nm.test(P)}function h_(P){for(var O,B=[];!(O=P.next()).done;)B.push(O.value);return B}function Ba(P){var O=-1,B=Array(P.size);return P.forEach(function(Z,ut){B[++O]=[ut,Z]}),B}function zu(P,O){return function(B){return P(O(B))}}function qi(P,O){for(var B=-1,Z=P.length,ut=0,St=[];++B<Z;){var ne=P[B];(ne===O||ne===d)&&(P[B]=d,St[ut++]=B)}return St}function _s(P){var O=-1,B=Array(P.size);return P.forEach(function(Z){B[++O]=Z}),B}function l_(P){var O=-1,B=Array(P.size);return P.forEach(function(Z){B[++O]=[Z,Z]}),B}function u_(P,O,B){for(var Z=B-1,ut=P.length;++Z<ut;)if(P[Z]===O)return Z;return-1}function c_(P,O,B){for(var Z=B+1;Z--;)if(P[Z]===O)return Z;return Z}function Wn(P){return Gn(P)?d_(P):Km(P)}function Je(P){return Gn(P)?p_(P):Zm(P)}function $u(P){for(var O=P.length;O--&&im.test(P.charAt(O)););return O}var f_=Ra(Hm);function d_(P){for(var O=wa.lastIndex=0;wa.test(P);)++O;return O}function p_(P){return P.match(wa)||[]}function g_(P){return P.match(Lm)||[]}var m_=function P(O){O=O==null?ae:Hn.defaults(ae.Object(),O,Hn.pick(ae,km));var B=O.Array,Z=O.Date,ut=O.Error,St=O.Function,ne=O.Math,Dt=O.Object,Fa=O.RegExp,__=O.String,He=O.TypeError,vs=B.prototype,v_=St.prototype,Xn=Dt.prototype,xs=O["__core-js_shared__"],ys=v_.toString,Mt=Xn.hasOwnProperty,x_=0,Vu=function(){var s=/[^.]+$/.exec(xs&&xs.keys&&xs.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),bs=Xn.toString,y_=ys.call(Dt),b_=ae._,w_=Fa("^"+ys.call(Mt).replace(ma,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ws=Ru?O.Buffer:e,Ki=O.Symbol,Ts=O.Uint8Array,Yu=ws?ws.allocUnsafe:e,Es=zu(Dt.getPrototypeOf,Dt),ju=Dt.create,qu=Xn.propertyIsEnumerable,As=vs.splice,Ku=Ki?Ki.isConcatSpreadable:e,Cr=Ki?Ki.iterator:e,pn=Ki?Ki.toStringTag:e,Ss=function(){try{var s=xn(Dt,"defineProperty");return s({},"",{}),s}catch{}}(),T_=O.clearTimeout!==ae.clearTimeout&&O.clearTimeout,E_=Z&&Z.now!==ae.Date.now&&Z.now,A_=O.setTimeout!==ae.setTimeout&&O.setTimeout,Cs=ne.ceil,Is=ne.floor,La=Dt.getOwnPropertySymbols,S_=ws?ws.isBuffer:e,Zu=O.isFinite,C_=vs.join,I_=zu(Dt.keys,Dt),re=ne.max,ge=ne.min,R_=Z.now,P_=O.parseInt,Ju=ne.random,M_=vs.reverse,Oa=xn(O,"DataView"),Ir=xn(O,"Map"),Na=xn(O,"Promise"),zn=xn(O,"Set"),Rr=xn(O,"WeakMap"),Pr=xn(Dt,"create"),Rs=Rr&&new Rr,$n={},D_=yn(Oa),B_=yn(Ir),F_=yn(Na),L_=yn(zn),O_=yn(Rr),Ps=Ki?Ki.prototype:e,Mr=Ps?Ps.valueOf:e,Qu=Ps?Ps.toString:e;function b(s){if(jt(s)&&!ct(s)&&!(s instanceof bt)){if(s instanceof Xe)return s;if(Mt.call(s,"__wrapped__"))return tf(s)}return new Xe(s)}var Vn=function(){function s(){}return function(a){if(!Wt(a))return{};if(ju)return ju(a);s.prototype=a;var u=new s;return s.prototype=e,u}}();function Ms(){}function Xe(s,a){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!a,this.__index__=0,this.__values__=e}b.templateSettings={escape:Kg,evaluate:Zg,interpolate:hu,variable:"",imports:{_:b}},b.prototype=Ms.prototype,b.prototype.constructor=b,Xe.prototype=Vn(Ms.prototype),Xe.prototype.constructor=Xe;function bt(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=it,this.__views__=[]}function N_(){var s=new bt(this.__wrapped__);return s.__actions__=we(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=we(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=we(this.__views__),s}function k_(){if(this.__filtered__){var s=new bt(this);s.__dir__=-1,s.__filtered__=!0}else s=this.clone(),s.__dir__*=-1;return s}function U_(){var s=this.__wrapped__.value(),a=this.__dir__,u=ct(s),p=a<0,v=u?s.length:0,w=Z0(0,v,this.__views__),C=w.start,R=w.end,M=R-C,k=p?R:C-1,U=this.__iteratees__,W=U.length,Y=0,tt=ge(M,this.__takeCount__);if(!u||!p&&v==M&&tt==M)return Tc(s,this.__actions__);var at=[];t:for(;M--&&Y<tt;){k+=a;for(var gt=-1,ht=s[k];++gt<W;){var xt=U[gt],Tt=xt.iteratee,Be=xt.type,ye=Tt(ht);if(Be==dt)ht=ye;else if(!ye){if(Be==G)continue t;break t}}at[Y++]=ht}return at}bt.prototype=Vn(Ms.prototype),bt.prototype.constructor=bt;function gn(s){var a=-1,u=s==null?0:s.length;for(this.clear();++a<u;){var p=s[a];this.set(p[0],p[1])}}function G_(){this.__data__=Pr?Pr(null):{},this.size=0}function W_(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function H_(s){var a=this.__data__;if(Pr){var u=a[s];return u===c?e:u}return Mt.call(a,s)?a[s]:e}function X_(s){var a=this.__data__;return Pr?a[s]!==e:Mt.call(a,s)}function z_(s,a){var u=this.__data__;return this.size+=this.has(s)?0:1,u[s]=Pr&&a===e?c:a,this}gn.prototype.clear=G_,gn.prototype.delete=W_,gn.prototype.get=H_,gn.prototype.has=X_,gn.prototype.set=z_;function Ii(s){var a=-1,u=s==null?0:s.length;for(this.clear();++a<u;){var p=s[a];this.set(p[0],p[1])}}function $_(){this.__data__=[],this.size=0}function V_(s){var a=this.__data__,u=Ds(a,s);if(u<0)return!1;var p=a.length-1;return u==p?a.pop():As.call(a,u,1),--this.size,!0}function Y_(s){var a=this.__data__,u=Ds(a,s);return u<0?e:a[u][1]}function j_(s){return Ds(this.__data__,s)>-1}function q_(s,a){var u=this.__data__,p=Ds(u,s);return p<0?(++this.size,u.push([s,a])):u[p][1]=a,this}Ii.prototype.clear=$_,Ii.prototype.delete=V_,Ii.prototype.get=Y_,Ii.prototype.has=j_,Ii.prototype.set=q_;function Ri(s){var a=-1,u=s==null?0:s.length;for(this.clear();++a<u;){var p=s[a];this.set(p[0],p[1])}}function K_(){this.size=0,this.__data__={hash:new gn,map:new(Ir||Ii),string:new gn}}function Z_(s){var a=zs(this,s).delete(s);return this.size-=a?1:0,a}function J_(s){return zs(this,s).get(s)}function Q_(s){return zs(this,s).has(s)}function t0(s,a){var u=zs(this,s),p=u.size;return u.set(s,a),this.size+=u.size==p?0:1,this}Ri.prototype.clear=K_,Ri.prototype.delete=Z_,Ri.prototype.get=J_,Ri.prototype.has=Q_,Ri.prototype.set=t0;function mn(s){var a=-1,u=s==null?0:s.length;for(this.__data__=new Ri;++a<u;)this.add(s[a])}function e0(s){return this.__data__.set(s,c),this}function i0(s){return this.__data__.has(s)}mn.prototype.add=mn.prototype.push=e0,mn.prototype.has=i0;function Qe(s){var a=this.__data__=new Ii(s);this.size=a.size}function n0(){this.__data__=new Ii,this.size=0}function r0(s){var a=this.__data__,u=a.delete(s);return this.size=a.size,u}function s0(s){return this.__data__.get(s)}function o0(s){return this.__data__.has(s)}function a0(s,a){var u=this.__data__;if(u instanceof Ii){var p=u.__data__;if(!Ir||p.length<r-1)return p.push([s,a]),this.size=++u.size,this;u=this.__data__=new Ri(p)}return u.set(s,a),this.size=u.size,this}Qe.prototype.clear=n0,Qe.prototype.delete=r0,Qe.prototype.get=s0,Qe.prototype.has=o0,Qe.prototype.set=a0;function tc(s,a){var u=ct(s),p=!u&&bn(s),v=!u&&!p&&en(s),w=!u&&!p&&!v&&Kn(s),C=u||p||v||w,R=C?Ma(s.length,__):[],M=R.length;for(var k in s)(a||Mt.call(s,k))&&!(C&&(k=="length"||v&&(k=="offset"||k=="parent")||w&&(k=="buffer"||k=="byteLength"||k=="byteOffset")||Bi(k,M)))&&R.push(k);return R}function ec(s){var a=s.length;return a?s[ja(0,a-1)]:e}function h0(s,a){return $s(we(s),_n(a,0,s.length))}function l0(s){return $s(we(s))}function ka(s,a,u){(u!==e&&!ti(s[a],u)||u===e&&!(a in s))&&Pi(s,a,u)}function Dr(s,a,u){var p=s[a];(!(Mt.call(s,a)&&ti(p,u))||u===e&&!(a in s))&&Pi(s,a,u)}function Ds(s,a){for(var u=s.length;u--;)if(ti(s[u][0],a))return u;return-1}function u0(s,a,u,p){return Zi(s,function(v,w,C){a(p,v,u(v),C)}),p}function ic(s,a){return s&&_i(a,oe(a),s)}function c0(s,a){return s&&_i(a,Ee(a),s)}function Pi(s,a,u){a=="__proto__"&&Ss?Ss(s,a,{configurable:!0,enumerable:!0,value:u,writable:!0}):s[a]=u}function Ua(s,a){for(var u=-1,p=a.length,v=B(p),w=s==null;++u<p;)v[u]=w?e:xh(s,a[u]);return v}function _n(s,a,u){return s===s&&(u!==e&&(s=s<=u?s:u),a!==e&&(s=s>=a?s:a)),s}function ze(s,a,u,p,v,w){var C,R=a&g,M=a&m,k=a&_;if(u&&(C=v?u(s,p,v,w):u(s)),C!==e)return C;if(!Wt(s))return s;var U=ct(s);if(U){if(C=Q0(s),!R)return we(s,C)}else{var W=me(s),Y=W==Ot||W==Vt;if(en(s))return Sc(s,R);if(W==gi||W==Ft||Y&&!v){if(C=M||Y?{}:$c(s),!R)return M?H0(s,c0(C,s)):W0(s,ic(C,s))}else{if(!Bt[W])return v?s:{};C=tv(s,W,R)}}w||(w=new Qe);var tt=w.get(s);if(tt)return tt;w.set(s,C),bf(s)?s.forEach(function(ht){C.add(ze(ht,a,u,ht,s,w))}):xf(s)&&s.forEach(function(ht,xt){C.set(xt,ze(ht,a,u,xt,s,w))});var at=k?M?sh:rh:M?Ee:oe,gt=U?e:at(s);return We(gt||s,function(ht,xt){gt&&(xt=ht,ht=s[xt]),Dr(C,xt,ze(ht,a,u,xt,s,w))}),C}function f0(s){var a=oe(s);return function(u){return nc(u,s,a)}}function nc(s,a,u){var p=u.length;if(s==null)return!p;for(s=Dt(s);p--;){var v=u[p],w=a[v],C=s[v];if(C===e&&!(v in s)||!w(C))return!1}return!0}function rc(s,a,u){if(typeof s!="function")throw new He(h);return Ur(function(){s.apply(e,u)},a)}function Br(s,a,u,p){var v=-1,w=gs,C=!0,R=s.length,M=[],k=a.length;if(!R)return M;u&&(a=Ut(a,Pe(u))),p?(w=Aa,C=!1):a.length>=r&&(w=Sr,C=!1,a=new mn(a));t:for(;++v<R;){var U=s[v],W=u==null?U:u(U);if(U=p||U!==0?U:0,C&&W===W){for(var Y=k;Y--;)if(a[Y]===W)continue t;M.push(U)}else w(a,W,p)||M.push(U)}return M}var Zi=Mc(mi),sc=Mc(Wa,!0);function d0(s,a){var u=!0;return Zi(s,function(p,v,w){return u=!!a(p,v,w),u}),u}function Bs(s,a,u){for(var p=-1,v=s.length;++p<v;){var w=s[p],C=a(w);if(C!=null&&(R===e?C===C&&!De(C):u(C,R)))var R=C,M=w}return M}function p0(s,a,u,p){var v=s.length;for(u=pt(u),u<0&&(u=-u>v?0:v+u),p=p===e||p>v?v:pt(p),p<0&&(p+=v),p=u>p?0:Tf(p);u<p;)s[u++]=a;return s}function oc(s,a){var u=[];return Zi(s,function(p,v,w){a(p,v,w)&&u.push(p)}),u}function he(s,a,u,p,v){var w=-1,C=s.length;for(u||(u=iv),v||(v=[]);++w<C;){var R=s[w];a>0&&u(R)?a>1?he(R,a-1,u,p,v):ji(v,R):p||(v[v.length]=R)}return v}var Ga=Dc(),ac=Dc(!0);function mi(s,a){return s&&Ga(s,a,oe)}function Wa(s,a){return s&&ac(s,a,oe)}function Fs(s,a){return Yi(a,function(u){return Fi(s[u])})}function vn(s,a){a=Qi(a,s);for(var u=0,p=a.length;s!=null&&u<p;)s=s[vi(a[u++])];return u&&u==p?s:e}function hc(s,a,u){var p=a(s);return ct(s)?p:ji(p,u(s))}function ve(s){return s==null?s===e?Xg:fn:pn&&pn in Dt(s)?K0(s):lv(s)}function Ha(s,a){return s>a}function g0(s,a){return s!=null&&Mt.call(s,a)}function m0(s,a){return s!=null&&a in Dt(s)}function _0(s,a,u){return s>=ge(a,u)&&s<re(a,u)}function Xa(s,a,u){for(var p=u?Aa:gs,v=s[0].length,w=s.length,C=w,R=B(w),M=1/0,k=[];C--;){var U=s[C];C&&a&&(U=Ut(U,Pe(a))),M=ge(U.length,M),R[C]=!u&&(a||v>=120&&U.length>=120)?new mn(C&&U):e}U=s[0];var W=-1,Y=R[0];t:for(;++W<v&&k.length<M;){var tt=U[W],at=a?a(tt):tt;if(tt=u||tt!==0?tt:0,!(Y?Sr(Y,at):p(k,at,u))){for(C=w;--C;){var gt=R[C];if(!(gt?Sr(gt,at):p(s[C],at,u)))continue t}Y&&Y.push(at),k.push(tt)}}return k}function v0(s,a,u,p){return mi(s,function(v,w,C){a(p,u(v),w,C)}),p}function Fr(s,a,u){a=Qi(a,s),s=qc(s,a);var p=s==null?s:s[vi(Ve(a))];return p==null?e:Re(p,s,u)}function lc(s){return jt(s)&&ve(s)==Ft}function x0(s){return jt(s)&&ve(s)==Ar}function y0(s){return jt(s)&&ve(s)==Qt}function Lr(s,a,u,p,v){return s===a?!0:s==null||a==null||!jt(s)&&!jt(a)?s!==s&&a!==a:b0(s,a,u,p,Lr,v)}function b0(s,a,u,p,v,w){var C=ct(s),R=ct(a),M=C?Lt:me(s),k=R?Lt:me(a);M=M==Ft?gi:M,k=k==Ft?gi:k;var U=M==gi,W=k==gi,Y=M==k;if(Y&&en(s)){if(!en(a))return!1;C=!0,U=!1}if(Y&&!U)return w||(w=new Qe),C||Kn(s)?Hc(s,a,u,p,v,w):j0(s,a,M,u,p,v,w);if(!(u&x)){var tt=U&&Mt.call(s,"__wrapped__"),at=W&&Mt.call(a,"__wrapped__");if(tt||at){var gt=tt?s.value():s,ht=at?a.value():a;return w||(w=new Qe),v(gt,ht,u,p,w)}}return Y?(w||(w=new Qe),q0(s,a,u,p,v,w)):!1}function w0(s){return jt(s)&&me(s)==Yt}function za(s,a,u,p){var v=u.length,w=v,C=!p;if(s==null)return!w;for(s=Dt(s);v--;){var R=u[v];if(C&&R[2]?R[1]!==s[R[0]]:!(R[0]in s))return!1}for(;++v<w;){R=u[v];var M=R[0],k=s[M],U=R[1];if(C&&R[2]){if(k===e&&!(M in s))return!1}else{var W=new Qe;if(p)var Y=p(k,U,M,s,a,W);if(!(Y===e?Lr(U,k,x|T,p,W):Y))return!1}}return!0}function uc(s){if(!Wt(s)||rv(s))return!1;var a=Fi(s)?w_:fm;return a.test(yn(s))}function T0(s){return jt(s)&&ve(s)==wr}function E0(s){return jt(s)&&me(s)==Ze}function A0(s){return jt(s)&&Zs(s.length)&&!!Nt[ve(s)]}function cc(s){return typeof s=="function"?s:s==null?Ae:typeof s=="object"?ct(s)?pc(s[0],s[1]):dc(s):Ff(s)}function $a(s){if(!kr(s))return I_(s);var a=[];for(var u in Dt(s))Mt.call(s,u)&&u!="constructor"&&a.push(u);return a}function S0(s){if(!Wt(s))return hv(s);var a=kr(s),u=[];for(var p in s)p=="constructor"&&(a||!Mt.call(s,p))||u.push(p);return u}function Va(s,a){return s<a}function fc(s,a){var u=-1,p=Te(s)?B(s.length):[];return Zi(s,function(v,w,C){p[++u]=a(v,w,C)}),p}function dc(s){var a=ah(s);return a.length==1&&a[0][2]?Yc(a[0][0],a[0][1]):function(u){return u===s||za(u,s,a)}}function pc(s,a){return lh(s)&&Vc(a)?Yc(vi(s),a):function(u){var p=xh(u,s);return p===e&&p===a?yh(u,s):Lr(a,p,x|T)}}function Ls(s,a,u,p,v){s!==a&&Ga(a,function(w,C){if(v||(v=new Qe),Wt(w))C0(s,a,C,u,Ls,p,v);else{var R=p?p(ch(s,C),w,C+"",s,a,v):e;R===e&&(R=w),ka(s,C,R)}},Ee)}function C0(s,a,u,p,v,w,C){var R=ch(s,u),M=ch(a,u),k=C.get(M);if(k){ka(s,u,k);return}var U=w?w(R,M,u+"",s,a,C):e,W=U===e;if(W){var Y=ct(M),tt=!Y&&en(M),at=!Y&&!tt&&Kn(M);U=M,Y||tt||at?ct(R)?U=R:qt(R)?U=we(R):tt?(W=!1,U=Sc(M,!0)):at?(W=!1,U=Cc(M,!0)):U=[]:Gr(M)||bn(M)?(U=R,bn(R)?U=Ef(R):(!Wt(R)||Fi(R))&&(U=$c(M))):W=!1}W&&(C.set(M,U),v(U,M,p,w,C),C.delete(M)),ka(s,u,U)}function gc(s,a){var u=s.length;if(u)return a+=a<0?u:0,Bi(a,u)?s[a]:e}function mc(s,a,u){a.length?a=Ut(a,function(w){return ct(w)?function(C){return vn(C,w.length===1?w[0]:w)}:w}):a=[Ae];var p=-1;a=Ut(a,Pe(ot()));var v=fc(s,function(w,C,R){var M=Ut(a,function(k){return k(w)});return{criteria:M,index:++p,value:w}});return t_(v,function(w,C){return G0(w,C,u)})}function I0(s,a){return _c(s,a,function(u,p){return yh(s,p)})}function _c(s,a,u){for(var p=-1,v=a.length,w={};++p<v;){var C=a[p],R=vn(s,C);u(R,C)&&Or(w,Qi(C,s),R)}return w}function R0(s){return function(a){return vn(a,s)}}function Ya(s,a,u,p){var v=p?Qm:Un,w=-1,C=a.length,R=s;for(s===a&&(a=we(a)),u&&(R=Ut(s,Pe(u)));++w<C;)for(var M=0,k=a[w],U=u?u(k):k;(M=v(R,U,M,p))>-1;)R!==s&&As.call(R,M,1),As.call(s,M,1);return s}function vc(s,a){for(var u=s?a.length:0,p=u-1;u--;){var v=a[u];if(u==p||v!==w){var w=v;Bi(v)?As.call(s,v,1):Za(s,v)}}return s}function ja(s,a){return s+Is(Ju()*(a-s+1))}function P0(s,a,u,p){for(var v=-1,w=re(Cs((a-s)/(u||1)),0),C=B(w);w--;)C[p?w:++v]=s,s+=u;return C}function qa(s,a){var u="";if(!s||a<1||a>vt)return u;do a%2&&(u+=s),a=Is(a/2),a&&(s+=s);while(a);return u}function mt(s,a){return fh(jc(s,a,Ae),s+"")}function M0(s){return ec(Zn(s))}function D0(s,a){var u=Zn(s);return $s(u,_n(a,0,u.length))}function Or(s,a,u,p){if(!Wt(s))return s;a=Qi(a,s);for(var v=-1,w=a.length,C=w-1,R=s;R!=null&&++v<w;){var M=vi(a[v]),k=u;if(M==="__proto__"||M==="constructor"||M==="prototype")return s;if(v!=C){var U=R[M];k=p?p(U,M,R):e,k===e&&(k=Wt(U)?U:Bi(a[v+1])?[]:{})}Dr(R,M,k),R=R[M]}return s}var xc=Rs?function(s,a){return Rs.set(s,a),s}:Ae,B0=Ss?function(s,a){return Ss(s,"toString",{configurable:!0,enumerable:!1,value:wh(a),writable:!0})}:Ae;function F0(s){return $s(Zn(s))}function $e(s,a,u){var p=-1,v=s.length;a<0&&(a=-a>v?0:v+a),u=u>v?v:u,u<0&&(u+=v),v=a>u?0:u-a>>>0,a>>>=0;for(var w=B(v);++p<v;)w[p]=s[p+a];return w}function L0(s,a){var u;return Zi(s,function(p,v,w){return u=a(p,v,w),!u}),!!u}function Os(s,a,u){var p=0,v=s==null?p:s.length;if(typeof a=="number"&&a===a&&v<=Ct){for(;p<v;){var w=p+v>>>1,C=s[w];C!==null&&!De(C)&&(u?C<=a:C<a)?p=w+1:v=w}return v}return Ka(s,a,Ae,u)}function Ka(s,a,u,p){var v=0,w=s==null?0:s.length;if(w===0)return 0;a=u(a);for(var C=a!==a,R=a===null,M=De(a),k=a===e;v<w;){var U=Is((v+w)/2),W=u(s[U]),Y=W!==e,tt=W===null,at=W===W,gt=De(W);if(C)var ht=p||at;else k?ht=at&&(p||Y):R?ht=at&&Y&&(p||!tt):M?ht=at&&Y&&!tt&&(p||!gt):tt||gt?ht=!1:ht=p?W<=a:W<a;ht?v=U+1:w=U}return ge(w,yt)}function yc(s,a){for(var u=-1,p=s.length,v=0,w=[];++u<p;){var C=s[u],R=a?a(C):C;if(!u||!ti(R,M)){var M=R;w[v++]=C===0?0:C}}return w}function bc(s){return typeof s=="number"?s:De(s)?H:+s}function Me(s){if(typeof s=="string")return s;if(ct(s))return Ut(s,Me)+"";if(De(s))return Qu?Qu.call(s):"";var a=s+"";return a=="0"&&1/s==-j?"-0":a}function Ji(s,a,u){var p=-1,v=gs,w=s.length,C=!0,R=[],M=R;if(u)C=!1,v=Aa;else if(w>=r){var k=a?null:V0(s);if(k)return _s(k);C=!1,v=Sr,M=new mn}else M=a?[]:R;t:for(;++p<w;){var U=s[p],W=a?a(U):U;if(U=u||U!==0?U:0,C&&W===W){for(var Y=M.length;Y--;)if(M[Y]===W)continue t;a&&M.push(W),R.push(U)}else v(M,W,u)||(M!==R&&M.push(W),R.push(U))}return R}function Za(s,a){return a=Qi(a,s),s=qc(s,a),s==null||delete s[vi(Ve(a))]}function wc(s,a,u,p){return Or(s,a,u(vn(s,a)),p)}function Ns(s,a,u,p){for(var v=s.length,w=p?v:-1;(p?w--:++w<v)&&a(s[w],w,s););return u?$e(s,p?0:w,p?w+1:v):$e(s,p?w+1:0,p?v:w)}function Tc(s,a){var u=s;return u instanceof bt&&(u=u.value()),Sa(a,function(p,v){return v.func.apply(v.thisArg,ji([p],v.args))},u)}function Ja(s,a,u){var p=s.length;if(p<2)return p?Ji(s[0]):[];for(var v=-1,w=B(p);++v<p;)for(var C=s[v],R=-1;++R<p;)R!=v&&(w[v]=Br(w[v]||C,s[R],a,u));return Ji(he(w,1),a,u)}function Ec(s,a,u){for(var p=-1,v=s.length,w=a.length,C={};++p<v;){var R=p<w?a[p]:e;u(C,s[p],R)}return C}function Qa(s){return qt(s)?s:[]}function th(s){return typeof s=="function"?s:Ae}function Qi(s,a){return ct(s)?s:lh(s,a)?[s]:Qc(It(s))}var O0=mt;function tn(s,a,u){var p=s.length;return u=u===e?p:u,!a&&u>=p?s:$e(s,a,u)}var Ac=T_||function(s){return ae.clearTimeout(s)};function Sc(s,a){if(a)return s.slice();var u=s.length,p=Yu?Yu(u):new s.constructor(u);return s.copy(p),p}function eh(s){var a=new s.constructor(s.byteLength);return new Ts(a).set(new Ts(s)),a}function N0(s,a){var u=a?eh(s.buffer):s.buffer;return new s.constructor(u,s.byteOffset,s.byteLength)}function k0(s){var a=new s.constructor(s.source,lu.exec(s));return a.lastIndex=s.lastIndex,a}function U0(s){return Mr?Dt(Mr.call(s)):{}}function Cc(s,a){var u=a?eh(s.buffer):s.buffer;return new s.constructor(u,s.byteOffset,s.length)}function Ic(s,a){if(s!==a){var u=s!==e,p=s===null,v=s===s,w=De(s),C=a!==e,R=a===null,M=a===a,k=De(a);if(!R&&!k&&!w&&s>a||w&&C&&M&&!R&&!k||p&&C&&M||!u&&M||!v)return 1;if(!p&&!w&&!k&&s<a||k&&u&&v&&!p&&!w||R&&u&&v||!C&&v||!M)return-1}return 0}function G0(s,a,u){for(var p=-1,v=s.criteria,w=a.criteria,C=v.length,R=u.length;++p<C;){var M=Ic(v[p],w[p]);if(M){if(p>=R)return M;var k=u[p];return M*(k=="desc"?-1:1)}}return s.index-a.index}function Rc(s,a,u,p){for(var v=-1,w=s.length,C=u.length,R=-1,M=a.length,k=re(w-C,0),U=B(M+k),W=!p;++R<M;)U[R]=a[R];for(;++v<C;)(W||v<w)&&(U[u[v]]=s[v]);for(;k--;)U[R++]=s[v++];return U}function Pc(s,a,u,p){for(var v=-1,w=s.length,C=-1,R=u.length,M=-1,k=a.length,U=re(w-R,0),W=B(U+k),Y=!p;++v<U;)W[v]=s[v];for(var tt=v;++M<k;)W[tt+M]=a[M];for(;++C<R;)(Y||v<w)&&(W[tt+u[C]]=s[v++]);return W}function we(s,a){var u=-1,p=s.length;for(a||(a=B(p));++u<p;)a[u]=s[u];return a}function _i(s,a,u,p){var v=!u;u||(u={});for(var w=-1,C=a.length;++w<C;){var R=a[w],M=p?p(u[R],s[R],R,u,s):e;M===e&&(M=s[R]),v?Pi(u,R,M):Dr(u,R,M)}return u}function W0(s,a){return _i(s,hh(s),a)}function H0(s,a){return _i(s,Xc(s),a)}function ks(s,a){return function(u,p){var v=ct(u)?Ym:u0,w=a?a():{};return v(u,s,ot(p,2),w)}}function Yn(s){return mt(function(a,u){var p=-1,v=u.length,w=v>1?u[v-1]:e,C=v>2?u[2]:e;for(w=s.length>3&&typeof w=="function"?(v--,w):e,C&&xe(u[0],u[1],C)&&(w=v<3?e:w,v=1),a=Dt(a);++p<v;){var R=u[p];R&&s(a,R,p,w)}return a})}function Mc(s,a){return function(u,p){if(u==null)return u;if(!Te(u))return s(u,p);for(var v=u.length,w=a?v:-1,C=Dt(u);(a?w--:++w<v)&&p(C[w],w,C)!==!1;);return u}}function Dc(s){return function(a,u,p){for(var v=-1,w=Dt(a),C=p(a),R=C.length;R--;){var M=C[s?R:++v];if(u(w[M],M,w)===!1)break}return a}}function X0(s,a,u){var p=a&y,v=Nr(s);function w(){var C=this&&this!==ae&&this instanceof w?v:s;return C.apply(p?u:this,arguments)}return w}function Bc(s){return function(a){a=It(a);var u=Gn(a)?Je(a):e,p=u?u[0]:a.charAt(0),v=u?tn(u,1).join(""):a.slice(1);return p[s]()+v}}function jn(s){return function(a){return Sa(Df(Mf(a).replace(Bm,"")),s,"")}}function Nr(s){return function(){var a=arguments;switch(a.length){case 0:return new s;case 1:return new s(a[0]);case 2:return new s(a[0],a[1]);case 3:return new s(a[0],a[1],a[2]);case 4:return new s(a[0],a[1],a[2],a[3]);case 5:return new s(a[0],a[1],a[2],a[3],a[4]);case 6:return new s(a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return new s(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}var u=Vn(s.prototype),p=s.apply(u,a);return Wt(p)?p:u}}function z0(s,a,u){var p=Nr(s);function v(){for(var w=arguments.length,C=B(w),R=w,M=qn(v);R--;)C[R]=arguments[R];var k=w<3&&C[0]!==M&&C[w-1]!==M?[]:qi(C,M);if(w-=k.length,w<u)return kc(s,a,Us,v.placeholder,e,C,k,e,e,u-w);var U=this&&this!==ae&&this instanceof v?p:s;return Re(U,this,C)}return v}function Fc(s){return function(a,u,p){var v=Dt(a);if(!Te(a)){var w=ot(u,3);a=oe(a),u=function(R){return w(v[R],R,v)}}var C=s(a,u,p);return C>-1?v[w?a[C]:C]:e}}function Lc(s){return Di(function(a){var u=a.length,p=u,v=Xe.prototype.thru;for(s&&a.reverse();p--;){var w=a[p];if(typeof w!="function")throw new He(h);if(v&&!C&&Xs(w)=="wrapper")var C=new Xe([],!0)}for(p=C?p:u;++p<u;){w=a[p];var R=Xs(w),M=R=="wrapper"?oh(w):e;M&&uh(M[0])&&M[1]==(L|A|D|F)&&!M[4].length&&M[9]==1?C=C[Xs(M[0])].apply(C,M[3]):C=w.length==1&&uh(w)?C[R]():C.thru(w)}return function(){var k=arguments,U=k[0];if(C&&k.length==1&&ct(U))return C.plant(U).value();for(var W=0,Y=u?a[W].apply(this,k):U;++W<u;)Y=a[W].call(this,Y);return Y}})}function Us(s,a,u,p,v,w,C,R,M,k){var U=a&L,W=a&y,Y=a&E,tt=a&(A|I),at=a&V,gt=Y?e:Nr(s);function ht(){for(var xt=arguments.length,Tt=B(xt),Be=xt;Be--;)Tt[Be]=arguments[Be];if(tt)var ye=qn(ht),Fe=i_(Tt,ye);if(p&&(Tt=Rc(Tt,p,v,tt)),w&&(Tt=Pc(Tt,w,C,tt)),xt-=Fe,tt&&xt<k){var Kt=qi(Tt,ye);return kc(s,a,Us,ht.placeholder,u,Tt,Kt,R,M,k-xt)}var ei=W?u:this,Oi=Y?ei[s]:s;return xt=Tt.length,R?Tt=uv(Tt,R):at&&xt>1&&Tt.reverse(),U&&M<xt&&(Tt.length=M),this&&this!==ae&&this instanceof ht&&(Oi=gt||Nr(Oi)),Oi.apply(ei,Tt)}return ht}function Oc(s,a){return function(u,p){return v0(u,s,a(p),{})}}function Gs(s,a){return function(u,p){var v;if(u===e&&p===e)return a;if(u!==e&&(v=u),p!==e){if(v===e)return p;typeof u=="string"||typeof p=="string"?(u=Me(u),p=Me(p)):(u=bc(u),p=bc(p)),v=s(u,p)}return v}}function ih(s){return Di(function(a){return a=Ut(a,Pe(ot())),mt(function(u){var p=this;return s(a,function(v){return Re(v,p,u)})})})}function Ws(s,a){a=a===e?" ":Me(a);var u=a.length;if(u<2)return u?qa(a,s):a;var p=qa(a,Cs(s/Wn(a)));return Gn(a)?tn(Je(p),0,s).join(""):p.slice(0,s)}function $0(s,a,u,p){var v=a&y,w=Nr(s);function C(){for(var R=-1,M=arguments.length,k=-1,U=p.length,W=B(U+M),Y=this&&this!==ae&&this instanceof C?w:s;++k<U;)W[k]=p[k];for(;M--;)W[k++]=arguments[++R];return Re(Y,v?u:this,W)}return C}function Nc(s){return function(a,u,p){return p&&typeof p!="number"&&xe(a,u,p)&&(u=p=e),a=Li(a),u===e?(u=a,a=0):u=Li(u),p=p===e?a<u?1:-1:Li(p),P0(a,u,p,s)}}function Hs(s){return function(a,u){return typeof a=="string"&&typeof u=="string"||(a=Ye(a),u=Ye(u)),s(a,u)}}function kc(s,a,u,p,v,w,C,R,M,k){var U=a&A,W=U?C:e,Y=U?e:C,tt=U?w:e,at=U?e:w;a|=U?D:N,a&=~(U?N:D),a&S||(a&=~(y|E));var gt=[s,a,v,tt,W,at,Y,R,M,k],ht=u.apply(e,gt);return uh(s)&&Kc(ht,gt),ht.placeholder=p,Zc(ht,s,a)}function nh(s){var a=ne[s];return function(u,p){if(u=Ye(u),p=p==null?0:ge(pt(p),292),p&&Zu(u)){var v=(It(u)+"e").split("e"),w=a(v[0]+"e"+(+v[1]+p));return v=(It(w)+"e").split("e"),+(v[0]+"e"+(+v[1]-p))}return a(u)}}var V0=zn&&1/_s(new zn([,-0]))[1]==j?function(s){return new zn(s)}:Ah;function Uc(s){return function(a){var u=me(a);return u==Yt?Ba(a):u==Ze?l_(a):e_(a,s(a))}}function Mi(s,a,u,p,v,w,C,R){var M=a&E;if(!M&&typeof s!="function")throw new He(h);var k=p?p.length:0;if(k||(a&=~(D|N),p=v=e),C=C===e?C:re(pt(C),0),R=R===e?R:pt(R),k-=v?v.length:0,a&N){var U=p,W=v;p=v=e}var Y=M?e:oh(s),tt=[s,a,u,p,v,U,W,w,C,R];if(Y&&av(tt,Y),s=tt[0],a=tt[1],u=tt[2],p=tt[3],v=tt[4],R=tt[9]=tt[9]===e?M?0:s.length:re(tt[9]-k,0),!R&&a&(A|I)&&(a&=~(A|I)),!a||a==y)var at=X0(s,a,u);else a==A||a==I?at=z0(s,a,R):(a==D||a==(y|D))&&!v.length?at=$0(s,a,u,p):at=Us.apply(e,tt);var gt=Y?xc:Kc;return Zc(gt(at,tt),s,a)}function Gc(s,a,u,p){return s===e||ti(s,Xn[u])&&!Mt.call(p,u)?a:s}function Wc(s,a,u,p,v,w){return Wt(s)&&Wt(a)&&(w.set(a,s),Ls(s,a,e,Wc,w),w.delete(a)),s}function Y0(s){return Gr(s)?e:s}function Hc(s,a,u,p,v,w){var C=u&x,R=s.length,M=a.length;if(R!=M&&!(C&&M>R))return!1;var k=w.get(s),U=w.get(a);if(k&&U)return k==a&&U==s;var W=-1,Y=!0,tt=u&T?new mn:e;for(w.set(s,a),w.set(a,s);++W<R;){var at=s[W],gt=a[W];if(p)var ht=C?p(gt,at,W,a,s,w):p(at,gt,W,s,a,w);if(ht!==e){if(ht)continue;Y=!1;break}if(tt){if(!Ca(a,function(xt,Tt){if(!Sr(tt,Tt)&&(at===xt||v(at,xt,u,p,w)))return tt.push(Tt)})){Y=!1;break}}else if(!(at===gt||v(at,gt,u,p,w))){Y=!1;break}}return w.delete(s),w.delete(a),Y}function j0(s,a,u,p,v,w,C){switch(u){case Nn:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case Ar:return!(s.byteLength!=a.byteLength||!w(new Ts(s),new Ts(a)));case $t:case Qt:case pe:return ti(+s,+a);case Pt:return s.name==a.name&&s.message==a.message;case wr:case Tr:return s==a+"";case Yt:var R=Ba;case Ze:var M=p&x;if(R||(R=_s),s.size!=a.size&&!M)return!1;var k=C.get(s);if(k)return k==a;p|=T,C.set(s,a);var U=Hc(R(s),R(a),p,v,w,C);return C.delete(s),U;case cs:if(Mr)return Mr.call(s)==Mr.call(a)}return!1}function q0(s,a,u,p,v,w){var C=u&x,R=rh(s),M=R.length,k=rh(a),U=k.length;if(M!=U&&!C)return!1;for(var W=M;W--;){var Y=R[W];if(!(C?Y in a:Mt.call(a,Y)))return!1}var tt=w.get(s),at=w.get(a);if(tt&&at)return tt==a&&at==s;var gt=!0;w.set(s,a),w.set(a,s);for(var ht=C;++W<M;){Y=R[W];var xt=s[Y],Tt=a[Y];if(p)var Be=C?p(Tt,xt,Y,a,s,w):p(xt,Tt,Y,s,a,w);if(!(Be===e?xt===Tt||v(xt,Tt,u,p,w):Be)){gt=!1;break}ht||(ht=Y=="constructor")}if(gt&&!ht){var ye=s.constructor,Fe=a.constructor;ye!=Fe&&"constructor"in s&&"constructor"in a&&!(typeof ye=="function"&&ye instanceof ye&&typeof Fe=="function"&&Fe instanceof Fe)&&(gt=!1)}return w.delete(s),w.delete(a),gt}function Di(s){return fh(jc(s,e,rf),s+"")}function rh(s){return hc(s,oe,hh)}function sh(s){return hc(s,Ee,Xc)}var oh=Rs?function(s){return Rs.get(s)}:Ah;function Xs(s){for(var a=s.name+"",u=$n[a],p=Mt.call($n,a)?u.length:0;p--;){var v=u[p],w=v.func;if(w==null||w==s)return v.name}return a}function qn(s){var a=Mt.call(b,"placeholder")?b:s;return a.placeholder}function ot(){var s=b.iteratee||Th;return s=s===Th?cc:s,arguments.length?s(arguments[0],arguments[1]):s}function zs(s,a){var u=s.__data__;return nv(a)?u[typeof a=="string"?"string":"hash"]:u.map}function ah(s){for(var a=oe(s),u=a.length;u--;){var p=a[u],v=s[p];a[u]=[p,v,Vc(v)]}return a}function xn(s,a){var u=o_(s,a);return uc(u)?u:e}function K0(s){var a=Mt.call(s,pn),u=s[pn];try{s[pn]=e;var p=!0}catch{}var v=bs.call(s);return p&&(a?s[pn]=u:delete s[pn]),v}var hh=La?function(s){return s==null?[]:(s=Dt(s),Yi(La(s),function(a){return qu.call(s,a)}))}:Sh,Xc=La?function(s){for(var a=[];s;)ji(a,hh(s)),s=Es(s);return a}:Sh,me=ve;(Oa&&me(new Oa(new ArrayBuffer(1)))!=Nn||Ir&&me(new Ir)!=Yt||Na&&me(Na.resolve())!=su||zn&&me(new zn)!=Ze||Rr&&me(new Rr)!=Er)&&(me=function(s){var a=ve(s),u=a==gi?s.constructor:e,p=u?yn(u):"";if(p)switch(p){case D_:return Nn;case B_:return Yt;case F_:return su;case L_:return Ze;case O_:return Er}return a});function Z0(s,a,u){for(var p=-1,v=u.length;++p<v;){var w=u[p],C=w.size;switch(w.type){case"drop":s+=C;break;case"dropRight":a-=C;break;case"take":a=ge(a,s+C);break;case"takeRight":s=re(s,a-C);break}}return{start:s,end:a}}function J0(s){var a=s.match(rm);return a?a[1].split(sm):[]}function zc(s,a,u){a=Qi(a,s);for(var p=-1,v=a.length,w=!1;++p<v;){var C=vi(a[p]);if(!(w=s!=null&&u(s,C)))break;s=s[C]}return w||++p!=v?w:(v=s==null?0:s.length,!!v&&Zs(v)&&Bi(C,v)&&(ct(s)||bn(s)))}function Q0(s){var a=s.length,u=new s.constructor(a);return a&&typeof s[0]=="string"&&Mt.call(s,"index")&&(u.index=s.index,u.input=s.input),u}function $c(s){return typeof s.constructor=="function"&&!kr(s)?Vn(Es(s)):{}}function tv(s,a,u){var p=s.constructor;switch(a){case Ar:return eh(s);case $t:case Qt:return new p(+s);case Nn:return N0(s,u);case aa:case ha:case la:case ua:case ca:case fa:case da:case pa:case ga:return Cc(s,u);case Yt:return new p;case pe:case Tr:return new p(s);case wr:return k0(s);case Ze:return new p;case cs:return U0(s)}}function ev(s,a){var u=a.length;if(!u)return s;var p=u-1;return a[p]=(u>1?"& ":"")+a[p],a=a.join(u>2?", ":" "),s.replace(nm,`{
/* [wrapped with `+a+`] */
`)}function iv(s){return ct(s)||bn(s)||!!(Ku&&s&&s[Ku])}function Bi(s,a){var u=typeof s;return a=a??vt,!!a&&(u=="number"||u!="symbol"&&pm.test(s))&&s>-1&&s%1==0&&s<a}function xe(s,a,u){if(!Wt(u))return!1;var p=typeof a;return(p=="number"?Te(u)&&Bi(a,u.length):p=="string"&&a in u)?ti(u[a],s):!1}function lh(s,a){if(ct(s))return!1;var u=typeof s;return u=="number"||u=="symbol"||u=="boolean"||s==null||De(s)?!0:Qg.test(s)||!Jg.test(s)||a!=null&&s in Dt(a)}function nv(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function uh(s){var a=Xs(s),u=b[a];if(typeof u!="function"||!(a in bt.prototype))return!1;if(s===u)return!0;var p=oh(u);return!!p&&s===p[0]}function rv(s){return!!Vu&&Vu in s}var sv=xs?Fi:Ch;function kr(s){var a=s&&s.constructor,u=typeof a=="function"&&a.prototype||Xn;return s===u}function Vc(s){return s===s&&!Wt(s)}function Yc(s,a){return function(u){return u==null?!1:u[s]===a&&(a!==e||s in Dt(u))}}function ov(s){var a=qs(s,function(p){return u.size===f&&u.clear(),p}),u=a.cache;return a}function av(s,a){var u=s[1],p=a[1],v=u|p,w=v<(y|E|L),C=p==L&&u==A||p==L&&u==F&&s[7].length<=a[8]||p==(L|F)&&a[7].length<=a[8]&&u==A;if(!(w||C))return s;p&y&&(s[2]=a[2],v|=u&y?0:S);var R=a[3];if(R){var M=s[3];s[3]=M?Rc(M,R,a[4]):R,s[4]=M?qi(s[3],d):a[4]}return R=a[5],R&&(M=s[5],s[5]=M?Pc(M,R,a[6]):R,s[6]=M?qi(s[5],d):a[6]),R=a[7],R&&(s[7]=R),p&L&&(s[8]=s[8]==null?a[8]:ge(s[8],a[8])),s[9]==null&&(s[9]=a[9]),s[0]=a[0],s[1]=v,s}function hv(s){var a=[];if(s!=null)for(var u in Dt(s))a.push(u);return a}function lv(s){return bs.call(s)}function jc(s,a,u){return a=re(a===e?s.length-1:a,0),function(){for(var p=arguments,v=-1,w=re(p.length-a,0),C=B(w);++v<w;)C[v]=p[a+v];v=-1;for(var R=B(a+1);++v<a;)R[v]=p[v];return R[a]=u(C),Re(s,this,R)}}function qc(s,a){return a.length<2?s:vn(s,$e(a,0,-1))}function uv(s,a){for(var u=s.length,p=ge(a.length,u),v=we(s);p--;){var w=a[p];s[p]=Bi(w,u)?v[w]:e}return s}function ch(s,a){if(!(a==="constructor"&&typeof s[a]=="function")&&a!="__proto__")return s[a]}var Kc=Jc(xc),Ur=A_||function(s,a){return ae.setTimeout(s,a)},fh=Jc(B0);function Zc(s,a,u){var p=a+"";return fh(s,ev(p,cv(J0(p),u)))}function Jc(s){var a=0,u=0;return function(){var p=R_(),v=X-(p-u);if(u=p,v>0){if(++a>=Q)return arguments[0]}else a=0;return s.apply(e,arguments)}}function $s(s,a){var u=-1,p=s.length,v=p-1;for(a=a===e?p:a;++u<a;){var w=ja(u,v),C=s[w];s[w]=s[u],s[u]=C}return s.length=a,s}var Qc=ov(function(s){var a=[];return s.charCodeAt(0)===46&&a.push(""),s.replace(tm,function(u,p,v,w){a.push(v?w.replace(hm,"$1"):p||u)}),a});function vi(s){if(typeof s=="string"||De(s))return s;var a=s+"";return a=="0"&&1/s==-j?"-0":a}function yn(s){if(s!=null){try{return ys.call(s)}catch{}try{return s+""}catch{}}return""}function cv(s,a){return We(Rt,function(u){var p="_."+u[0];a&u[1]&&!gs(s,p)&&s.push(p)}),s.sort()}function tf(s){if(s instanceof bt)return s.clone();var a=new Xe(s.__wrapped__,s.__chain__);return a.__actions__=we(s.__actions__),a.__index__=s.__index__,a.__values__=s.__values__,a}function fv(s,a,u){(u?xe(s,a,u):a===e)?a=1:a=re(pt(a),0);var p=s==null?0:s.length;if(!p||a<1)return[];for(var v=0,w=0,C=B(Cs(p/a));v<p;)C[w++]=$e(s,v,v+=a);return C}function dv(s){for(var a=-1,u=s==null?0:s.length,p=0,v=[];++a<u;){var w=s[a];w&&(v[p++]=w)}return v}function pv(){var s=arguments.length;if(!s)return[];for(var a=B(s-1),u=arguments[0],p=s;p--;)a[p-1]=arguments[p];return ji(ct(u)?we(u):[u],he(a,1))}var gv=mt(function(s,a){return qt(s)?Br(s,he(a,1,qt,!0)):[]}),mv=mt(function(s,a){var u=Ve(a);return qt(u)&&(u=e),qt(s)?Br(s,he(a,1,qt,!0),ot(u,2)):[]}),_v=mt(function(s,a){var u=Ve(a);return qt(u)&&(u=e),qt(s)?Br(s,he(a,1,qt,!0),e,u):[]});function vv(s,a,u){var p=s==null?0:s.length;return p?(a=u||a===e?1:pt(a),$e(s,a<0?0:a,p)):[]}function xv(s,a,u){var p=s==null?0:s.length;return p?(a=u||a===e?1:pt(a),a=p-a,$e(s,0,a<0?0:a)):[]}function yv(s,a){return s&&s.length?Ns(s,ot(a,3),!0,!0):[]}function bv(s,a){return s&&s.length?Ns(s,ot(a,3),!0):[]}function wv(s,a,u,p){var v=s==null?0:s.length;return v?(u&&typeof u!="number"&&xe(s,a,u)&&(u=0,p=v),p0(s,a,u,p)):[]}function ef(s,a,u){var p=s==null?0:s.length;if(!p)return-1;var v=u==null?0:pt(u);return v<0&&(v=re(p+v,0)),ms(s,ot(a,3),v)}function nf(s,a,u){var p=s==null?0:s.length;if(!p)return-1;var v=p-1;return u!==e&&(v=pt(u),v=u<0?re(p+v,0):ge(v,p-1)),ms(s,ot(a,3),v,!0)}function rf(s){var a=s==null?0:s.length;return a?he(s,1):[]}function Tv(s){var a=s==null?0:s.length;return a?he(s,j):[]}function Ev(s,a){var u=s==null?0:s.length;return u?(a=a===e?1:pt(a),he(s,a)):[]}function Av(s){for(var a=-1,u=s==null?0:s.length,p={};++a<u;){var v=s[a];p[v[0]]=v[1]}return p}function sf(s){return s&&s.length?s[0]:e}function Sv(s,a,u){var p=s==null?0:s.length;if(!p)return-1;var v=u==null?0:pt(u);return v<0&&(v=re(p+v,0)),Un(s,a,v)}function Cv(s){var a=s==null?0:s.length;return a?$e(s,0,-1):[]}var Iv=mt(function(s){var a=Ut(s,Qa);return a.length&&a[0]===s[0]?Xa(a):[]}),Rv=mt(function(s){var a=Ve(s),u=Ut(s,Qa);return a===Ve(u)?a=e:u.pop(),u.length&&u[0]===s[0]?Xa(u,ot(a,2)):[]}),Pv=mt(function(s){var a=Ve(s),u=Ut(s,Qa);return a=typeof a=="function"?a:e,a&&u.pop(),u.length&&u[0]===s[0]?Xa(u,e,a):[]});function Mv(s,a){return s==null?"":C_.call(s,a)}function Ve(s){var a=s==null?0:s.length;return a?s[a-1]:e}function Dv(s,a,u){var p=s==null?0:s.length;if(!p)return-1;var v=p;return u!==e&&(v=pt(u),v=v<0?re(p+v,0):ge(v,p-1)),a===a?c_(s,a,v):ms(s,ku,v,!0)}function Bv(s,a){return s&&s.length?gc(s,pt(a)):e}var Fv=mt(of);function of(s,a){return s&&s.length&&a&&a.length?Ya(s,a):s}function Lv(s,a,u){return s&&s.length&&a&&a.length?Ya(s,a,ot(u,2)):s}function Ov(s,a,u){return s&&s.length&&a&&a.length?Ya(s,a,e,u):s}var Nv=Di(function(s,a){var u=s==null?0:s.length,p=Ua(s,a);return vc(s,Ut(a,function(v){return Bi(v,u)?+v:v}).sort(Ic)),p});function kv(s,a){var u=[];if(!(s&&s.length))return u;var p=-1,v=[],w=s.length;for(a=ot(a,3);++p<w;){var C=s[p];a(C,p,s)&&(u.push(C),v.push(p))}return vc(s,v),u}function dh(s){return s==null?s:M_.call(s)}function Uv(s,a,u){var p=s==null?0:s.length;return p?(u&&typeof u!="number"&&xe(s,a,u)?(a=0,u=p):(a=a==null?0:pt(a),u=u===e?p:pt(u)),$e(s,a,u)):[]}function Gv(s,a){return Os(s,a)}function Wv(s,a,u){return Ka(s,a,ot(u,2))}function Hv(s,a){var u=s==null?0:s.length;if(u){var p=Os(s,a);if(p<u&&ti(s[p],a))return p}return-1}function Xv(s,a){return Os(s,a,!0)}function zv(s,a,u){return Ka(s,a,ot(u,2),!0)}function $v(s,a){var u=s==null?0:s.length;if(u){var p=Os(s,a,!0)-1;if(ti(s[p],a))return p}return-1}function Vv(s){return s&&s.length?yc(s):[]}function Yv(s,a){return s&&s.length?yc(s,ot(a,2)):[]}function jv(s){var a=s==null?0:s.length;return a?$e(s,1,a):[]}function qv(s,a,u){return s&&s.length?(a=u||a===e?1:pt(a),$e(s,0,a<0?0:a)):[]}function Kv(s,a,u){var p=s==null?0:s.length;return p?(a=u||a===e?1:pt(a),a=p-a,$e(s,a<0?0:a,p)):[]}function Zv(s,a){return s&&s.length?Ns(s,ot(a,3),!1,!0):[]}function Jv(s,a){return s&&s.length?Ns(s,ot(a,3)):[]}var Qv=mt(function(s){return Ji(he(s,1,qt,!0))}),tx=mt(function(s){var a=Ve(s);return qt(a)&&(a=e),Ji(he(s,1,qt,!0),ot(a,2))}),ex=mt(function(s){var a=Ve(s);return a=typeof a=="function"?a:e,Ji(he(s,1,qt,!0),e,a)});function ix(s){return s&&s.length?Ji(s):[]}function nx(s,a){return s&&s.length?Ji(s,ot(a,2)):[]}function rx(s,a){return a=typeof a=="function"?a:e,s&&s.length?Ji(s,e,a):[]}function ph(s){if(!(s&&s.length))return[];var a=0;return s=Yi(s,function(u){if(qt(u))return a=re(u.length,a),!0}),Ma(a,function(u){return Ut(s,Ia(u))})}function af(s,a){if(!(s&&s.length))return[];var u=ph(s);return a==null?u:Ut(u,function(p){return Re(a,e,p)})}var sx=mt(function(s,a){return qt(s)?Br(s,a):[]}),ox=mt(function(s){return Ja(Yi(s,qt))}),ax=mt(function(s){var a=Ve(s);return qt(a)&&(a=e),Ja(Yi(s,qt),ot(a,2))}),hx=mt(function(s){var a=Ve(s);return a=typeof a=="function"?a:e,Ja(Yi(s,qt),e,a)}),lx=mt(ph);function ux(s,a){return Ec(s||[],a||[],Dr)}function cx(s,a){return Ec(s||[],a||[],Or)}var fx=mt(function(s){var a=s.length,u=a>1?s[a-1]:e;return u=typeof u=="function"?(s.pop(),u):e,af(s,u)});function hf(s){var a=b(s);return a.__chain__=!0,a}function dx(s,a){return a(s),s}function Vs(s,a){return a(s)}var px=Di(function(s){var a=s.length,u=a?s[0]:0,p=this.__wrapped__,v=function(w){return Ua(w,s)};return a>1||this.__actions__.length||!(p instanceof bt)||!Bi(u)?this.thru(v):(p=p.slice(u,+u+(a?1:0)),p.__actions__.push({func:Vs,args:[v],thisArg:e}),new Xe(p,this.__chain__).thru(function(w){return a&&!w.length&&w.push(e),w}))});function gx(){return hf(this)}function mx(){return new Xe(this.value(),this.__chain__)}function _x(){this.__values__===e&&(this.__values__=wf(this.value()));var s=this.__index__>=this.__values__.length,a=s?e:this.__values__[this.__index__++];return{done:s,value:a}}function vx(){return this}function xx(s){for(var a,u=this;u instanceof Ms;){var p=tf(u);p.__index__=0,p.__values__=e,a?v.__wrapped__=p:a=p;var v=p;u=u.__wrapped__}return v.__wrapped__=s,a}function yx(){var s=this.__wrapped__;if(s instanceof bt){var a=s;return this.__actions__.length&&(a=new bt(this)),a=a.reverse(),a.__actions__.push({func:Vs,args:[dh],thisArg:e}),new Xe(a,this.__chain__)}return this.thru(dh)}function bx(){return Tc(this.__wrapped__,this.__actions__)}var wx=ks(function(s,a,u){Mt.call(s,u)?++s[u]:Pi(s,u,1)});function Tx(s,a,u){var p=ct(s)?Ou:d0;return u&&xe(s,a,u)&&(a=e),p(s,ot(a,3))}function Ex(s,a){var u=ct(s)?Yi:oc;return u(s,ot(a,3))}var Ax=Fc(ef),Sx=Fc(nf);function Cx(s,a){return he(Ys(s,a),1)}function Ix(s,a){return he(Ys(s,a),j)}function Rx(s,a,u){return u=u===e?1:pt(u),he(Ys(s,a),u)}function lf(s,a){var u=ct(s)?We:Zi;return u(s,ot(a,3))}function uf(s,a){var u=ct(s)?jm:sc;return u(s,ot(a,3))}var Px=ks(function(s,a,u){Mt.call(s,u)?s[u].push(a):Pi(s,u,[a])});function Mx(s,a,u,p){s=Te(s)?s:Zn(s),u=u&&!p?pt(u):0;var v=s.length;return u<0&&(u=re(v+u,0)),Js(s)?u<=v&&s.indexOf(a,u)>-1:!!v&&Un(s,a,u)>-1}var Dx=mt(function(s,a,u){var p=-1,v=typeof a=="function",w=Te(s)?B(s.length):[];return Zi(s,function(C){w[++p]=v?Re(a,C,u):Fr(C,a,u)}),w}),Bx=ks(function(s,a,u){Pi(s,u,a)});function Ys(s,a){var u=ct(s)?Ut:fc;return u(s,ot(a,3))}function Fx(s,a,u,p){return s==null?[]:(ct(a)||(a=a==null?[]:[a]),u=p?e:u,ct(u)||(u=u==null?[]:[u]),mc(s,a,u))}var Lx=ks(function(s,a,u){s[u?0:1].push(a)},function(){return[[],[]]});function Ox(s,a,u){var p=ct(s)?Sa:Gu,v=arguments.length<3;return p(s,ot(a,4),u,v,Zi)}function Nx(s,a,u){var p=ct(s)?qm:Gu,v=arguments.length<3;return p(s,ot(a,4),u,v,sc)}function kx(s,a){var u=ct(s)?Yi:oc;return u(s,Ks(ot(a,3)))}function Ux(s){var a=ct(s)?ec:M0;return a(s)}function Gx(s,a,u){(u?xe(s,a,u):a===e)?a=1:a=pt(a);var p=ct(s)?h0:D0;return p(s,a)}function Wx(s){var a=ct(s)?l0:F0;return a(s)}function Hx(s){if(s==null)return 0;if(Te(s))return Js(s)?Wn(s):s.length;var a=me(s);return a==Yt||a==Ze?s.size:$a(s).length}function Xx(s,a,u){var p=ct(s)?Ca:L0;return u&&xe(s,a,u)&&(a=e),p(s,ot(a,3))}var zx=mt(function(s,a){if(s==null)return[];var u=a.length;return u>1&&xe(s,a[0],a[1])?a=[]:u>2&&xe(a[0],a[1],a[2])&&(a=[a[0]]),mc(s,he(a,1),[])}),js=E_||function(){return ae.Date.now()};function $x(s,a){if(typeof a!="function")throw new He(h);return s=pt(s),function(){if(--s<1)return a.apply(this,arguments)}}function cf(s,a,u){return a=u?e:a,a=s&&a==null?s.length:a,Mi(s,L,e,e,e,e,a)}function ff(s,a){var u;if(typeof a!="function")throw new He(h);return s=pt(s),function(){return--s>0&&(u=a.apply(this,arguments)),s<=1&&(a=e),u}}var gh=mt(function(s,a,u){var p=y;if(u.length){var v=qi(u,qn(gh));p|=D}return Mi(s,p,a,u,v)}),df=mt(function(s,a,u){var p=y|E;if(u.length){var v=qi(u,qn(df));p|=D}return Mi(a,p,s,u,v)});function pf(s,a,u){a=u?e:a;var p=Mi(s,A,e,e,e,e,e,a);return p.placeholder=pf.placeholder,p}function gf(s,a,u){a=u?e:a;var p=Mi(s,I,e,e,e,e,e,a);return p.placeholder=gf.placeholder,p}function mf(s,a,u){var p,v,w,C,R,M,k=0,U=!1,W=!1,Y=!0;if(typeof s!="function")throw new He(h);a=Ye(a)||0,Wt(u)&&(U=!!u.leading,W="maxWait"in u,w=W?re(Ye(u.maxWait)||0,a):w,Y="trailing"in u?!!u.trailing:Y);function tt(Kt){var ei=p,Oi=v;return p=v=e,k=Kt,C=s.apply(Oi,ei),C}function at(Kt){return k=Kt,R=Ur(xt,a),U?tt(Kt):C}function gt(Kt){var ei=Kt-M,Oi=Kt-k,Lf=a-ei;return W?ge(Lf,w-Oi):Lf}function ht(Kt){var ei=Kt-M,Oi=Kt-k;return M===e||ei>=a||ei<0||W&&Oi>=w}function xt(){var Kt=js();if(ht(Kt))return Tt(Kt);R=Ur(xt,gt(Kt))}function Tt(Kt){return R=e,Y&&p?tt(Kt):(p=v=e,C)}function Be(){R!==e&&Ac(R),k=0,p=M=v=R=e}function ye(){return R===e?C:Tt(js())}function Fe(){var Kt=js(),ei=ht(Kt);if(p=arguments,v=this,M=Kt,ei){if(R===e)return at(M);if(W)return Ac(R),R=Ur(xt,a),tt(M)}return R===e&&(R=Ur(xt,a)),C}return Fe.cancel=Be,Fe.flush=ye,Fe}var Vx=mt(function(s,a){return rc(s,1,a)}),Yx=mt(function(s,a,u){return rc(s,Ye(a)||0,u)});function jx(s){return Mi(s,V)}function qs(s,a){if(typeof s!="function"||a!=null&&typeof a!="function")throw new He(h);var u=function(){var p=arguments,v=a?a.apply(this,p):p[0],w=u.cache;if(w.has(v))return w.get(v);var C=s.apply(this,p);return u.cache=w.set(v,C)||w,C};return u.cache=new(qs.Cache||Ri),u}qs.Cache=Ri;function Ks(s){if(typeof s!="function")throw new He(h);return function(){var a=arguments;switch(a.length){case 0:return!s.call(this);case 1:return!s.call(this,a[0]);case 2:return!s.call(this,a[0],a[1]);case 3:return!s.call(this,a[0],a[1],a[2])}return!s.apply(this,a)}}function qx(s){return ff(2,s)}var Kx=O0(function(s,a){a=a.length==1&&ct(a[0])?Ut(a[0],Pe(ot())):Ut(he(a,1),Pe(ot()));var u=a.length;return mt(function(p){for(var v=-1,w=ge(p.length,u);++v<w;)p[v]=a[v].call(this,p[v]);return Re(s,this,p)})}),mh=mt(function(s,a){var u=qi(a,qn(mh));return Mi(s,D,e,a,u)}),_f=mt(function(s,a){var u=qi(a,qn(_f));return Mi(s,N,e,a,u)}),Zx=Di(function(s,a){return Mi(s,F,e,e,e,a)});function Jx(s,a){if(typeof s!="function")throw new He(h);return a=a===e?a:pt(a),mt(s,a)}function Qx(s,a){if(typeof s!="function")throw new He(h);return a=a==null?0:re(pt(a),0),mt(function(u){var p=u[a],v=tn(u,0,a);return p&&ji(v,p),Re(s,this,v)})}function ty(s,a,u){var p=!0,v=!0;if(typeof s!="function")throw new He(h);return Wt(u)&&(p="leading"in u?!!u.leading:p,v="trailing"in u?!!u.trailing:v),mf(s,a,{leading:p,maxWait:a,trailing:v})}function ey(s){return cf(s,1)}function iy(s,a){return mh(th(a),s)}function ny(){if(!arguments.length)return[];var s=arguments[0];return ct(s)?s:[s]}function ry(s){return ze(s,_)}function sy(s,a){return a=typeof a=="function"?a:e,ze(s,_,a)}function oy(s){return ze(s,g|_)}function ay(s,a){return a=typeof a=="function"?a:e,ze(s,g|_,a)}function hy(s,a){return a==null||nc(s,a,oe(a))}function ti(s,a){return s===a||s!==s&&a!==a}var ly=Hs(Ha),uy=Hs(function(s,a){return s>=a}),bn=lc(function(){return arguments}())?lc:function(s){return jt(s)&&Mt.call(s,"callee")&&!qu.call(s,"callee")},ct=B.isArray,cy=Pu?Pe(Pu):x0;function Te(s){return s!=null&&Zs(s.length)&&!Fi(s)}function qt(s){return jt(s)&&Te(s)}function fy(s){return s===!0||s===!1||jt(s)&&ve(s)==$t}var en=S_||Ch,dy=Mu?Pe(Mu):y0;function py(s){return jt(s)&&s.nodeType===1&&!Gr(s)}function gy(s){if(s==null)return!0;if(Te(s)&&(ct(s)||typeof s=="string"||typeof s.splice=="function"||en(s)||Kn(s)||bn(s)))return!s.length;var a=me(s);if(a==Yt||a==Ze)return!s.size;if(kr(s))return!$a(s).length;for(var u in s)if(Mt.call(s,u))return!1;return!0}function my(s,a){return Lr(s,a)}function _y(s,a,u){u=typeof u=="function"?u:e;var p=u?u(s,a):e;return p===e?Lr(s,a,e,u):!!p}function _h(s){if(!jt(s))return!1;var a=ve(s);return a==Pt||a==ie||typeof s.message=="string"&&typeof s.name=="string"&&!Gr(s)}function vy(s){return typeof s=="number"&&Zu(s)}function Fi(s){if(!Wt(s))return!1;var a=ve(s);return a==Ot||a==Vt||a==Jt||a==Hg}function vf(s){return typeof s=="number"&&s==pt(s)}function Zs(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=vt}function Wt(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function jt(s){return s!=null&&typeof s=="object"}var xf=Du?Pe(Du):w0;function xy(s,a){return s===a||za(s,a,ah(a))}function yy(s,a,u){return u=typeof u=="function"?u:e,za(s,a,ah(a),u)}function by(s){return yf(s)&&s!=+s}function wy(s){if(sv(s))throw new ut(o);return uc(s)}function Ty(s){return s===null}function Ey(s){return s==null}function yf(s){return typeof s=="number"||jt(s)&&ve(s)==pe}function Gr(s){if(!jt(s)||ve(s)!=gi)return!1;var a=Es(s);if(a===null)return!0;var u=Mt.call(a,"constructor")&&a.constructor;return typeof u=="function"&&u instanceof u&&ys.call(u)==y_}var vh=Bu?Pe(Bu):T0;function Ay(s){return vf(s)&&s>=-vt&&s<=vt}var bf=Fu?Pe(Fu):E0;function Js(s){return typeof s=="string"||!ct(s)&&jt(s)&&ve(s)==Tr}function De(s){return typeof s=="symbol"||jt(s)&&ve(s)==cs}var Kn=Lu?Pe(Lu):A0;function Sy(s){return s===e}function Cy(s){return jt(s)&&me(s)==Er}function Iy(s){return jt(s)&&ve(s)==zg}var Ry=Hs(Va),Py=Hs(function(s,a){return s<=a});function wf(s){if(!s)return[];if(Te(s))return Js(s)?Je(s):we(s);if(Cr&&s[Cr])return h_(s[Cr]());var a=me(s),u=a==Yt?Ba:a==Ze?_s:Zn;return u(s)}function Li(s){if(!s)return s===0?s:0;if(s=Ye(s),s===j||s===-j){var a=s<0?-1:1;return a*kt}return s===s?s:0}function pt(s){var a=Li(s),u=a%1;return a===a?u?a-u:a:0}function Tf(s){return s?_n(pt(s),0,it):0}function Ye(s){if(typeof s=="number")return s;if(De(s))return H;if(Wt(s)){var a=typeof s.valueOf=="function"?s.valueOf():s;s=Wt(a)?a+"":a}if(typeof s!="string")return s===0?s:+s;s=Wu(s);var u=cm.test(s);return u||dm.test(s)?$m(s.slice(2),u?2:8):um.test(s)?H:+s}function Ef(s){return _i(s,Ee(s))}function My(s){return s?_n(pt(s),-vt,vt):s===0?s:0}function It(s){return s==null?"":Me(s)}var Dy=Yn(function(s,a){if(kr(a)||Te(a)){_i(a,oe(a),s);return}for(var u in a)Mt.call(a,u)&&Dr(s,u,a[u])}),Af=Yn(function(s,a){_i(a,Ee(a),s)}),Qs=Yn(function(s,a,u,p){_i(a,Ee(a),s,p)}),By=Yn(function(s,a,u,p){_i(a,oe(a),s,p)}),Fy=Di(Ua);function Ly(s,a){var u=Vn(s);return a==null?u:ic(u,a)}var Oy=mt(function(s,a){s=Dt(s);var u=-1,p=a.length,v=p>2?a[2]:e;for(v&&xe(a[0],a[1],v)&&(p=1);++u<p;)for(var w=a[u],C=Ee(w),R=-1,M=C.length;++R<M;){var k=C[R],U=s[k];(U===e||ti(U,Xn[k])&&!Mt.call(s,k))&&(s[k]=w[k])}return s}),Ny=mt(function(s){return s.push(e,Wc),Re(Sf,e,s)});function ky(s,a){return Nu(s,ot(a,3),mi)}function Uy(s,a){return Nu(s,ot(a,3),Wa)}function Gy(s,a){return s==null?s:Ga(s,ot(a,3),Ee)}function Wy(s,a){return s==null?s:ac(s,ot(a,3),Ee)}function Hy(s,a){return s&&mi(s,ot(a,3))}function Xy(s,a){return s&&Wa(s,ot(a,3))}function zy(s){return s==null?[]:Fs(s,oe(s))}function $y(s){return s==null?[]:Fs(s,Ee(s))}function xh(s,a,u){var p=s==null?e:vn(s,a);return p===e?u:p}function Vy(s,a){return s!=null&&zc(s,a,g0)}function yh(s,a){return s!=null&&zc(s,a,m0)}var Yy=Oc(function(s,a,u){a!=null&&typeof a.toString!="function"&&(a=bs.call(a)),s[a]=u},wh(Ae)),jy=Oc(function(s,a,u){a!=null&&typeof a.toString!="function"&&(a=bs.call(a)),Mt.call(s,a)?s[a].push(u):s[a]=[u]},ot),qy=mt(Fr);function oe(s){return Te(s)?tc(s):$a(s)}function Ee(s){return Te(s)?tc(s,!0):S0(s)}function Ky(s,a){var u={};return a=ot(a,3),mi(s,function(p,v,w){Pi(u,a(p,v,w),p)}),u}function Zy(s,a){var u={};return a=ot(a,3),mi(s,function(p,v,w){Pi(u,v,a(p,v,w))}),u}var Jy=Yn(function(s,a,u){Ls(s,a,u)}),Sf=Yn(function(s,a,u,p){Ls(s,a,u,p)}),Qy=Di(function(s,a){var u={};if(s==null)return u;var p=!1;a=Ut(a,function(w){return w=Qi(w,s),p||(p=w.length>1),w}),_i(s,sh(s),u),p&&(u=ze(u,g|m|_,Y0));for(var v=a.length;v--;)Za(u,a[v]);return u});function t1(s,a){return Cf(s,Ks(ot(a)))}var e1=Di(function(s,a){return s==null?{}:I0(s,a)});function Cf(s,a){if(s==null)return{};var u=Ut(sh(s),function(p){return[p]});return a=ot(a),_c(s,u,function(p,v){return a(p,v[0])})}function i1(s,a,u){a=Qi(a,s);var p=-1,v=a.length;for(v||(v=1,s=e);++p<v;){var w=s==null?e:s[vi(a[p])];w===e&&(p=v,w=u),s=Fi(w)?w.call(s):w}return s}function n1(s,a,u){return s==null?s:Or(s,a,u)}function r1(s,a,u,p){return p=typeof p=="function"?p:e,s==null?s:Or(s,a,u,p)}var If=Uc(oe),Rf=Uc(Ee);function s1(s,a,u){var p=ct(s),v=p||en(s)||Kn(s);if(a=ot(a,4),u==null){var w=s&&s.constructor;v?u=p?new w:[]:Wt(s)?u=Fi(w)?Vn(Es(s)):{}:u={}}return(v?We:mi)(s,function(C,R,M){return a(u,C,R,M)}),u}function o1(s,a){return s==null?!0:Za(s,a)}function a1(s,a,u){return s==null?s:wc(s,a,th(u))}function h1(s,a,u,p){return p=typeof p=="function"?p:e,s==null?s:wc(s,a,th(u),p)}function Zn(s){return s==null?[]:Da(s,oe(s))}function l1(s){return s==null?[]:Da(s,Ee(s))}function u1(s,a,u){return u===e&&(u=a,a=e),u!==e&&(u=Ye(u),u=u===u?u:0),a!==e&&(a=Ye(a),a=a===a?a:0),_n(Ye(s),a,u)}function c1(s,a,u){return a=Li(a),u===e?(u=a,a=0):u=Li(u),s=Ye(s),_0(s,a,u)}function f1(s,a,u){if(u&&typeof u!="boolean"&&xe(s,a,u)&&(a=u=e),u===e&&(typeof a=="boolean"?(u=a,a=e):typeof s=="boolean"&&(u=s,s=e)),s===e&&a===e?(s=0,a=1):(s=Li(s),a===e?(a=s,s=0):a=Li(a)),s>a){var p=s;s=a,a=p}if(u||s%1||a%1){var v=Ju();return ge(s+v*(a-s+zm("1e-"+((v+"").length-1))),a)}return ja(s,a)}var d1=jn(function(s,a,u){return a=a.toLowerCase(),s+(u?Pf(a):a)});function Pf(s){return bh(It(s).toLowerCase())}function Mf(s){return s=It(s),s&&s.replace(gm,n_).replace(Fm,"")}function p1(s,a,u){s=It(s),a=Me(a);var p=s.length;u=u===e?p:_n(pt(u),0,p);var v=u;return u-=a.length,u>=0&&s.slice(u,v)==a}function g1(s){return s=It(s),s&&qg.test(s)?s.replace(au,r_):s}function m1(s){return s=It(s),s&&em.test(s)?s.replace(ma,"\\$&"):s}var _1=jn(function(s,a,u){return s+(u?"-":"")+a.toLowerCase()}),v1=jn(function(s,a,u){return s+(u?" ":"")+a.toLowerCase()}),x1=Bc("toLowerCase");function y1(s,a,u){s=It(s),a=pt(a);var p=a?Wn(s):0;if(!a||p>=a)return s;var v=(a-p)/2;return Ws(Is(v),u)+s+Ws(Cs(v),u)}function b1(s,a,u){s=It(s),a=pt(a);var p=a?Wn(s):0;return a&&p<a?s+Ws(a-p,u):s}function w1(s,a,u){s=It(s),a=pt(a);var p=a?Wn(s):0;return a&&p<a?Ws(a-p,u)+s:s}function T1(s,a,u){return u||a==null?a=0:a&&(a=+a),P_(It(s).replace(_a,""),a||0)}function E1(s,a,u){return(u?xe(s,a,u):a===e)?a=1:a=pt(a),qa(It(s),a)}function A1(){var s=arguments,a=It(s[0]);return s.length<3?a:a.replace(s[1],s[2])}var S1=jn(function(s,a,u){return s+(u?"_":"")+a.toLowerCase()});function C1(s,a,u){return u&&typeof u!="number"&&xe(s,a,u)&&(a=u=e),u=u===e?it:u>>>0,u?(s=It(s),s&&(typeof a=="string"||a!=null&&!vh(a))&&(a=Me(a),!a&&Gn(s))?tn(Je(s),0,u):s.split(a,u)):[]}var I1=jn(function(s,a,u){return s+(u?" ":"")+bh(a)});function R1(s,a,u){return s=It(s),u=u==null?0:_n(pt(u),0,s.length),a=Me(a),s.slice(u,u+a.length)==a}function P1(s,a,u){var p=b.templateSettings;u&&xe(s,a,u)&&(a=e),s=It(s),a=Qs({},a,p,Gc);var v=Qs({},a.imports,p.imports,Gc),w=oe(v),C=Da(v,w),R,M,k=0,U=a.interpolate||fs,W="__p += '",Y=Fa((a.escape||fs).source+"|"+U.source+"|"+(U===hu?lm:fs).source+"|"+(a.evaluate||fs).source+"|$","g"),tt="//# sourceURL="+(Mt.call(a,"sourceURL")?(a.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Um+"]")+`
`;s.replace(Y,function(ht,xt,Tt,Be,ye,Fe){return Tt||(Tt=Be),W+=s.slice(k,Fe).replace(mm,s_),xt&&(R=!0,W+=`' +
__e(`+xt+`) +
'`),ye&&(M=!0,W+=`';
`+ye+`;
__p += '`),Tt&&(W+=`' +
((__t = (`+Tt+`)) == null ? '' : __t) +
'`),k=Fe+ht.length,ht}),W+=`';
`;var at=Mt.call(a,"variable")&&a.variable;if(!at)W=`with (obj) {
`+W+`
}
`;else if(am.test(at))throw new ut(l);W=(M?W.replace($g,""):W).replace(Vg,"$1").replace(Yg,"$1;"),W="function("+(at||"obj")+`) {
`+(at?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(R?", __e = _.escape":"")+(M?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+W+`return __p
}`;var gt=Bf(function(){return St(w,tt+"return "+W).apply(e,C)});if(gt.source=W,_h(gt))throw gt;return gt}function M1(s){return It(s).toLowerCase()}function D1(s){return It(s).toUpperCase()}function B1(s,a,u){if(s=It(s),s&&(u||a===e))return Wu(s);if(!s||!(a=Me(a)))return s;var p=Je(s),v=Je(a),w=Hu(p,v),C=Xu(p,v)+1;return tn(p,w,C).join("")}function F1(s,a,u){if(s=It(s),s&&(u||a===e))return s.slice(0,$u(s)+1);if(!s||!(a=Me(a)))return s;var p=Je(s),v=Xu(p,Je(a))+1;return tn(p,0,v).join("")}function L1(s,a,u){if(s=It(s),s&&(u||a===e))return s.replace(_a,"");if(!s||!(a=Me(a)))return s;var p=Je(s),v=Hu(p,Je(a));return tn(p,v).join("")}function O1(s,a){var u=J,p=$;if(Wt(a)){var v="separator"in a?a.separator:v;u="length"in a?pt(a.length):u,p="omission"in a?Me(a.omission):p}s=It(s);var w=s.length;if(Gn(s)){var C=Je(s);w=C.length}if(u>=w)return s;var R=u-Wn(p);if(R<1)return p;var M=C?tn(C,0,R).join(""):s.slice(0,R);if(v===e)return M+p;if(C&&(R+=M.length-R),vh(v)){if(s.slice(R).search(v)){var k,U=M;for(v.global||(v=Fa(v.source,It(lu.exec(v))+"g")),v.lastIndex=0;k=v.exec(U);)var W=k.index;M=M.slice(0,W===e?R:W)}}else if(s.indexOf(Me(v),R)!=R){var Y=M.lastIndexOf(v);Y>-1&&(M=M.slice(0,Y))}return M+p}function N1(s){return s=It(s),s&&jg.test(s)?s.replace(ou,f_):s}var k1=jn(function(s,a,u){return s+(u?" ":"")+a.toUpperCase()}),bh=Bc("toUpperCase");function Df(s,a,u){return s=It(s),a=u?e:a,a===e?a_(s)?g_(s):Jm(s):s.match(a)||[]}var Bf=mt(function(s,a){try{return Re(s,e,a)}catch(u){return _h(u)?u:new ut(u)}}),U1=Di(function(s,a){return We(a,function(u){u=vi(u),Pi(s,u,gh(s[u],s))}),s});function G1(s){var a=s==null?0:s.length,u=ot();return s=a?Ut(s,function(p){if(typeof p[1]!="function")throw new He(h);return[u(p[0]),p[1]]}):[],mt(function(p){for(var v=-1;++v<a;){var w=s[v];if(Re(w[0],this,p))return Re(w[1],this,p)}})}function W1(s){return f0(ze(s,g))}function wh(s){return function(){return s}}function H1(s,a){return s==null||s!==s?a:s}var X1=Lc(),z1=Lc(!0);function Ae(s){return s}function Th(s){return cc(typeof s=="function"?s:ze(s,g))}function $1(s){return dc(ze(s,g))}function V1(s,a){return pc(s,ze(a,g))}var Y1=mt(function(s,a){return function(u){return Fr(u,s,a)}}),j1=mt(function(s,a){return function(u){return Fr(s,u,a)}});function Eh(s,a,u){var p=oe(a),v=Fs(a,p);u==null&&!(Wt(a)&&(v.length||!p.length))&&(u=a,a=s,s=this,v=Fs(a,oe(a)));var w=!(Wt(u)&&"chain"in u)||!!u.chain,C=Fi(s);return We(v,function(R){var M=a[R];s[R]=M,C&&(s.prototype[R]=function(){var k=this.__chain__;if(w||k){var U=s(this.__wrapped__),W=U.__actions__=we(this.__actions__);return W.push({func:M,args:arguments,thisArg:s}),U.__chain__=k,U}return M.apply(s,ji([this.value()],arguments))})}),s}function q1(){return ae._===this&&(ae._=b_),this}function Ah(){}function K1(s){return s=pt(s),mt(function(a){return gc(a,s)})}var Z1=ih(Ut),J1=ih(Ou),Q1=ih(Ca);function Ff(s){return lh(s)?Ia(vi(s)):R0(s)}function tb(s){return function(a){return s==null?e:vn(s,a)}}var eb=Nc(),ib=Nc(!0);function Sh(){return[]}function Ch(){return!1}function nb(){return{}}function rb(){return""}function sb(){return!0}function ob(s,a){if(s=pt(s),s<1||s>vt)return[];var u=it,p=ge(s,it);a=ot(a),s-=it;for(var v=Ma(p,a);++u<s;)a(u);return v}function ab(s){return ct(s)?Ut(s,vi):De(s)?[s]:we(Qc(It(s)))}function hb(s){var a=++x_;return It(s)+a}var lb=Gs(function(s,a){return s+a},0),ub=nh("ceil"),cb=Gs(function(s,a){return s/a},1),fb=nh("floor");function db(s){return s&&s.length?Bs(s,Ae,Ha):e}function pb(s,a){return s&&s.length?Bs(s,ot(a,2),Ha):e}function gb(s){return Uu(s,Ae)}function mb(s,a){return Uu(s,ot(a,2))}function _b(s){return s&&s.length?Bs(s,Ae,Va):e}function vb(s,a){return s&&s.length?Bs(s,ot(a,2),Va):e}var xb=Gs(function(s,a){return s*a},1),yb=nh("round"),bb=Gs(function(s,a){return s-a},0);function wb(s){return s&&s.length?Pa(s,Ae):0}function Tb(s,a){return s&&s.length?Pa(s,ot(a,2)):0}return b.after=$x,b.ary=cf,b.assign=Dy,b.assignIn=Af,b.assignInWith=Qs,b.assignWith=By,b.at=Fy,b.before=ff,b.bind=gh,b.bindAll=U1,b.bindKey=df,b.castArray=ny,b.chain=hf,b.chunk=fv,b.compact=dv,b.concat=pv,b.cond=G1,b.conforms=W1,b.constant=wh,b.countBy=wx,b.create=Ly,b.curry=pf,b.curryRight=gf,b.debounce=mf,b.defaults=Oy,b.defaultsDeep=Ny,b.defer=Vx,b.delay=Yx,b.difference=gv,b.differenceBy=mv,b.differenceWith=_v,b.drop=vv,b.dropRight=xv,b.dropRightWhile=yv,b.dropWhile=bv,b.fill=wv,b.filter=Ex,b.flatMap=Cx,b.flatMapDeep=Ix,b.flatMapDepth=Rx,b.flatten=rf,b.flattenDeep=Tv,b.flattenDepth=Ev,b.flip=jx,b.flow=X1,b.flowRight=z1,b.fromPairs=Av,b.functions=zy,b.functionsIn=$y,b.groupBy=Px,b.initial=Cv,b.intersection=Iv,b.intersectionBy=Rv,b.intersectionWith=Pv,b.invert=Yy,b.invertBy=jy,b.invokeMap=Dx,b.iteratee=Th,b.keyBy=Bx,b.keys=oe,b.keysIn=Ee,b.map=Ys,b.mapKeys=Ky,b.mapValues=Zy,b.matches=$1,b.matchesProperty=V1,b.memoize=qs,b.merge=Jy,b.mergeWith=Sf,b.method=Y1,b.methodOf=j1,b.mixin=Eh,b.negate=Ks,b.nthArg=K1,b.omit=Qy,b.omitBy=t1,b.once=qx,b.orderBy=Fx,b.over=Z1,b.overArgs=Kx,b.overEvery=J1,b.overSome=Q1,b.partial=mh,b.partialRight=_f,b.partition=Lx,b.pick=e1,b.pickBy=Cf,b.property=Ff,b.propertyOf=tb,b.pull=Fv,b.pullAll=of,b.pullAllBy=Lv,b.pullAllWith=Ov,b.pullAt=Nv,b.range=eb,b.rangeRight=ib,b.rearg=Zx,b.reject=kx,b.remove=kv,b.rest=Jx,b.reverse=dh,b.sampleSize=Gx,b.set=n1,b.setWith=r1,b.shuffle=Wx,b.slice=Uv,b.sortBy=zx,b.sortedUniq=Vv,b.sortedUniqBy=Yv,b.split=C1,b.spread=Qx,b.tail=jv,b.take=qv,b.takeRight=Kv,b.takeRightWhile=Zv,b.takeWhile=Jv,b.tap=dx,b.throttle=ty,b.thru=Vs,b.toArray=wf,b.toPairs=If,b.toPairsIn=Rf,b.toPath=ab,b.toPlainObject=Ef,b.transform=s1,b.unary=ey,b.union=Qv,b.unionBy=tx,b.unionWith=ex,b.uniq=ix,b.uniqBy=nx,b.uniqWith=rx,b.unset=o1,b.unzip=ph,b.unzipWith=af,b.update=a1,b.updateWith=h1,b.values=Zn,b.valuesIn=l1,b.without=sx,b.words=Df,b.wrap=iy,b.xor=ox,b.xorBy=ax,b.xorWith=hx,b.zip=lx,b.zipObject=ux,b.zipObjectDeep=cx,b.zipWith=fx,b.entries=If,b.entriesIn=Rf,b.extend=Af,b.extendWith=Qs,Eh(b,b),b.add=lb,b.attempt=Bf,b.camelCase=d1,b.capitalize=Pf,b.ceil=ub,b.clamp=u1,b.clone=ry,b.cloneDeep=oy,b.cloneDeepWith=ay,b.cloneWith=sy,b.conformsTo=hy,b.deburr=Mf,b.defaultTo=H1,b.divide=cb,b.endsWith=p1,b.eq=ti,b.escape=g1,b.escapeRegExp=m1,b.every=Tx,b.find=Ax,b.findIndex=ef,b.findKey=ky,b.findLast=Sx,b.findLastIndex=nf,b.findLastKey=Uy,b.floor=fb,b.forEach=lf,b.forEachRight=uf,b.forIn=Gy,b.forInRight=Wy,b.forOwn=Hy,b.forOwnRight=Xy,b.get=xh,b.gt=ly,b.gte=uy,b.has=Vy,b.hasIn=yh,b.head=sf,b.identity=Ae,b.includes=Mx,b.indexOf=Sv,b.inRange=c1,b.invoke=qy,b.isArguments=bn,b.isArray=ct,b.isArrayBuffer=cy,b.isArrayLike=Te,b.isArrayLikeObject=qt,b.isBoolean=fy,b.isBuffer=en,b.isDate=dy,b.isElement=py,b.isEmpty=gy,b.isEqual=my,b.isEqualWith=_y,b.isError=_h,b.isFinite=vy,b.isFunction=Fi,b.isInteger=vf,b.isLength=Zs,b.isMap=xf,b.isMatch=xy,b.isMatchWith=yy,b.isNaN=by,b.isNative=wy,b.isNil=Ey,b.isNull=Ty,b.isNumber=yf,b.isObject=Wt,b.isObjectLike=jt,b.isPlainObject=Gr,b.isRegExp=vh,b.isSafeInteger=Ay,b.isSet=bf,b.isString=Js,b.isSymbol=De,b.isTypedArray=Kn,b.isUndefined=Sy,b.isWeakMap=Cy,b.isWeakSet=Iy,b.join=Mv,b.kebabCase=_1,b.last=Ve,b.lastIndexOf=Dv,b.lowerCase=v1,b.lowerFirst=x1,b.lt=Ry,b.lte=Py,b.max=db,b.maxBy=pb,b.mean=gb,b.meanBy=mb,b.min=_b,b.minBy=vb,b.stubArray=Sh,b.stubFalse=Ch,b.stubObject=nb,b.stubString=rb,b.stubTrue=sb,b.multiply=xb,b.nth=Bv,b.noConflict=q1,b.noop=Ah,b.now=js,b.pad=y1,b.padEnd=b1,b.padStart=w1,b.parseInt=T1,b.random=f1,b.reduce=Ox,b.reduceRight=Nx,b.repeat=E1,b.replace=A1,b.result=i1,b.round=yb,b.runInContext=P,b.sample=Ux,b.size=Hx,b.snakeCase=S1,b.some=Xx,b.sortedIndex=Gv,b.sortedIndexBy=Wv,b.sortedIndexOf=Hv,b.sortedLastIndex=Xv,b.sortedLastIndexBy=zv,b.sortedLastIndexOf=$v,b.startCase=I1,b.startsWith=R1,b.subtract=bb,b.sum=wb,b.sumBy=Tb,b.template=P1,b.times=ob,b.toFinite=Li,b.toInteger=pt,b.toLength=Tf,b.toLower=M1,b.toNumber=Ye,b.toSafeInteger=My,b.toString=It,b.toUpper=D1,b.trim=B1,b.trimEnd=F1,b.trimStart=L1,b.truncate=O1,b.unescape=N1,b.uniqueId=hb,b.upperCase=k1,b.upperFirst=bh,b.each=lf,b.eachRight=uf,b.first=sf,Eh(b,function(){var s={};return mi(b,function(a,u){Mt.call(b.prototype,u)||(s[u]=a)}),s}(),{chain:!1}),b.VERSION=n,We(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){b[s].placeholder=b}),We(["drop","take"],function(s,a){bt.prototype[s]=function(u){u=u===e?1:re(pt(u),0);var p=this.__filtered__&&!a?new bt(this):this.clone();return p.__filtered__?p.__takeCount__=ge(u,p.__takeCount__):p.__views__.push({size:ge(u,it),type:s+(p.__dir__<0?"Right":"")}),p},bt.prototype[s+"Right"]=function(u){return this.reverse()[s](u).reverse()}}),We(["filter","map","takeWhile"],function(s,a){var u=a+1,p=u==G||u==_t;bt.prototype[s]=function(v){var w=this.clone();return w.__iteratees__.push({iteratee:ot(v,3),type:u}),w.__filtered__=w.__filtered__||p,w}}),We(["head","last"],function(s,a){var u="take"+(a?"Right":"");bt.prototype[s]=function(){return this[u](1).value()[0]}}),We(["initial","tail"],function(s,a){var u="drop"+(a?"":"Right");bt.prototype[s]=function(){return this.__filtered__?new bt(this):this[u](1)}}),bt.prototype.compact=function(){return this.filter(Ae)},bt.prototype.find=function(s){return this.filter(s).head()},bt.prototype.findLast=function(s){return this.reverse().find(s)},bt.prototype.invokeMap=mt(function(s,a){return typeof s=="function"?new bt(this):this.map(function(u){return Fr(u,s,a)})}),bt.prototype.reject=function(s){return this.filter(Ks(ot(s)))},bt.prototype.slice=function(s,a){s=pt(s);var u=this;return u.__filtered__&&(s>0||a<0)?new bt(u):(s<0?u=u.takeRight(-s):s&&(u=u.drop(s)),a!==e&&(a=pt(a),u=a<0?u.dropRight(-a):u.take(a-s)),u)},bt.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},bt.prototype.toArray=function(){return this.take(it)},mi(bt.prototype,function(s,a){var u=/^(?:filter|find|map|reject)|While$/.test(a),p=/^(?:head|last)$/.test(a),v=b[p?"take"+(a=="last"?"Right":""):a],w=p||/^find/.test(a);v&&(b.prototype[a]=function(){var C=this.__wrapped__,R=p?[1]:arguments,M=C instanceof bt,k=R[0],U=M||ct(C),W=function(xt){var Tt=v.apply(b,ji([xt],R));return p&&Y?Tt[0]:Tt};U&&u&&typeof k=="function"&&k.length!=1&&(M=U=!1);var Y=this.__chain__,tt=!!this.__actions__.length,at=w&&!Y,gt=M&&!tt;if(!w&&U){C=gt?C:new bt(this);var ht=s.apply(C,R);return ht.__actions__.push({func:Vs,args:[W],thisArg:e}),new Xe(ht,Y)}return at&&gt?s.apply(this,R):(ht=this.thru(W),at?p?ht.value()[0]:ht.value():ht)})}),We(["pop","push","shift","sort","splice","unshift"],function(s){var a=vs[s],u=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",p=/^(?:pop|shift)$/.test(s);b.prototype[s]=function(){var v=arguments;if(p&&!this.__chain__){var w=this.value();return a.apply(ct(w)?w:[],v)}return this[u](function(C){return a.apply(ct(C)?C:[],v)})}}),mi(bt.prototype,function(s,a){var u=b[a];if(u){var p=u.name+"";Mt.call($n,p)||($n[p]=[]),$n[p].push({name:a,func:u})}}),$n[Us(e,E).name]=[{name:"wrapper",func:e}],bt.prototype.clone=N_,bt.prototype.reverse=k_,bt.prototype.value=U_,b.prototype.at=px,b.prototype.chain=gx,b.prototype.commit=mx,b.prototype.next=_x,b.prototype.plant=xx,b.prototype.reverse=yx,b.prototype.toJSON=b.prototype.valueOf=b.prototype.value=bx,b.prototype.first=b.prototype.head,Cr&&(b.prototype[Cr]=vx),b},Hn=m_();dn?((dn.exports=Hn)._=Hn,Ta._=Hn):ae._=Hn}).call(Ui)})(Ie,Ie.exports);const Jn=Ie.exports;var On=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(On||{}),sl=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(sl||{}),lt=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(lt||{}),wi=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(wi||{}),z=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(z||{}),hr=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(hr||{}),st=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(st||{}),ol=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(ol||{}),Gi=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(Gi||{}),an=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(an||{}),Si=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Si||{}),pi=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(pi||{}),yi=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(yi||{}),kl=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(kl||{}),qe=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(qe||{}),se=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(se||{}),te=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(te||{}),Ti=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(Ti||{});const Cb={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},K={ADAPTER:Cb,RESOLUTION:1,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,premultipliedAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Ih=/iPhone/i,Of=/iPod/i,Nf=/iPad/i,kf=/\biOS-universal(?:.+)Mac\b/i,Rh=/\bAndroid(?:.+)Mobile\b/i,Uf=/Android/i,Qn=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,to=/Silk/i,Ni=/Windows Phone/i,Gf=/\bWindows(?:.+)ARM\b/i,Wf=/BlackBerry/i,Hf=/BB10/i,Xf=/Opera Mini/i,zf=/\b(CriOS|Chrome)(?:.+)Mobile/i,$f=/Mobile(?:.+)Firefox\b/i,Vf=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function Ib(i){return function(t){return t.test(i)}}function Rb(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,n=e.split("[FBAN");typeof n[1]<"u"&&(e=n[0]),n=e.split("Twitter"),typeof n[1]<"u"&&(e=n[0]);var r=Ib(e),o={apple:{phone:r(Ih)&&!r(Ni),ipod:r(Of),tablet:!r(Ih)&&(r(Nf)||Vf(t))&&!r(Ni),universal:r(kf),device:(r(Ih)||r(Of)||r(Nf)||r(kf)||Vf(t))&&!r(Ni)},amazon:{phone:r(Qn),tablet:!r(Qn)&&r(to),device:r(Qn)||r(to)},android:{phone:!r(Ni)&&r(Qn)||!r(Ni)&&r(Rh),tablet:!r(Ni)&&!r(Qn)&&!r(Rh)&&(r(to)||r(Uf)),device:!r(Ni)&&(r(Qn)||r(to)||r(Rh)||r(Uf))||r(/\bokhttp\b/i)},windows:{phone:r(Ni),tablet:r(Gf),device:r(Ni)||r(Gf)},other:{blackberry:r(Wf),blackberry10:r(Hf),opera:r(Xf),firefox:r($f),chrome:r(zf),device:r(Wf)||r(Hf)||r(Xf)||r($f)||r(zf)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const Wi=Rb(globalThis.navigator);K.RETINA_PREFIX=/@([0-9\.]+)x/;K.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Zd={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function r(c,f,d){this.fn=c,this.context=f,this.once=d||!1}function o(c,f,d,g,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var _=new r(d,g||c,m),x=e?e+f:f;return c._events[x]?c._events[x].fn?c._events[x]=[c._events[x],_]:c._events[x].push(_):(c._events[x]=_,c._eventsCount++),c}function h(c,f){--c._eventsCount===0?c._events=new n:delete c._events[f]}function l(){this._events=new n,this._eventsCount=0}l.prototype.eventNames=function(){var f=[],d,g;if(this._eventsCount===0)return f;for(g in d=this._events)t.call(d,g)&&f.push(e?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},l.prototype.listeners=function(f){var d=e?e+f:f,g=this._events[d];if(!g)return[];if(g.fn)return[g.fn];for(var m=0,_=g.length,x=new Array(_);m<_;m++)x[m]=g[m].fn;return x},l.prototype.listenerCount=function(f){var d=e?e+f:f,g=this._events[d];return g?g.fn?1:g.length:0},l.prototype.emit=function(f,d,g,m,_,x){var T=e?e+f:f;if(!this._events[T])return!1;var y=this._events[T],E=arguments.length,S,A;if(y.fn){switch(y.once&&this.removeListener(f,y.fn,void 0,!0),E){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,g),!0;case 4:return y.fn.call(y.context,d,g,m),!0;case 5:return y.fn.call(y.context,d,g,m,_),!0;case 6:return y.fn.call(y.context,d,g,m,_,x),!0}for(A=1,S=new Array(E-1);A<E;A++)S[A-1]=arguments[A];y.fn.apply(y.context,S)}else{var I=y.length,D;for(A=0;A<I;A++)switch(y[A].once&&this.removeListener(f,y[A].fn,void 0,!0),E){case 1:y[A].fn.call(y[A].context);break;case 2:y[A].fn.call(y[A].context,d);break;case 3:y[A].fn.call(y[A].context,d,g);break;case 4:y[A].fn.call(y[A].context,d,g,m);break;default:if(!S)for(D=1,S=new Array(E-1);D<E;D++)S[D-1]=arguments[D];y[A].fn.apply(y[A].context,S)}}return!0},l.prototype.on=function(f,d,g){return o(this,f,d,g,!1)},l.prototype.once=function(f,d,g){return o(this,f,d,g,!0)},l.prototype.removeListener=function(f,d,g,m){var _=e?e+f:f;if(!this._events[_])return this;if(!d)return h(this,_),this;var x=this._events[_];if(x.fn)x.fn===d&&(!m||x.once)&&(!g||x.context===g)&&h(this,_);else{for(var T=0,y=[],E=x.length;T<E;T++)(x[T].fn!==d||m&&!x[T].once||g&&x[T].context!==g)&&y.push(x[T]);y.length?this._events[_]=y.length===1?y[0]:y:h(this,_)}return this},l.prototype.removeAllListeners=function(f){var d;return f?(d=e?e+f:f,this._events[d]&&h(this,d)):(this._events=new n,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=e,l.EventEmitter=l,i.exports=l})(Zd);const ss=Zd.exports;var Ul={exports:{}};Ul.exports=jo;Ul.exports.default=jo;function jo(i,t,e){e=e||2;var n=t&&t.length,r=n?t[0]*e:i.length,o=Jd(i,0,r,e,!0),h=[];if(!o||o.next===o.prev)return h;var l,c,f,d,g,m,_;if(n&&(o=Fb(i,t,o,e)),i.length>80*e){l=f=i[0],c=d=i[1];for(var x=e;x<r;x+=e)g=i[x],m=i[x+1],g<l&&(l=g),m<c&&(c=m),g>f&&(f=g),m>d&&(d=m);_=Math.max(f-l,d-c),_=_!==0?32767/_:0}return Zr(o,h,e,l,c,_,0),h}function Jd(i,t,e,n,r){var o,h;if(r===ll(i,t,e,n)>0)for(o=t;o<e;o+=n)h=Yf(o,i[o],i[o+1],h);else for(o=e-n;o>=t;o-=n)h=Yf(o,i[o],i[o+1],h);return h&&qo(h,h.next)&&(Qr(h),h=h.next),h}function Bn(i,t){if(!i)return i;t||(t=i);var e=i,n;do if(n=!1,!e.steiner&&(qo(e,e.next)||Xt(e.prev,e,e.next)===0)){if(Qr(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Zr(i,t,e,n,r,o,h){if(i){!h&&o&&Ub(i,n,r,o);for(var l=i,c,f;i.prev!==i.next;){if(c=i.prev,f=i.next,o?Mb(i,n,r,o):Pb(i)){t.push(c.i/e|0),t.push(i.i/e|0),t.push(f.i/e|0),Qr(i),i=f.next,l=f.next;continue}if(i=f,i===l){h?h===1?(i=Db(Bn(i),t,e),Zr(i,t,e,n,r,o,2)):h===2&&Bb(i,t,e,n,r,o):Zr(Bn(i),t,e,n,r,o,1);break}}}}function Pb(i){var t=i.prev,e=i,n=i.next;if(Xt(t,e,n)>=0)return!1;for(var r=t.x,o=e.x,h=n.x,l=t.y,c=e.y,f=n.y,d=r<o?r<h?r:h:o<h?o:h,g=l<c?l<f?l:f:c<f?c:f,m=r>o?r>h?r:h:o>h?o:h,_=l>c?l>f?l:f:c>f?c:f,x=n.next;x!==t;){if(x.x>=d&&x.x<=m&&x.y>=g&&x.y<=_&&sr(r,l,o,c,h,f,x.x,x.y)&&Xt(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Mb(i,t,e,n){var r=i.prev,o=i,h=i.next;if(Xt(r,o,h)>=0)return!1;for(var l=r.x,c=o.x,f=h.x,d=r.y,g=o.y,m=h.y,_=l<c?l<f?l:f:c<f?c:f,x=d<g?d<m?d:m:g<m?g:m,T=l>c?l>f?l:f:c>f?c:f,y=d>g?d>m?d:m:g>m?g:m,E=al(_,x,t,e,n),S=al(T,y,t,e,n),A=i.prevZ,I=i.nextZ;A&&A.z>=E&&I&&I.z<=S;){if(A.x>=_&&A.x<=T&&A.y>=x&&A.y<=y&&A!==r&&A!==h&&sr(l,d,c,g,f,m,A.x,A.y)&&Xt(A.prev,A,A.next)>=0||(A=A.prevZ,I.x>=_&&I.x<=T&&I.y>=x&&I.y<=y&&I!==r&&I!==h&&sr(l,d,c,g,f,m,I.x,I.y)&&Xt(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;A&&A.z>=E;){if(A.x>=_&&A.x<=T&&A.y>=x&&A.y<=y&&A!==r&&A!==h&&sr(l,d,c,g,f,m,A.x,A.y)&&Xt(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;I&&I.z<=S;){if(I.x>=_&&I.x<=T&&I.y>=x&&I.y<=y&&I!==r&&I!==h&&sr(l,d,c,g,f,m,I.x,I.y)&&Xt(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function Db(i,t,e){var n=i;do{var r=n.prev,o=n.next.next;!qo(r,o)&&Qd(r,n,n.next,o)&&Jr(r,o)&&Jr(o,r)&&(t.push(r.i/e|0),t.push(n.i/e|0),t.push(o.i/e|0),Qr(n),Qr(n.next),n=i=o),n=n.next}while(n!==i);return Bn(n)}function Bb(i,t,e,n,r,o){var h=i;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&Hb(h,l)){var c=tp(h,l);h=Bn(h,h.next),c=Bn(c,c.next),Zr(h,t,e,n,r,o,0),Zr(c,t,e,n,r,o,0);return}l=l.next}h=h.next}while(h!==i)}function Fb(i,t,e,n){var r=[],o,h,l,c,f;for(o=0,h=t.length;o<h;o++)l=t[o]*n,c=o<h-1?t[o+1]*n:i.length,f=Jd(i,l,c,n,!1),f===f.next&&(f.steiner=!0),r.push(Wb(f));for(r.sort(Lb),o=0;o<r.length;o++)e=Ob(r[o],e);return e}function Lb(i,t){return i.x-t.x}function Ob(i,t){var e=Nb(i,t);if(!e)return t;var n=tp(e,i);return Bn(n,n.next),Bn(e,e.next)}function Nb(i,t){var e=t,n=i.x,r=i.y,o=-1/0,h;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){var l=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(l<=n&&l>o&&(o=l,h=e.x<e.next.x?e:e.next,l===n))return h}e=e.next}while(e!==t);if(!h)return null;var c=h,f=h.x,d=h.y,g=1/0,m;e=h;do n>=e.x&&e.x>=f&&n!==e.x&&sr(r<d?n:o,r,f,d,r<d?o:n,r,e.x,e.y)&&(m=Math.abs(r-e.y)/(n-e.x),Jr(e,i)&&(m<g||m===g&&(e.x>h.x||e.x===h.x&&kb(h,e)))&&(h=e,g=m)),e=e.next;while(e!==c);return h}function kb(i,t){return Xt(i.prev,i,t.prev)<0&&Xt(t.next,i,i.next)<0}function Ub(i,t,e,n){var r=i;do r.z===0&&(r.z=al(r.x,r.y,t,e,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,Gb(r)}function Gb(i){var t,e,n,r,o,h,l,c,f=1;do{for(e=i,i=null,o=null,h=0;e;){for(h++,n=e,l=0,t=0;t<f&&(l++,n=n.nextZ,!!n);t++);for(c=f;l>0||c>0&&n;)l!==0&&(c===0||!n||e.z<=n.z)?(r=e,e=e.nextZ,l--):(r=n,n=n.nextZ,c--),o?o.nextZ=r:i=r,r.prevZ=o,o=r;e=n}o.nextZ=null,f*=2}while(h>1);return i}function al(i,t,e,n,r){return i=(i-e)*r|0,t=(t-n)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function Wb(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function sr(i,t,e,n,r,o,h,l){return(r-h)*(t-l)>=(i-h)*(o-l)&&(i-h)*(n-l)>=(e-h)*(t-l)&&(e-h)*(o-l)>=(r-h)*(n-l)}function Hb(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!Xb(i,t)&&(Jr(i,t)&&Jr(t,i)&&zb(i,t)&&(Xt(i.prev,i,t.prev)||Xt(i,t.prev,t))||qo(i,t)&&Xt(i.prev,i,i.next)>0&&Xt(t.prev,t,t.next)>0)}function Xt(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function qo(i,t){return i.x===t.x&&i.y===t.y}function Qd(i,t,e,n){var r=io(Xt(i,t,e)),o=io(Xt(i,t,n)),h=io(Xt(e,n,i)),l=io(Xt(e,n,t));return!!(r!==o&&h!==l||r===0&&eo(i,e,t)||o===0&&eo(i,n,t)||h===0&&eo(e,i,n)||l===0&&eo(e,t,n))}function eo(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function io(i){return i>0?1:i<0?-1:0}function Xb(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Qd(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Jr(i,t){return Xt(i.prev,i,i.next)<0?Xt(i,t,i.next)>=0&&Xt(i,i.prev,t)>=0:Xt(i,t,i.prev)<0||Xt(i,i.next,t)<0}function zb(i,t){var e=i,n=!1,r=(i.x+t.x)/2,o=(i.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&r<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==i);return n}function tp(i,t){var e=new hl(i.i,i.x,i.y),n=new hl(t.i,t.x,t.y),r=i.next,o=t.prev;return i.next=t,t.prev=i,e.next=r,r.prev=e,n.next=e,e.prev=n,o.next=n,n.prev=o,n}function Yf(i,t,e,n){var r=new hl(i,t,e);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Qr(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function hl(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}jo.deviation=function(i,t,e,n){var r=t&&t.length,o=r?t[0]*e:i.length,h=Math.abs(ll(i,0,o,e));if(r)for(var l=0,c=t.length;l<c;l++){var f=t[l]*e,d=l<c-1?t[l+1]*e:i.length;h-=Math.abs(ll(i,f,d,e))}var g=0;for(l=0;l<n.length;l+=3){var m=n[l]*e,_=n[l+1]*e,x=n[l+2]*e;g+=Math.abs((i[m]-i[x])*(i[_+1]-i[m+1])-(i[m]-i[_])*(i[x+1]-i[m+1]))}return h===0&&g===0?0:Math.abs((g-h)/h)};function ll(i,t,e,n){for(var r=0,o=t,h=e-n;o<e;o+=n)r+=(i[h]-i[o])*(i[o+1]+i[h+1]),h=o;return r}jo.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,r=0;r<i.length;r++){for(var o=0;o<i[r].length;o++)for(var h=0;h<t;h++)e.vertices.push(i[r][o][h]);r>0&&(n+=i[r-1].length,e.holes.push(n))}return e};var ul={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,t){(function(e){var n=t&&!t.nodeType&&t,r=i&&!i.nodeType&&i,o=typeof Ui=="object"&&Ui;(o.global===o||o.window===o||o.self===o)&&(e=o);var h,l=2147483647,c=36,f=1,d=26,g=38,m=700,_=72,x=128,T="-",y=/^xn--/,E=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},I=c-f,D=Math.floor,N=String.fromCharCode,L;function F(H){throw RangeError(A[H])}function V(H,it){for(var yt=H.length,Ct=[];yt--;)Ct[yt]=it(H[yt]);return Ct}function J(H,it){var yt=H.split("@"),Ct="";yt.length>1&&(Ct=yt[0]+"@",H=yt[1]),H=H.replace(S,".");var Rt=H.split("."),Ft=V(Rt,it).join(".");return Ct+Ft}function $(H){for(var it=[],yt=0,Ct=H.length,Rt,Ft;yt<Ct;)Rt=H.charCodeAt(yt++),Rt>=55296&&Rt<=56319&&yt<Ct?(Ft=H.charCodeAt(yt++),(Ft&64512)==56320?it.push(((Rt&1023)<<10)+(Ft&1023)+65536):(it.push(Rt),yt--)):it.push(Rt);return it}function Q(H){return V(H,function(it){var yt="";return it>65535&&(it-=65536,yt+=N(it>>>10&1023|55296),it=56320|it&1023),yt+=N(it),yt}).join("")}function X(H){return H-48<10?H-22:H-65<26?H-65:H-97<26?H-97:c}function G(H,it){return H+22+75*(H<26)-((it!=0)<<5)}function dt(H,it,yt){var Ct=0;for(H=yt?D(H/m):H>>1,H+=D(H/it);H>I*d>>1;Ct+=c)H=D(H/I);return D(Ct+(I+1)*H/(H+g))}function _t(H){var it=[],yt=H.length,Ct,Rt=0,Ft=x,Lt=_,Jt,$t,Qt,ie,Pt,Ot,Vt,Yt,pe;for(Jt=H.lastIndexOf(T),Jt<0&&(Jt=0),$t=0;$t<Jt;++$t)H.charCodeAt($t)>=128&&F("not-basic"),it.push(H.charCodeAt($t));for(Qt=Jt>0?Jt+1:0;Qt<yt;){for(ie=Rt,Pt=1,Ot=c;Qt>=yt&&F("invalid-input"),Vt=X(H.charCodeAt(Qt++)),(Vt>=c||Vt>D((l-Rt)/Pt))&&F("overflow"),Rt+=Vt*Pt,Yt=Ot<=Lt?f:Ot>=Lt+d?d:Ot-Lt,!(Vt<Yt);Ot+=c)pe=c-Yt,Pt>D(l/pe)&&F("overflow"),Pt*=pe;Ct=it.length+1,Lt=dt(Rt-ie,Ct,ie==0),D(Rt/Ct)>l-Ft&&F("overflow"),Ft+=D(Rt/Ct),Rt%=Ct,it.splice(Rt++,0,Ft)}return Q(it)}function j(H){var it,yt,Ct,Rt,Ft,Lt,Jt,$t,Qt,ie,Pt,Ot=[],Vt,Yt,pe,fn;for(H=$(H),Vt=H.length,it=x,yt=0,Ft=_,Lt=0;Lt<Vt;++Lt)Pt=H[Lt],Pt<128&&Ot.push(N(Pt));for(Ct=Rt=Ot.length,Rt&&Ot.push(T);Ct<Vt;){for(Jt=l,Lt=0;Lt<Vt;++Lt)Pt=H[Lt],Pt>=it&&Pt<Jt&&(Jt=Pt);for(Yt=Ct+1,Jt-it>D((l-yt)/Yt)&&F("overflow"),yt+=(Jt-it)*Yt,it=Jt,Lt=0;Lt<Vt;++Lt)if(Pt=H[Lt],Pt<it&&++yt>l&&F("overflow"),Pt==it){for($t=yt,Qt=c;ie=Qt<=Ft?f:Qt>=Ft+d?d:Qt-Ft,!($t<ie);Qt+=c)fn=$t-ie,pe=c-ie,Ot.push(N(G(ie+fn%pe,0))),$t=D(fn/pe);Ot.push(N(G($t,0))),Ft=dt(yt,Yt,Ct==Rt),yt=0,++Ct}++yt,++it}return Ot.join("")}function vt(H){return J(H,function(it){return y.test(it)?_t(it.slice(4).toLowerCase()):it})}function kt(H){return J(H,function(it){return E.test(it)?"xn--"+j(it):it})}if(h={version:"1.3.2",ucs2:{decode:$,encode:Q},decode:_t,encode:j,toASCII:kt,toUnicode:vt},n&&r)if(i.exports==n)r.exports=h;else for(L in h)h.hasOwnProperty(L)&&(n[L]=h[L]);else e.punycode=h})(Ui)})(ul,ul.exports);var $b={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},ts={};function Vb(i,t){return Object.prototype.hasOwnProperty.call(i,t)}var Yb=function(i,t,e,n){t=t||"&",e=e||"=";var r={};if(typeof i!="string"||i.length===0)return r;var o=/\+/g;i=i.split(t);var h=1e3;n&&typeof n.maxKeys=="number"&&(h=n.maxKeys);var l=i.length;h>0&&l>h&&(l=h);for(var c=0;c<l;++c){var f=i[c].replace(o,"%20"),d=f.indexOf(e),g,m,_,x;d>=0?(g=f.substr(0,d),m=f.substr(d+1)):(g=f,m=""),_=decodeURIComponent(g),x=decodeURIComponent(m),Vb(r,_)?Array.isArray(r[_])?r[_].push(x):r[_]=[r[_],x]:r[_]=x}return r},Wr=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},jb=function(i,t,e,n){return t=t||"&",e=e||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(r){var o=encodeURIComponent(Wr(r))+e;return Array.isArray(i[r])?i[r].map(function(h){return o+encodeURIComponent(Wr(h))}).join(t):o+encodeURIComponent(Wr(i[r]))}).join(t):n?encodeURIComponent(Wr(n))+e+encodeURIComponent(Wr(i)):""};ts.decode=ts.parse=Yb;ts.encode=ts.stringify=jb;var qb=ul.exports,bi=$b,Kb=Ko,Zb=hw,Jb=aw;function ci(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Qb=/^([a-z0-9.+-]+:)/i,tw=/:[0-9]*$/,ew=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,iw=["<",">",'"',"`"," ","\r",`
`,"	"],nw=["{","}","|","\\","^","`"].concat(iw),cl=["'"].concat(nw),jf=["%","/","?",";","#"].concat(cl),qf=["/","?","#"],rw=255,Kf=/^[+a-z0-9A-Z_-]{0,63}$/,sw=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,ow={javascript:!0,"javascript:":!0},fl={javascript:!0,"javascript:":!0},lr={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},dl=ts;function Ko(i,t,e){if(i&&bi.isObject(i)&&i instanceof ci)return i;var n=new ci;return n.parse(i,t,e),n}ci.prototype.parse=function(i,t,e){if(!bi.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var n=i.indexOf("?"),r=n!==-1&&n<i.indexOf("#")?"?":"#",o=i.split(r),h=/\\/g;o[0]=o[0].replace(h,"/"),i=o.join(r);var l=i;if(l=l.trim(),!e&&i.split("#").length===1){var c=ew.exec(l);if(c)return this.path=l,this.href=l,this.pathname=c[1],c[2]?(this.search=c[2],t?this.query=dl.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var f=Qb.exec(l);if(f){f=f[0];var d=f.toLowerCase();this.protocol=d,l=l.substr(f.length)}if(e||f||l.match(/^\/\/[^@\/]+@[^@\/]+/)){var g=l.substr(0,2)==="//";g&&!(f&&fl[f])&&(l=l.substr(2),this.slashes=!0)}if(!fl[f]&&(g||f&&!lr[f])){for(var m=-1,_=0;_<qf.length;_++){var x=l.indexOf(qf[_]);x!==-1&&(m===-1||x<m)&&(m=x)}var T,y;m===-1?y=l.lastIndexOf("@"):y=l.lastIndexOf("@",m),y!==-1&&(T=l.slice(0,y),l=l.slice(y+1),this.auth=decodeURIComponent(T)),m=-1;for(var _=0;_<jf.length;_++){var x=l.indexOf(jf[_]);x!==-1&&(m===-1||x<m)&&(m=x)}m===-1&&(m=l.length),this.host=l.slice(0,m),l=l.slice(m),this.parseHost(),this.hostname=this.hostname||"";var E=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!E)for(var S=this.hostname.split(/\./),_=0,A=S.length;_<A;_++){var I=S[_];if(I&&!I.match(Kf)){for(var D="",N=0,L=I.length;N<L;N++)I.charCodeAt(N)>127?D+="x":D+=I[N];if(!D.match(Kf)){var F=S.slice(0,_),V=S.slice(_+1),J=I.match(sw);J&&(F.push(J[1]),V.unshift(J[2])),V.length&&(l="/"+V.join(".")+l),this.hostname=F.join(".");break}}}this.hostname.length>rw?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=qb.toASCII(this.hostname));var $=this.port?":"+this.port:"",Q=this.hostname||"";this.host=Q+$,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),l[0]!=="/"&&(l="/"+l))}if(!ow[d])for(var _=0,A=cl.length;_<A;_++){var X=cl[_];if(l.indexOf(X)!==-1){var G=encodeURIComponent(X);G===X&&(G=escape(X)),l=l.split(X).join(G)}}var dt=l.indexOf("#");dt!==-1&&(this.hash=l.substr(dt),l=l.slice(0,dt));var _t=l.indexOf("?");if(_t!==-1?(this.search=l.substr(_t),this.query=l.substr(_t+1),t&&(this.query=dl.parse(this.query)),l=l.slice(0,_t)):t&&(this.search="",this.query={}),l&&(this.pathname=l),lr[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var $=this.pathname||"",j=this.search||"";this.path=$+j}return this.href=this.format(),this};function aw(i){return bi.isString(i)&&(i=Ko(i)),i instanceof ci?i.format():ci.prototype.format.call(i)}ci.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",n=this.hash||"",r=!1,o="";this.host?r=i+this.host:this.hostname&&(r=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&bi.isObject(this.query)&&Object.keys(this.query).length&&(o=dl.stringify(this.query));var h=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||lr[t])&&r!==!1?(r="//"+(r||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):r||(r=""),n&&n.charAt(0)!=="#"&&(n="#"+n),h&&h.charAt(0)!=="?"&&(h="?"+h),e=e.replace(/[?#]/g,function(l){return encodeURIComponent(l)}),h=h.replace("#","%23"),t+r+e+h+n};function hw(i,t){return Ko(i,!1,!0).resolve(t)}ci.prototype.resolve=function(i){return this.resolveObject(Ko(i,!1,!0)).format()};ci.prototype.resolveObject=function(i){if(bi.isString(i)){var t=new ci;t.parse(i,!1,!0),i=t}for(var e=new ci,n=Object.keys(this),r=0;r<n.length;r++){var o=n[r];e[o]=this[o]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var h=Object.keys(i),l=0;l<h.length;l++){var c=h[l];c!=="protocol"&&(e[c]=i[c])}return lr[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!lr[i.protocol]){for(var f=Object.keys(i),d=0;d<f.length;d++){var g=f[d];e[g]=i[g]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!fl[i.protocol]){for(var A=(i.pathname||"").split("/");A.length&&!(i.host=A.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),A[0]!==""&&A.unshift(""),A.length<2&&A.unshift(""),e.pathname=A.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var m=e.pathname||"",_=e.search||"";e.path=m+_}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var x=e.pathname&&e.pathname.charAt(0)==="/",T=i.host||i.pathname&&i.pathname.charAt(0)==="/",y=T||x||e.host&&i.pathname,E=y,S=e.pathname&&e.pathname.split("/")||[],A=i.pathname&&i.pathname.split("/")||[],I=e.protocol&&!lr[e.protocol];if(I&&(e.hostname="",e.port=null,e.host&&(S[0]===""?S[0]=e.host:S.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(A[0]===""?A[0]=i.host:A.unshift(i.host)),i.host=null),y=y&&(A[0]===""||S[0]==="")),T)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,S=A;else if(A.length)S||(S=[]),S.pop(),S=S.concat(A),e.search=i.search,e.query=i.query;else if(!bi.isNullOrUndefined(i.search)){if(I){e.hostname=e.host=S.shift();var D=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;D&&(e.auth=D.shift(),e.host=e.hostname=D.shift())}return e.search=i.search,e.query=i.query,(!bi.isNull(e.pathname)||!bi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!S.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var N=S.slice(-1)[0],L=(e.host||i.host||S.length>1)&&(N==="."||N==="..")||N==="",F=0,V=S.length;V>=0;V--)N=S[V],N==="."?S.splice(V,1):N===".."?(S.splice(V,1),F++):F&&(S.splice(V,1),F--);if(!y&&!E)for(;F--;F)S.unshift("..");y&&S[0]!==""&&(!S[0]||S[0].charAt(0)!=="/")&&S.unshift(""),L&&S.join("/").substr(-1)!=="/"&&S.push("");var J=S[0]===""||S[0]&&S[0].charAt(0)==="/";if(I){e.hostname=e.host=J?"":S.length?S.shift():"";var D=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;D&&(e.auth=D.shift(),e.host=e.hostname=D.shift())}return y=y||e.host&&S.length,y&&!J&&S.unshift(""),S.length?e.pathname=S.join("/"):(e.pathname=null,e.path=null),(!bi.isNull(e.pathname)||!bi.isNull(e.search))&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};ci.prototype.parseHost=function(){var i=this.host,t=tw.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};const lw={parse:Kb,format:Jb,resolve:Zb};function ii(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function Hr(i){return i.split("?")[0].split("#")[0]}function uw(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function cw(i,t,e){return i.replace(new RegExp(uw(t),"g"),e)}function fw(i,t){let e="",n=0,r=-1,o=0,h=-1;for(let l=0;l<=i.length;++l){if(l<i.length)h=i.charCodeAt(l);else{if(h===47)break;h=47}if(h===47){if(!(r===l-1||o===1))if(r!==l-1&&o===2){if(e.length<2||n!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const c=e.lastIndexOf("/");if(c!==e.length-1){c===-1?(e="",n=0):(e=e.slice(0,c),n=e.length-1-e.lastIndexOf("/")),r=l,o=0;continue}}else if(e.length===2||e.length===1){e="",n=0,r=l,o=0;continue}}t&&(e.length>0?e+="/..":e="..",n=2)}else e.length>0?e+=`/${i.slice(r+1,l)}`:e=i.slice(r+1,l),n=l-r-1;r=l,o=0}else h===46&&o!==-1?++o:o=-1}return e}const fe={toPosix(i){return cw(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){ii(i),i=this.toPosix(i);let t="";const e=/^file:\/\/\//.exec(i),n=/^[^/:]+:\/\//.exec(i),r=/^[^/:]+:\//.exec(i);if(e||n||r){const o=(e==null?void 0:e[0])||(n==null?void 0:n[0])||(r==null?void 0:r[0]);t=o,i=i.slice(o.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;const n=Hr(this.toPosix(t??K.ADAPTER.getBaseUrl())),r=Hr(this.toPosix(e??this.rootname(n)));return ii(i),i=this.toPosix(i),i.startsWith("/")?fe.join(r,i.slice(1)):this.isAbsolute(i)?i:this.join(n,i)},normalize(i){if(i=this.toPosix(i),ii(i),i.length===0)return".";let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const n=i.endsWith("/");return i=fw(i,!1),i.length>0&&n&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return ii(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const n=i[e];if(ii(n),n.length>0)if(t===void 0)t=n;else{const r=i[e-1]??"";this.extname(r)?t+=`/../${n}`:t+=`/${n}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(ii(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let n=-1,r=!0;const o=this.getProtocol(i),h=i;i=i.slice(o.length);for(let l=i.length-1;l>=1;--l)if(t=i.charCodeAt(l),t===47){if(!r){n=l;break}}else r=!1;return n===-1?e?"/":this.isUrl(h)?o+i:o:e&&n===1?"//":o+i.slice(0,n)},rootname(i){ii(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){ii(i),t&&ii(t),i=Hr(this.toPosix(i));let e=0,n=-1,r=!0,o;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let h=t.length-1,l=-1;for(o=i.length-1;o>=0;--o){const c=i.charCodeAt(o);if(c===47){if(!r){e=o+1;break}}else l===-1&&(r=!1,l=o+1),h>=0&&(c===t.charCodeAt(h)?--h===-1&&(n=o):(h=-1,n=l))}return e===n?n=l:n===-1&&(n=i.length),i.slice(e,n)}for(o=i.length-1;o>=0;--o)if(i.charCodeAt(o)===47){if(!r){e=o+1;break}}else n===-1&&(r=!1,n=o+1);return n===-1?"":i.slice(e,n)},extname(i){ii(i),i=Hr(this.toPosix(i));let t=-1,e=0,n=-1,r=!0,o=0;for(let h=i.length-1;h>=0;--h){const l=i.charCodeAt(h);if(l===47){if(!r){e=h+1;break}continue}n===-1&&(r=!1,n=h+1),l===46?t===-1?t=h:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||n===-1||o===0||o===1&&t===n-1&&t===e+1?"":i.slice(t,n)},parse(i){ii(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=Hr(this.toPosix(i));let e=i.charCodeAt(0);const n=this.isAbsolute(i);let r;t.root=this.rootname(i),n||this.hasProtocol(i)?r=1:r=0;let o=-1,h=0,l=-1,c=!0,f=i.length-1,d=0;for(;f>=r;--f){if(e=i.charCodeAt(f),e===47){if(!c){h=f+1;break}continue}l===-1&&(c=!1,l=f+1),e===46?o===-1?o=f:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||l===-1||d===0||d===1&&o===l-1&&o===h+1?l!==-1&&(h===0&&n?t.base=t.name=i.slice(1,l):t.base=t.name=i.slice(h,l)):(h===0&&n?(t.name=i.slice(1,o),t.base=i.slice(1,l)):(t.name=i.slice(h,o),t.base=i.slice(h,l)),t.ext=i.slice(o,l)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"},Zf={};function At(i,t,e=3){if(Zf[t])return;let n=new Error().stack;typeof n>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(n=n.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(n))),Zf[t]=!0}let Ph;function dw(){return typeof Ph>"u"&&(Ph=function(){var e;const t={stencil:!0,failIfMajorPerformanceCaveat:K.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!K.ADAPTER.getWebGLRenderingContext())return!1;const n=K.ADAPTER.createCanvas();let r=n.getContext("webgl",t)||n.getContext("experimental-webgl",t);const o=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const h=r.getExtension("WEBGL_lose_context");h&&h.loseContext()}return r=null,o}catch{return!1}}()),Ph}var pw="#f0f8ff",gw="#faebd7",mw="#00ffff",_w="#7fffd4",vw="#f0ffff",xw="#f5f5dc",yw="#ffe4c4",bw="#000000",ww="#ffebcd",Tw="#0000ff",Ew="#8a2be2",Aw="#a52a2a",Sw="#deb887",Cw="#5f9ea0",Iw="#7fff00",Rw="#d2691e",Pw="#ff7f50",Mw="#6495ed",Dw="#fff8dc",Bw="#dc143c",Fw="#00ffff",Lw="#00008b",Ow="#008b8b",Nw="#b8860b",kw="#a9a9a9",Uw="#006400",Gw="#a9a9a9",Ww="#bdb76b",Hw="#8b008b",Xw="#556b2f",zw="#ff8c00",$w="#9932cc",Vw="#8b0000",Yw="#e9967a",jw="#8fbc8f",qw="#483d8b",Kw="#2f4f4f",Zw="#2f4f4f",Jw="#00ced1",Qw="#9400d3",tT="#ff1493",eT="#00bfff",iT="#696969",nT="#696969",rT="#1e90ff",sT="#b22222",oT="#fffaf0",aT="#228b22",hT="#ff00ff",lT="#dcdcdc",uT="#f8f8ff",cT="#daa520",fT="#ffd700",dT="#808080",pT="#008000",gT="#adff2f",mT="#808080",_T="#f0fff0",vT="#ff69b4",xT="#cd5c5c",yT="#4b0082",bT="#fffff0",wT="#f0e68c",TT="#fff0f5",ET="#e6e6fa",AT="#7cfc00",ST="#fffacd",CT="#add8e6",IT="#f08080",RT="#e0ffff",PT="#fafad2",MT="#d3d3d3",DT="#90ee90",BT="#d3d3d3",FT="#ffb6c1",LT="#ffa07a",OT="#20b2aa",NT="#87cefa",kT="#778899",UT="#778899",GT="#b0c4de",WT="#ffffe0",HT="#00ff00",XT="#32cd32",zT="#faf0e6",$T="#ff00ff",VT="#800000",YT="#66cdaa",jT="#0000cd",qT="#ba55d3",KT="#9370db",ZT="#3cb371",JT="#7b68ee",QT="#00fa9a",tE="#48d1cc",eE="#c71585",iE="#191970",nE="#f5fffa",rE="#ffe4e1",sE="#ffe4b5",oE="#ffdead",aE="#000080",hE="#fdf5e6",lE="#808000",uE="#6b8e23",cE="#ffa500",fE="#ff4500",dE="#da70d6",pE="#eee8aa",gE="#98fb98",mE="#afeeee",_E="#db7093",vE="#ffefd5",xE="#ffdab9",yE="#cd853f",bE="#ffc0cb",wE="#dda0dd",TE="#b0e0e6",EE="#800080",AE="#663399",SE="#ff0000",CE="#bc8f8f",IE="#4169e1",RE="#8b4513",PE="#fa8072",ME="#f4a460",DE="#2e8b57",BE="#fff5ee",FE="#a0522d",LE="#c0c0c0",OE="#87ceeb",NE="#6a5acd",kE="#708090",UE="#708090",GE="#fffafa",WE="#00ff7f",HE="#4682b4",XE="#d2b48c",zE="#008080",$E="#d8bfd8",VE="#ff6347",YE="#40e0d0",jE="#ee82ee",qE="#f5deb3",KE="#ffffff",ZE="#f5f5f5",JE="#ffff00",QE="#9acd32",tA={aliceblue:pw,antiquewhite:gw,aqua:mw,aquamarine:_w,azure:vw,beige:xw,bisque:yw,black:bw,blanchedalmond:ww,blue:Tw,blueviolet:Ew,brown:Aw,burlywood:Sw,cadetblue:Cw,chartreuse:Iw,chocolate:Rw,coral:Pw,cornflowerblue:Mw,cornsilk:Dw,crimson:Bw,cyan:Fw,darkblue:Lw,darkcyan:Ow,darkgoldenrod:Nw,darkgray:kw,darkgreen:Uw,darkgrey:Gw,darkkhaki:Ww,darkmagenta:Hw,darkolivegreen:Xw,darkorange:zw,darkorchid:$w,darkred:Vw,darksalmon:Yw,darkseagreen:jw,darkslateblue:qw,darkslategray:Kw,darkslategrey:Zw,darkturquoise:Jw,darkviolet:Qw,deeppink:tT,deepskyblue:eT,dimgray:iT,dimgrey:nT,dodgerblue:rT,firebrick:sT,floralwhite:oT,forestgreen:aT,fuchsia:hT,gainsboro:lT,ghostwhite:uT,goldenrod:cT,gold:fT,gray:dT,green:pT,greenyellow:gT,grey:mT,honeydew:_T,hotpink:vT,indianred:xT,indigo:yT,ivory:bT,khaki:wT,lavenderblush:TT,lavender:ET,lawngreen:AT,lemonchiffon:ST,lightblue:CT,lightcoral:IT,lightcyan:RT,lightgoldenrodyellow:PT,lightgray:MT,lightgreen:DT,lightgrey:BT,lightpink:FT,lightsalmon:LT,lightseagreen:OT,lightskyblue:NT,lightslategray:kT,lightslategrey:UT,lightsteelblue:GT,lightyellow:WT,lime:HT,limegreen:XT,linen:zT,magenta:$T,maroon:VT,mediumaquamarine:YT,mediumblue:jT,mediumorchid:qT,mediumpurple:KT,mediumseagreen:ZT,mediumslateblue:JT,mediumspringgreen:QT,mediumturquoise:tE,mediumvioletred:eE,midnightblue:iE,mintcream:nE,mistyrose:rE,moccasin:sE,navajowhite:oE,navy:aE,oldlace:hE,olive:lE,olivedrab:uE,orange:cE,orangered:fE,orchid:dE,palegoldenrod:pE,palegreen:gE,paleturquoise:mE,palevioletred:_E,papayawhip:vE,peachpuff:xE,peru:yE,pink:bE,plum:wE,powderblue:TE,purple:EE,rebeccapurple:AE,red:SE,rosybrown:CE,royalblue:IE,saddlebrown:RE,salmon:PE,sandybrown:ME,seagreen:DE,seashell:BE,sienna:FE,silver:LE,skyblue:OE,slateblue:NE,slategray:kE,slategrey:UE,snow:GE,springgreen:WE,steelblue:HE,tan:XE,teal:zE,thistle:$E,tomato:VE,turquoise:YE,violet:jE,wheat:qE,white:KE,whitesmoke:ZE,yellow:JE,yellowgreen:QE};function es(i,t=[]){return t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,t}function ep(i){let t=i.toString(16);return t="000000".substring(0,6-t.length)+t,`#${t}`}function Gl(i){if(typeof i=="string"&&(i=tA[i.toLowerCase()]||i,i[0]==="#"&&(i=i.slice(1)),i.length===3)){const[t,e,n]=i;i=t+t+e+e+n+n}return parseInt(i,16)}function eA(){const i=[],t=[];for(let n=0;n<32;n++)i[n]=n,t[n]=n;i[lt.NORMAL_NPM]=lt.NORMAL,i[lt.ADD_NPM]=lt.ADD,i[lt.SCREEN_NPM]=lt.SCREEN,t[lt.NORMAL]=lt.NORMAL_NPM,t[lt.ADD]=lt.ADD_NPM,t[lt.SCREEN]=lt.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const ip=eA();function np(i,t){return ip[t?1:0][i]}function iA(i,t,e,n){return e=e||new Float32Array(4),n||n===void 0?(e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t):(e[0]=i[0],e[1]=i[1],e[2]=i[2]),e[3]=t,e}function Wl(i,t){if(t===1)return(t*255<<24)+i;if(t===0)return 0;let e=i>>16&255,n=i>>8&255,r=i&255;return e=e*t+.5|0,n=n*t+.5|0,r=r*t+.5|0,(t*255<<24)+(e<<16)+(n<<8)+r}function rp(i,t,e,n){return e=e||new Float32Array(4),e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,(n||n===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function nA(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let n=0,r=0;n<e;n+=6,r+=4)t[n+0]=r+0,t[n+1]=r+1,t[n+2]=r+2,t[n+3]=r+0,t[n+4]=r+2,t[n+5]=r+3;return t}function sp(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function Bo(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Jf(i){return!(i&i-1)&&!!i}function Qf(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function ur(i,t,e){const n=i.length;let r;if(t>=n||e===0)return;e=t+e>n?n-t:e;const o=n-e;for(r=t;r<o;++r)i[r]=i[r+e];i.length=o}function or(i){return i===0?0:i<0?-1:1}let rA=0;function Fn(){return++rA}const op=class{constructor(i,t,e,n){this.left=i,this.top=t,this.right=e,this.bottom=n}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let pl=op;pl.EMPTY=new op(0,0,0,0);const td={},xi=Object.create(null),nn=Object.create(null);class ed{constructor(t,e,n){this._canvas=K.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||K.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function id(i,t,e){for(let n=0,r=4*e*t;n<t;++n,r+=4)if(i[r+3]!==0)return!1;return!0}function nd(i,t,e,n,r){const o=4*t;for(let h=n,l=n*o+4*e;h<=r;++h,l+=o)if(i[l+3]!==0)return!1;return!0}function sA(i){const{width:t,height:e}=i,n=i.getContext("2d",{willReadFrequently:!0});if(n===null)throw new TypeError("Failed to get canvas 2D context");const o=n.getImageData(0,0,t,e).data;let h=0,l=0,c=t-1,f=e-1;for(;l<e&&id(o,t,l);)++l;if(l===e)return pl.EMPTY;for(;id(o,t,f);)--f;for(;nd(o,t,h,l,f);)++h;for(;nd(o,t,c,l,f);)--c;return++c,++f,new pl(h,l,c,f)}function oA(i){const t=sA(i),{width:e,height:n}=t;let r=null;if(!t.isEmpty()){const o=i.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");r=o.getImageData(t.left,t.top,e,n)}return{width:e,height:n,data:r}}let no;function aA(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,no||(no=document.createElement("a")),no.href=i;const e=lw.parse(no.href),n=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!n||e.protocol!==t.protocol?"anonymous":""}function hn(i,t=1){var n;const e=(n=K.RETINA_PREFIX)==null?void 0:n.exec(i);return e?parseFloat(e[1]):t}var q=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(q||{});const gl=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},rd=(i,t)=>gl(i).priority??t,rt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(gl).forEach(t=>{t.type.forEach(e=>{var n,r;return(r=(n=this._removeHandlers)[e])==null?void 0:r.call(n,t)})}),this},add(...i){return i.map(gl).forEach(t=>{t.type.forEach(e=>{const n=this._addHandlers,r=this._queue;n[e]?n[e](t):(r[e]=r[e]||[],r[e].push(t))})}),this},handle(i,t,e){const n=this._addHandlers,r=this._removeHandlers;if(n[i]||r[i])throw new Error(`Extension type ${i} already has a handler`);n[i]=t,r[i]=e;const o=this._queue;return o[i]&&(o[i].forEach(h=>t(h)),delete o[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,n=>{t.includes(n.ref)||(t.push(n.ref),t.sort((r,o)=>rd(o,e)-rd(r,e)))},n=>{const r=t.indexOf(n.ref);r!==-1&&t.splice(r,1)})}};class ml{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const hA=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function lA(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function uA(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const n=hA.replace(/%forloop%/gi,lA(i));if(t.shaderSource(e,n),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Mh=0,Dh=1,Bh=2,Fh=3,Lh=4,Oh=5;class Vi{constructor(){this.data=0,this.blendMode=lt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Mh)}set blend(t){!!(this.data&1<<Mh)!==t&&(this.data^=1<<Mh)}get offsets(){return!!(this.data&1<<Dh)}set offsets(t){!!(this.data&1<<Dh)!==t&&(this.data^=1<<Dh)}get culling(){return!!(this.data&1<<Bh)}set culling(t){!!(this.data&1<<Bh)!==t&&(this.data^=1<<Bh)}get depthTest(){return!!(this.data&1<<Fh)}set depthTest(t){!!(this.data&1<<Fh)!==t&&(this.data^=1<<Fh)}get depthMask(){return!!(this.data&1<<Oh)}set depthMask(t){!!(this.data&1<<Oh)!==t&&(this.data^=1<<Oh)}get clockwiseFrontFace(){return!!(this.data&1<<Lh)}set clockwiseFrontFace(t){!!(this.data&1<<Lh)!==t&&(this.data^=1<<Lh)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==lt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Vi;return t.depthTest=!1,t.blend=!0,t}}const _l=[];function ap(i,t){if(!i)return null;let e="";if(typeof i=="string"){const n=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);n&&(e=n[1].toLowerCase())}for(let n=_l.length-1;n>=0;--n){const r=_l[n];if(r.test&&r.test(i,e))return new r(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class fi{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,n,r,o,h,l,c){if(arguments.length>8)throw new Error("max arguments reached");const{name:f,items:d}=this;this._aliasCount++;for(let g=0,m=d.length;g<m;g++)d[g][f](t,e,n,r,o,h,l,c);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(fi.prototype,{dispatch:{value:fi.prototype.emit},run:{value:fi.prototype.emit}});class is{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new fi("setRealSize"),this.onUpdate=new fi("update"),this.onError=new fi("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class os extends is{constructor(t,e){const{width:n,height:r}=e||{};if(!n||!r)throw new Error("BufferResource width or height invalid");super(n,r),this.data=t}upload(t,e,n){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===pi.UNPACK);const o=e.realWidth,h=e.realHeight;return n.width===o&&n.height===h?r.texSubImage2D(e.target,0,0,0,o,h,e.format,n.type,this.data):(n.width=o,n.height=h,r.texImage2D(e.target,0,n.internalFormat,o,h,0,e.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const cA={scaleMode:Gi.NEAREST,format:z.RGBA,alphaMode:pi.NPM},ir=class extends ss{constructor(i=null,t=null){super(),t=Object.assign({},ir.defaultOptions,t);const{alphaMode:e,mipmap:n,anisotropicLevel:r,scaleMode:o,width:h,height:l,wrapMode:c,format:f,type:d,target:g,resolution:m,resourceOptions:_}=t;i&&!(i instanceof is)&&(i=ap(i,_),i.internal=!0),this.resolution=m||K.RESOLUTION,this.width=Math.round((h||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=r,this._wrapMode=c,this._scaleMode=o,this.format=f,this.type=d,this.target=g,this.alphaMode=e,this.uid=Fn(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=h>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return e=e||this.resolution,this.setRealSize(i*e,t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Jf(this.realWidth)&&Jf(this.realHeight)}setResolution(i){const t=this.resolution;return t===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete nn[this.cacheId],delete xi[this.cacheId],this.cacheId=null),this.dispose(),ir.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=K.STRICT_TEXTURE_CACHE){const n=typeof i=="string";let r=null;if(n)r=i;else{if(!i._pixiId){const h=(t==null?void 0:t.pixiIdPrefix)||"pixiid";i._pixiId=`${h}_${Fn()}`}r=i._pixiId}let o=nn[r];if(n&&e&&!o)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return o||(o=new ir(i,t),o.cacheId=r,ir.addToCache(o,r)),o}static fromBuffer(i,t,e,n){i=i||new Float32Array(t*e*4);const r=new os(i,{width:t,height:e}),o=i instanceof Float32Array?st.FLOAT:st.UNSIGNED_BYTE;return new ir(r,Object.assign({},cA,n||{width:t,height:e,type:o}))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),nn[t]&&nn[t]!==i&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),nn[t]=i)}static removeFromCache(i){if(typeof i=="string"){const t=nn[i];if(t){const e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete nn[i],t}}else if(i!=null&&i.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete nn[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}};let ft=ir;ft.defaultOptions={mipmap:Si.POW2,anisotropicLevel:0,scaleMode:Gi.LINEAR,wrapMode:an.CLAMP,alphaMode:pi.UNPACK,target:hr.TEXTURE_2D,format:z.RGBA,type:st.UNSIGNED_BYTE};ft._globalBatch=0;class vl{constructor(){this.texArray=null,this.blend=0,this.type=wi.TRIANGLES,this.start=0,this.size=0,this.data=null}}let fA=0;class Zt{constructor(t,e=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=fA++,this.disposeRunner=new fi("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Ti.ELEMENT_ARRAY_BUFFER:Ti.ARRAY_BUFFER}get index(){return this.type===Ti.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Zt(t)}}class Fo{constructor(t,e=0,n=!1,r=st.FLOAT,o,h,l,c=1){this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=o,this.start=h,this.instance=l,this.divisor=c}destroy(){this.buffer=null}static from(t,e,n,r,o){return new Fo(t,e,n,r,o)}}const dA={Float32Array,Uint32Array,Int32Array,Uint8Array};function pA(i,t){let e=0,n=0;const r={};for(let c=0;c<i.length;c++)n+=t[c],e+=i[c].length;const o=new ArrayBuffer(e*4);let h=null,l=0;for(let c=0;c<i.length;c++){const f=t[c],d=i[c],g=sp(d);r[g]||(r[g]=new dA[g](o)),h=r[g];for(let m=0;m<d.length;m++){const _=(m/f|0)*n+l,x=m%f;h[_+x]=d[m]}l+=f}return new Float32Array(o)}const sd={5126:4,5123:2,5121:1};let gA=0;const mA={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ln{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=gA++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new fi("disposeGeometry"),this.refCount=0}addAttribute(t,e,n=0,r=!1,o,h,l,c=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Zt||(e instanceof Array&&(e=new Float32Array(e)),e=new Zt(e));const f=t.split("|");if(f.length>1){for(let g=0;g<f.length;g++)this.addAttribute(f[g],e,n,r,o);return this}let d=this.buffers.indexOf(e);return d===-1&&(this.buffers.push(e),d=this.buffers.length-1),this.attributes[t]=new Fo(d,n,r,o,h,l,c),this.instanced=this.instanced||c,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof Zt||(t instanceof Array&&(t=new Uint16Array(t)),t=new Zt(t)),t.type=Ti.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],n=new Zt;let r;for(r in this.attributes){const o=this.attributes[r],h=this.buffers[o.buffer];t.push(h.data),e.push(o.size*sd[o.type]/4),o.buffer=0}for(n.data=pA(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new ln;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new Zt(this.buffers[e].data.slice(0));for(const e in this.attributes){const n=this.attributes[e];t.attributes[e]=new Fo(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Ti.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new ln,n=[],r=[],o=[];let h;for(let l=0;l<t.length;l++){h=t[l];for(let c=0;c<h.buffers.length;c++)r[c]=r[c]||0,r[c]+=h.buffers[c].data.length,o[c]=0}for(let l=0;l<h.buffers.length;l++)n[l]=new mA[sp(h.buffers[l].data)](r[l]),e.buffers[l]=new Zt(n[l]);for(let l=0;l<t.length;l++){h=t[l];for(let c=0;c<h.buffers.length;c++)n[c].set(h.buffers[c].data,o[c]),o[c]+=h.buffers[c].data.length}if(e.attributes=h.attributes,h.indexBuffer){e.indexBuffer=e.buffers[h.buffers.indexOf(h.indexBuffer)],e.indexBuffer.type=Ti.ELEMENT_ARRAY_BUFFER;let l=0,c=0,f=0,d=0;for(let g=0;g<h.buffers.length;g++)if(h.buffers[g]!==h.indexBuffer){d=g;break}for(const g in h.attributes){const m=h.attributes[g];(m.buffer|0)===d&&(c+=m.size*sd[m.type]/4)}for(let g=0;g<t.length;g++){const m=t[g].indexBuffer.data;for(let _=0;_<m.length;_++)e.indexBuffer.data[_+f]+=l;l+=t[g].buffers[d].data.length/c,f+=m.length}}return e}}class hp extends ln{constructor(t=!1){super(),this._buffer=new Zt(null,t,!1),this._indexBuffer=new Zt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,st.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,st.FLOAT).addAttribute("aColor",this._buffer,4,!0,st.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,st.FLOAT).addIndex(this._indexBuffer)}}const Lo=Math.PI*2,_A=180/Math.PI,vA=Math.PI/180;var ce=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(ce||{});class Et{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Et(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const ro=[new Et,new Et,new Et,new Et];class wt{constructor(t=0,e=0,n=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=ce.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new wt(0,0,0,0)}clone(){return new wt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const F=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=F)return!1;const J=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>J}const n=this.left,r=this.right,o=this.top,h=this.bottom;if(r<=n||h<=o)return!1;const l=ro[0].set(t.left,t.top),c=ro[1].set(t.left,t.bottom),f=ro[2].set(t.right,t.top),d=ro[3].set(t.right,t.bottom);if(f.x<=l.x||c.y<=l.y)return!1;const g=Math.sign(e.a*e.d-e.b*e.c);if(g===0||(e.apply(l,l),e.apply(c,c),e.apply(f,f),e.apply(d,d),Math.max(l.x,c.x,f.x,d.x)<=n||Math.min(l.x,c.x,f.x,d.x)>=r||Math.max(l.y,c.y,f.y,d.y)<=o||Math.min(l.y,c.y,f.y,d.y)>=h))return!1;const m=g*(c.y-l.y),_=g*(l.x-c.x),x=m*n+_*o,T=m*r+_*o,y=m*n+_*h,E=m*r+_*h;if(Math.max(x,T,y,E)<=m*l.x+_*l.y||Math.min(x,T,y,E)>=m*d.x+_*d.y)return!1;const S=g*(l.y-f.y),A=g*(f.x-l.x),I=S*n+A*o,D=S*r+A*o,N=S*n+A*h,L=S*r+A*h;return!(Math.max(I,D,N,L)<=S*l.x+A*l.y||Math.min(I,D,N,L)>=S*d.x+A*d.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(o-r,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=r,this.height=o-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Hl{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.radius=n,this.type=ce.CIRC}clone(){return new Hl(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let r=this.x-t,o=this.y-e;return r*=r,o*=o,r+o<=n}getBounds(){return new wt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Xl{constructor(t=0,e=0,n=0,r=0){this.x=t,this.y=e,this.width=n,this.height=r,this.type=ce.ELIP}clone(){return new Xl(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,r=(e-this.y)/this.height;return n*=n,r*=r,n+r<=1}getBounds(){return new wt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class cr{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const n=[];for(let r=0,o=e.length;r<o;r++)n.push(e[r].x,e[r].y);e=n}this.points=e,this.type=ce.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new cr(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let n=!1;const r=this.points.length/2;for(let o=0,h=r-1;o<r;h=o++){const l=this.points[o*2],c=this.points[o*2+1],f=this.points[h*2],d=this.points[h*2+1];c>e!=d>e&&t<(f-l)*((e-c)/(d-c))+l&&(n=!n)}return n}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}}class zl{constructor(t=0,e=0,n=0,r=0,o=20){this.x=t,this.y=e,this.width=n,this.height=r,this.radius=o,this.type=ce.RREC}clone(){return new zl(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let r=t-(this.x+n),o=e-(this.y+n);const h=n*n;if(r*r+o*o<=h||(r=t-(this.x+this.width-n),r*r+o*o<=h)||(o=e-(this.y+this.height-n),r*r+o*o<=h)||(r=t-(this.x+n),r*r+o*o<=h))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Gt{constructor(t=1,e=0,n=0,r=1,o=0,h=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=r,this.tx=o,this.ty=h}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,r,o,h){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=o,this.ty=h,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new Et;const n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e}applyInverse(t,e){e=e||new Et;const n=1/(this.a*this.d+this.c*-this.b),r=t.x,o=t.y;return e.x=this.d*n*r+-this.c*n*o+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*o+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.a,o=this.c,h=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=o*e-this.d*n,this.d=o*n+this.d*e,this.tx=h*e-this.ty*n,this.ty=h*n+this.ty*e,this}append(t){const e=this.a,n=this.b,r=this.c,o=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*o,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*o,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*o+this.ty,this}setTransform(t,e,n,r,o,h,l,c,f){return this.a=Math.cos(l+f)*o,this.b=Math.sin(l+f)*o,this.c=-Math.sin(l-c)*h,this.d=Math.cos(l-c)*h,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const n=this.a,r=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,r=this.c,o=this.d,h=t.pivot,l=-Math.atan2(-r,o),c=Math.atan2(n,e),f=Math.abs(l+c);return f<1e-5||Math.abs(Lo-f)<1e-5?(t.rotation=c,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=l,t.skew.y=c),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+o*o),t.position.x=this.tx+(h.x*e+h.y*r),t.position.y=this.ty+(h.x*n+h.y*o),t}invert(){const t=this.a,e=this.b,n=this.c,r=this.d,o=this.tx,h=t*r-e*n;return this.a=r/h,this.b=-e/h,this.c=-n/h,this.d=t/h,this.tx=(n*this.ty-r*o)/h,this.ty=-(t*this.ty-e*o)/h,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Gt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Gt}static get TEMP_MATRIX(){return new Gt}}const An=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Sn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Cn=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],In=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],xl=[],lp=[],so=Math.sign;function xA(){for(let i=0;i<16;i++){const t=[];xl.push(t);for(let e=0;e<16;e++){const n=so(An[i]*An[e]+Cn[i]*Sn[e]),r=so(Sn[i]*An[e]+In[i]*Sn[e]),o=so(An[i]*Cn[e]+Cn[i]*In[e]),h=so(Sn[i]*Cn[e]+In[i]*In[e]);for(let l=0;l<16;l++)if(An[l]===n&&Sn[l]===r&&Cn[l]===o&&In[l]===h){t.push(l);break}}}for(let i=0;i<16;i++){const t=new Gt;t.set(An[i],Sn[i],Cn[i],In[i],0,0),lp.push(t)}}xA();const Ht={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>An[i],uY:i=>Sn[i],vX:i=>Cn[i],vY:i=>In[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>xl[i][t],sub:(i,t)=>xl[i][Ht.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Ht.S:Ht.N:Math.abs(t)*2<=Math.abs(i)?i>0?Ht.E:Ht.W:t>0?i>0?Ht.SE:Ht.SW:i>0?Ht.NE:Ht.NW,matrixAppendRotationInv:(i,t,e=0,n=0)=>{const r=lp[Ht.inv(t)];r.tx=e,r.ty=n,i.append(r)}};class on{constructor(t,e,n=0,r=0){this._x=n,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new on(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=${0} y=${0} scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const up=class{constructor(){this.worldTransform=new Gt,this.localTransform=new Gt,this.position=new on(this.onChange,this,0,0),this.scale=new on(this.onChange,this,1,1),this.pivot=new on(this.onChange,this,0,0),this.skew=new on(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,n=this.worldTransform;n.a=t.a*e.a+t.b*e.c,n.b=t.a*e.b+t.b*e.d,n.c=t.c*e.a+t.d*e.c,n.d=t.c*e.b+t.d*e.d,n.tx=t.tx*e.a+t.ty*e.c+e.tx,n.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let $l=up;$l.IDENTITY=new up;var yA=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,bA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function od(i,t,e){const n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}function Nh(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function cp(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Nh(2*t);case"bvec3":return Nh(3*t);case"bvec4":return Nh(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const fr=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],wA={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},TA={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function EA(i,t){var n;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in i.uniforms){const o=t[r];if(!o){(n=i.uniforms[r])!=null&&n.group&&(i.uniforms[r].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const h=i.uniforms[r];let l=!1;for(let c=0;c<fr.length;c++)if(fr[c].test(o,h)){e.push(fr[c].code(r,h)),l=!0;break}if(!l){const f=(o.size===1&&!o.isArray?wA:TA)[o.type].replace("location",`ud["${r}"].location`);e.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${f};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const fp={};let tr=fp;function AA(){if(tr===fp||tr!=null&&tr.isContextLost()){const i=K.ADAPTER.createCanvas();let t;K.PREFER_ENV>=On.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),tr=t}return tr}let oo;function SA(){if(!oo){oo=qe.MEDIUM;const i=AA();i&&i.getShaderPrecisionFormat&&(oo=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?qe.HIGH:qe.MEDIUM)}return oo}function ad(i,t){const e=i.getShaderSource(t).split(`
`).map((f,d)=>`${d}: ${f}`),n=i.getShaderInfoLog(t),r=n.split(`
`),o={},h=r.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!o[f]?(o[f]=!0,!0):!1),l=[""];h.forEach(f=>{e[f-1]=`%c${e[f-1]}%c`,l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const c=e.join(`
`);l[0]=c,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...l),console.groupEnd()}function CA(i,t,e,n){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||ad(i,e),i.getShaderParameter(n,i.COMPILE_STATUS)||ad(i,n),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const IA={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function dp(i){return IA[i]}let ao=null;const hd={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function pp(i,t){if(!ao){const e=Object.keys(hd);ao={};for(let n=0;n<e.length;++n){const r=e[n];ao[i[r]]=hd[r]}}return ao[t]}function ld(i,t,e){if(i.substring(0,9)!=="precision"){let n=t;return t===qe.HIGH&&e!==qe.HIGH&&(n=qe.MEDIUM),`precision ${n} float;
${i}`}else if(e!==qe.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Xr;function RA(){if(typeof Xr=="boolean")return Xr;try{Xr=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Xr=!1}return Xr}let PA=0;const ho={},nr=class{constructor(i,t,e="pixi-shader",n={}){this.extra={},this.id=PA++,this.vertexSrc=i||nr.defaultVertexSrc,this.fragmentSrc=t||nr.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(e=e.replace(/\s+/g,"-"),ho[e]?(ho[e]++,e+=`-${ho[e]}`):ho[e]=1,this.vertexSrc=`#define SHADER_NAME ${e}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${e}
${this.fragmentSrc}`,this.vertexSrc=ld(this.vertexSrc,nr.defaultVertexPrecision,qe.HIGH),this.fragmentSrc=ld(this.fragmentSrc,nr.defaultFragmentPrecision,SA())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return bA}static get defaultFragmentSrc(){return yA}static from(i,t,e){const n=i+t;let r=td[n];return r||(td[n]=r=new nr(i,t,e)),r}};let li=nr;li.defaultVertexPrecision=qe.HIGH;li.defaultFragmentPrecision=Wi.apple.device?qe.HIGH:qe.MEDIUM;let MA=0;class di{constructor(t,e,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=MA++,this.static=!!e,this.ubo=!!n,t instanceof Zt?(this.buffer=t,this.buffer.type=Ti.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new Zt(new Float32Array(1)),this.buffer.type=Ti.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,n){if(!this.ubo)this.uniforms[t]=new di(e,n);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,n){return new di(t,e,n)}static uboFrom(t,e){return new di(t,e??!0,!0)}}class Ei{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof di?this.uniformGroup=e:this.uniformGroup=new di(e):this.uniformGroup=new di({}),this.disposeRunner=new fi("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const n in e.uniforms){const r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,n){const r=li.from(t,e);return new Ei(r,n)}}class DA{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const n=new Int32Array(t);for(let o=0;o<t;o++)n[o]=o;this.defaultGroupCache[t]=di.from({uSamplers:n},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new li(this.vertexSrc,r)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Gt,default:this.defaultGroupCache[t]};return new Ei(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let n=0;n<t;n++)n>0&&(e+=`
else `),n<t-1&&(e+=`if(vTextureId < ${n}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${n}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class yl{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function BA(){return!Wi.apple.device}function FA(i){let t=!0;const e=K.ADAPTER.getNavigator();if(Wi.tablet||Wi.phone){if(Wi.apple.device){const n=e.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)<11&&(t=!1)}if(Wi.android.device){const n=e.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)<7&&(t=!1)}}return t?i:4}class Zo{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var LA=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,OA=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const ri=class extends Zo{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=hp,this.vertexSize=6,this.state=Vi.for2d(),this.size=ri.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??FA(32),this._defaultMaxTextures}static set defaultMaxTextures(i){this._defaultMaxTextures=i}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??BA(),this._canUploadSameBuffer}static set canUploadSameBuffer(i){this._canUploadSameBuffer=i}get MAX_TEXTURES(){return At("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return OA}static get defaultFragmentTemplate(){return LA}setShaderGenerator({vertex:i=ri.defaultVertexSrc,fragment:t=ri.defaultFragmentTemplate}={}){this.shaderGenerator=new DA(i,t)}contextChange(){const i=this.renderer.gl;K.PREFER_ENV===On.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),ri.defaultMaxTextures),this.maxTextures=uA(this.maxTextures,i)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:t}=ri,e=this.size/4,n=Math.floor(e/this.maxTextures)+1;for(;i.length<e;)i.push(new vl);for(;t.length<n;)t.push(new yl);for(let r=0;r<this.maxTextures;r++)this._tempBoundTextures[r]=null}onPrerender(){this._flushId=0}render(i){i._texture.valid&&(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,maxTextures:t}=this,e=ri._textureArrayPool,n=this.renderer.batch,r=this._tempBoundTextures,o=this.renderer.textureGC.count;let h=++ft._globalBatch,l=0,c=e[0],f=0;n.copyBoundTextures(r,t);for(let d=0;d<this._bufferSize;++d){const g=i[d];i[d]=null,g._batchEnabled!==h&&(c.count>=t&&(n.boundArray(c,r,h,t),this.buildDrawCalls(c,f,d),f=d,c=e[++l],++h),g._batchEnabled=h,g.touched=o,c.elements[c.count++]=g)}c.count>0&&(n.boundArray(c,r,h,t),this.buildDrawCalls(c,f,this._bufferSize),++l,++h);for(let d=0;d<r.length;d++)r[d]=null;ft._globalBatch=h}buildDrawCalls(i,t,e){const{_bufferedElements:n,_attributeBuffer:r,_indexBuffer:o,vertexSize:h}=this,l=ri._drawCallPool;let c=this._dcIndex,f=this._aIndex,d=this._iIndex,g=l[c];g.start=this._iIndex,g.texArray=i;for(let m=t;m<e;++m){const _=n[m],x=_._texture.baseTexture,T=ip[x.alphaMode?1:0][_.blendMode];n[m]=null,t<m&&g.blend!==T&&(g.size=d-g.start,t=m,g=l[++c],g.texArray=i,g.start=d),this.packInterleavedGeometry(_,r,o,f,d),f+=_.vertexData.length/2*h,d+=_.indices.length,g.blend=T}t<e&&(g.size=d-g.start,++c),this._dcIndex=c,this._aIndex=f,this._iIndex=d}bindAndClearTexArray(i){const t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;ri.canUploadSameBuffer?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:t,state:e}=this.renderer,n=ri._drawCallPool;let r=null;for(let o=0;o<i;o++){const{texArray:h,type:l,size:c,start:f,blend:d}=n[o];r!==h&&(r=h,this.bindAndClearTexArray(h)),this.state.blendMode=d,e.set(this.state),t.drawElements(l,c,t.UNSIGNED_SHORT,f*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),ri.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const t=Bo(Math.ceil(i/8)),e=Qf(t),n=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let r=this._aBuffers[n];return r||(this._aBuffers[n]=r=new ml(n*this.vertexSize*4)),r}getIndexBuffer(i){const t=Bo(Math.ceil(i/12)),e=Qf(t),n=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let r=this._iBuffers[e];return r||(this._iBuffers[e]=r=new Uint16Array(n)),r}packInterleavedGeometry(i,t,e,n,r){const{uint32View:o,float32View:h}=t,l=n/this.vertexSize,c=i.uvs,f=i.indices,d=i.vertexData,g=i._texture.baseTexture._batchLocation,m=Math.min(i.worldAlpha,1),_=m<1&&i._texture.baseTexture.alphaMode?Wl(i._tintRGB,m):i._tintRGB+(m*255<<24);for(let x=0;x<d.length;x+=2)h[n++]=d[x],h[n++]=d[x+1],h[n++]=c[x],h[n++]=c[x+1],o[n++]=_,h[n++]=g;for(let x=0;x<f.length;x++)e[r++]=l+f[x]}};let ai=ri;ai.defaultBatchSize=4096;ai.extension={name:"batch",type:q.RendererPlugin};ai._drawCallPool=[];ai._textureArrayPool=[];rt.add(ai);var NA=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,kA=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Yr=class extends Ei{constructor(i,t,e){const n=li.from(i||Yr.defaultVertexSrc,t||Yr.defaultFragmentSrc);super(n,e),this.padding=0,this.resolution=Yr.defaultResolution,this.multisample=Yr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Vi}apply(i,t,e,n,r){i.applyFilter(this,t,e,n)}get blendMode(){return this.state.blendMode}set blendMode(i){this.state.blendMode=i}get resolution(){return this._resolution}set resolution(i){this._resolution=i}static get defaultVertexSrc(){return kA}static get defaultFragmentSrc(){return NA}};let be=Yr;be.defaultResolution=1;be.defaultMultisample=te.NONE;class gp{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color=typeof t.color=="string"?Gl(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=ep(t),es(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}gp.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"background"};rt.add(gp);class mp{constructor(t){this.renderer=t,this.emptyRenderer=new Zo(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:n}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=n[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,n,r){const{elements:o,ids:h,count:l}=t;let c=0;for(let f=0;f<l;f++){const d=o[f],g=d._batchLocation;if(g>=0&&g<r&&e[g]===d){h[f]=g;continue}for(;c<r;){const m=e[c];if(m&&m._batchEnabled===n&&m._batchLocation===c){c++;continue}h[f]=c,d._batchLocation=c,e[c]=d;break}}}destroy(){this.renderer=null}}mp.extension={type:q.RendererSystem,name:"batch"};rt.add(mp);let ud=0;class _p{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ud++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ud++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let n;if(K.PREFER_ENV>=On.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}_p.extension={type:q.RendererSystem,name:"context"};rt.add(_p);class UA extends os{upload(t,e,n){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===pi.UNPACK);const o=e.realWidth,h=e.realHeight;return n.width===o&&n.height===h?r.texSubImage2D(e.target,0,0,0,o,h,e.format,n.type,this.data):(n.width=o,n.height=h,r.texImage2D(e.target,0,n.internalFormat,o,h,0,e.format,n.type,this.data)),!0}}class bl{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new fi("disposeFramebuffer"),this.multisample=te.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new ft(null,{scaleMode:Gi.NEAREST,resolution:1,mipmap:Si.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new ft(new UA(null,{width:this.width,height:this.height}),{scaleMode:Gi.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Si.OFF,format:z.DEPTH_COMPONENT,type:st.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const r=this.colorTextures[n],o=r.resolution;r.setSize(t/o,e/o)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class vp extends ft{constructor(t={}){if(typeof t=="number"){const e=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3];t={width:e,height:n,scaleMode:r,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=te.NONE),super(null,t),this.mipmap=Si.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new bl(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class un extends is{constructor(t){const e=t,n=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;super(n,r),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,n){n===void 0&&!e.startsWith("data:")?t.crossOrigin=aA(e):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")}upload(t,e,n,r){const o=t.gl,h=e.realWidth,l=e.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1&&r.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===pi.UNPACK),!this.noSubImage&&e.target===o.TEXTURE_2D&&n.width===h&&n.height===l?o.texSubImage2D(o.TEXTURE_2D,0,0,0,e.format,n.type,r):(n.width=h,n.height=l,o.texImage2D(e.target,0,n.internalFormat,e.format,n.type,r)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(e,n),super.update()}dispose(){this.source=null}}class xp extends un{constructor(t,e){if(e=e||{},typeof t=="string"){const n=new Image;un.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??K.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,n)=>{const r=this.source;this.url=r.src;const o=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?e(this.process()):e(this))};r.complete&&r.src?o():(r.onload=o,r.onerror=h=>{n(h),this.onError.emit(h)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,n=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then(r=>r.blob()).then(r=>e(r,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===pi.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,n){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,n,this.bitmap),!this.preserveBitmap){let r=!0;const o=e._glTextures;for(const h in o){const l=o[h];if(l!==n&&l.dirtyId!==e.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class yp{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,n){const r=e.width,o=e.height;if(n){const h=t.width/2/r,l=t.height/2/o,c=t.x/r+h,f=t.y/o+l;n=Ht.add(n,Ht.NW),this.x0=c+h*Ht.uX(n),this.y0=f+l*Ht.uY(n),n=Ht.add(n,2),this.x1=c+h*Ht.uX(n),this.y1=f+l*Ht.uY(n),n=Ht.add(n,2),this.x2=c+h*Ht.uX(n),this.y2=f+l*Ht.uY(n),n=Ht.add(n,2),this.x3=c+h*Ht.uX(n),this.y3=f+l*Ht.uY(n)}else this.x0=t.x/r,this.y0=t.y/o,this.x1=(t.x+t.width)/r,this.y1=t.y/o,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/o,this.x3=t.x/r,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const cd=new yp;function lo(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class nt extends ss{constructor(t,e,n,r,o,h){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new wt(0,0,1,1)),t instanceof nt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this._uvs=cd,this.uvMatrix=null,this.orig=n||e,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=h?new Et(h.x,h.y):new Et(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&xi[e.url]&&nt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,nt.removeFromCache(this),this.textureCacheIds=null}clone(){var r;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),n=new nt(this.baseTexture,!this.noFrame&&t,e,(r=this.trim)==null?void 0:r.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(n._frame=t),n}updateUvs(){this._uvs===cd&&(this._uvs=new yp),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},n=K.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let o=null;if(r)o=t;else if(t instanceof ft){if(!t.cacheId){const l=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${l}-${Fn()}`,ft.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){const l=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${l}_${Fn()}`}o=t._pixiId}let h=xi[o];if(r&&n&&!h)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!h&&!(t instanceof ft)?(e.resolution||(e.resolution=hn(t)),h=new nt(new ft(t,e)),h.baseTexture.cacheId=o,ft.addToCache(h.baseTexture,o),nt.addToCache(h,o)):!h&&t instanceof ft&&(h=new nt(t),nt.addToCache(h,o)),h}static fromURL(t,e){const n=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),r=nt.from(t,Object.assign({resourceOptions:n},e),!1),o=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):o.load().then(()=>Promise.resolve(r))}static fromBuffer(t,e,n,r){return new nt(ft.fromBuffer(t,e,n,r))}static fromLoader(t,e,n,r){const o=new ft(t,Object.assign({scaleMode:K.SCALE_MODE,resolution:hn(e)},r)),{resource:h}=o;h instanceof xp&&(h.url=e);const l=new nt(o);return n||(n=e),ft.addToCache(l.baseTexture,n),nt.addToCache(l,n),n!==e&&(ft.addToCache(l.baseTexture,e),nt.addToCache(l,e)),l.baseTexture.valid?Promise.resolve(l):new Promise(c=>{l.baseTexture.once("loaded",()=>c(l))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),xi[e]&&xi[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),xi[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=xi[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete xi[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)xi[t.textureCacheIds[e]]===t&&delete xi[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:n,width:r,height:o}=t,h=e+r>this.baseTexture.width,l=n+o>this.baseTexture.height;if(h||l){const c=h&&l?"and":"or",f=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,d=`Y: ${n} + ${o} = ${n+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${f} ${c} ${d}`)}this.valid=r&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return nt._EMPTY||(nt._EMPTY=new nt(new ft),lo(nt._EMPTY),lo(nt._EMPTY.baseTexture)),nt._EMPTY}static get WHITE(){if(!nt._WHITE){const t=K.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),nt._WHITE=new nt(ft.from(t)),lo(nt._WHITE),lo(nt._WHITE.baseTexture)}return nt._WHITE}}class cn extends nt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,n=!0){const r=this.baseTexture.resolution,o=Math.round(t*r)/r,h=Math.round(e*r)/r;this.valid=o>0&&h>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=h,n&&this.baseTexture.resize(o,h),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new cn(new vp(t))}}class bp{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,n=te.NONE){const r=new vp(Object.assign({width:t,height:e,resolution:1,multisample:n},this.textureOptions));return new cn(r)}getOptimalTexture(t,e,n=1,r=te.NONE){let o;t=Math.ceil(t*n-1e-6),e=Math.ceil(e*n-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=Bo(t),e=Bo(e),o=((t&65535)<<16|e&65535)>>>0,r>1&&(o+=r*4294967296)):o=r>1?-r:-1,this.texturePool[o]||(this.texturePool[o]=[]);let h=this.texturePool[o].pop();return h||(h=this.createTexture(t,e,r)),h.filterPoolKey=o,h.setResolution(n),h}getFilterTexture(t,e,n){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,n||te.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const n=this.texturePool[e];if(n)for(let r=0;r<n.length;r++)n[r].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const n=this.texturePool[e];if(n)for(let r=0;r<n.length;r++)n[r].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}bp.SCREEN_KEY=-1;class GA extends ln{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class wp extends ln{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Zt(this.vertices),this.uvBuffer=new Zt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,n=e.x,r=e.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class WA{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=te.NONE,this.sourceFrame=new wt,this.destinationFrame=new wt,this.bindingSourceFrame=new wt,this.bindingDestinationFrame=new wt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const uo=[new Et,new Et,new Et,new Et],kh=new Gt;class Tp{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new bp,this.statePool=[],this.quad=new GA,this.quadUv=new wp,this.tempRect=new wt,this.activeState={},this.globalUniforms=new di({outputFrame:new wt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const n=this.renderer,r=this.defaultFilterStack,o=this.statePool.pop()||new WA,h=this.renderer.renderTexture;let l=e[0].resolution,c=e[0].multisample,f=e[0].padding,d=e[0].autoFit,g=e[0].legacy??!0;for(let x=1;x<e.length;x++){const T=e[x];l=Math.min(l,T.resolution),c=Math.min(c,T.multisample),f=this.useMaxPadding?Math.max(f,T.padding):f+T.padding,d=d&&T.autoFit,g=g||(T.legacy??!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=h.current),r.push(o),o.resolution=l,o.multisample=c,o.legacy=g,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(f);const m=this.tempRect.copyFrom(h.sourceFrame);n.projection.transform&&this.transformAABB(kh.copyFrom(n.projection.transform).invert(),m),d?(o.sourceFrame.fit(m),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(m)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,h.current?h.current.resolution:n.resolution,h.sourceFrame,h.destinationFrame,n.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,l,c),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const _=this.tempRect;_.x=0,_.y=0,_.width=o.sourceFrame.width,_.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(h.sourceFrame),o.bindingDestinationFrame.copyFrom(h.destinationFrame),o.transform=n.projection.transform,n.projection.transform=null,h.bind(o.renderTexture,o.sourceFrame,_),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const o=r.inputSize,h=r.inputPixel,l=r.inputClamp;if(o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],h[0]=Math.round(o[0]*e.resolution),h[1]=Math.round(o[1]*e.resolution),h[2]=1/h[0],h[3]=1/h[1],l[0]=.5*h[2],l[1]=.5*h[3],l[2]=e.sourceFrame.width*o[2]-.5*h[2],l[3]=e.sourceFrame.height*o[3]-.5*h[3],e.legacy){const f=r.filterArea;f[0]=e.destinationFrame.width,f[1]=e.destinationFrame.height,f[2]=e.sourceFrame.x,f[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const c=t[t.length-1];if(this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,e.renderTexture,c.renderTexture,yi.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let f=e.renderTexture,d=this.getOptimalFilterTexture(f.width,f.height,e.resolution);d.filterFrame=f.filterFrame;let g=0;for(g=0;g<n.length-1;++g){g===1&&e.multisample>1&&(d=this.getOptimalFilterTexture(f.width,f.height,e.resolution),d.filterFrame=f.filterFrame),n[g].apply(this,f,d,yi.CLEAR,e);const m=f;f=d,d=m}n[g].apply(this,f,c.renderTexture,yi.BLEND,e),g>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(f),this.returnFilterTexture(d)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=yi.CLEAR){const{renderTexture:n,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const h=this.tempRect;h.x=0,h.y=0,h.width=t.filterFrame.width,h.height=t.filterFrame.height,n.bind(t,t.filterFrame,h)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=r.stateId&1||this.forceClear;(e===yi.CLEAR||e===yi.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,n,r){const o=this.renderer;o.state.set(t.state),this.bindAndClear(n,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(wi.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(wi.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:n,destinationFrame:r}=this.activeState,{orig:o}=e._texture,h=t.set(r.width,0,0,r.height,n.x,n.y),l=e.worldTransform.copyTo(Gt.TEMP_MATRIX);return l.invert(),h.prepend(l),h.scale(1/o.width,1/o.height),h.translate(e.anchor.x,e.anchor.y),h}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,n=1,r=te.NONE){return this.texturePool.getOptimalTexture(t,e,n,r)}getFilterTexture(t,e,n){if(typeof t=="number"){const o=t;t=e,e=o}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,n||te.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const n=uo[0],r=uo[1],o=uo[2],h=uo[3];n.set(e.left,e.top),r.set(e.left,e.bottom),o.set(e.right,e.top),h.set(e.right,e.bottom),t.apply(n,n),t.apply(r,r),t.apply(o,o),t.apply(h,h);const l=Math.min(n.x,r.x,o.x,h.x),c=Math.min(n.y,r.y,o.y,h.y),f=Math.max(n.x,r.x,o.x,h.x),d=Math.max(n.y,r.y,o.y,h.y);e.x=l,e.y=c,e.width=f-l,e.height=d-c}roundFrame(t,e,n,r,o){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(o){const{a:h,b:l,c,d:f}=o;if((Math.abs(l)>1e-4||Math.abs(c)>1e-4)&&(Math.abs(h)>1e-4||Math.abs(f)>1e-4))return}o=o?kh.copyFrom(o):kh.identity(),o.translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.transformAABB(o,t),t.ceil(e),this.transformAABB(o.invert(),t)}}}Tp.extension={type:q.RendererSystem,name:"filter"};rt.add(Tp);class HA{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=te.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const XA=new wt;class Ep{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new bl(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new wt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;K.PREFER_ENV===On.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=r=>e.drawBuffersWEBGL(r):(this.hasMRT=!1,t.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,n=0){const{gl:r}=this;if(t){const o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=n),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let h=0;h<t.colorTextures.length;h++){const l=t.colorTextures[h];this.renderer.texture.unbind(l.parentTextureArray||l)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const h=e.width>>n,l=e.height>>n,c=h/e.width;this.setViewport(e.x*c,e.y*c,h,l)}else{const h=t.width>>n,l=t.height>>n;this.setViewport(0,0,h,l)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,n,r){const o=this.viewport;t=Math.round(t),e=Math.round(e),n=Math.round(n),r=Math.round(r),(o.width!==n||o.height!==r||o.x!==t||o.y!==e)&&(o.x=t,o.y=e,o.width=n,o.height=r,this.gl.viewport(t,e,n,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,n,r,o=sl.COLOR|sl.DEPTH){const{gl:h}=this;h.clearColor(t,e,n,r),h.clear(o)}initFramebuffer(t){const{gl:e}=this,n=new HA(e.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:e}=this,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let o=r.length;e.drawBuffers||(o=Math.min(o,1));for(let h=0;h<o;h++){const l=r[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&n.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,n.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:n}=this,r=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures;let h=o.length;n.drawBuffers||(h=Math.min(h,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||n.createRenderbuffer():r.msaaBuffer&&(n.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const l=[];for(let c=0;c<h;c++){const f=o[c],d=f.parentTextureArray||f;this.renderer.texture.bind(d,0),c===0&&r.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+c,f.target,d._glTextures[this.CONTEXT_UID].texture,e),l.push(n.COLOR_ATTACHMENT0+c))}if(l.length>1&&n.drawBuffers(l),t.depthTexture&&this.writeDepthTexture){const f=t.depthTexture;this.renderer.texture.bind(f,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(r.stencil=r.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.DEPTH24_STENCIL8,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r.stencil)):r.stencil&&(n.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let n=te.NONE;if(t<=1||e===null)return n;for(let r=0;r<e.length;r++)if(e[r]<=t){n=e[r];break}return n===1&&(n=te.NONE),n}blit(t,e,n){const{current:r,renderer:o,gl:h,CONTEXT_UID:l}=this;if(o.context.webGLVersion!==2||!r)return;const c=r.glFramebuffers[l];if(!c)return;if(!t){if(!c.msaaBuffer)return;const d=r.colorTextures[0];if(!d)return;c.blitFramebuffer||(c.blitFramebuffer=new bl(r.width,r.height),c.blitFramebuffer.addColorTexture(0,d)),t=c.blitFramebuffer,t.colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||(e=XA,e.width=r.width,e.height=r.height),n||(n=e);const f=e.width===n.width&&e.height===n.height;this.bind(t),h.bindFramebuffer(h.READ_FRAMEBUFFER,c.framebuffer),h.blitFramebuffer(e.left,e.top,e.right,e.bottom,n.left,n.top,n.right,n.bottom,h.COLOR_BUFFER_BIT,f?h.NEAREST:h.LINEAR)}disposeFramebuffer(t,e){const n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&r.deleteRenderbuffer(n.msaaBuffer),n.stencil&&r.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&n.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const n=t.width,r=t.height,o=this.gl,h=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,h),e.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,e.multisample,o.DEPTH24_STENCIL8,n,r):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,n,r),e.stencil=h,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,h)}reset(){this.current=this.unknownFramebuffer,this.viewport=new wt}destroy(){this.renderer=null}}Ep.extension={type:q.RendererSystem,name:"framebuffer"};rt.add(Ep);const Uh={5126:4,5123:2,5121:1};class Ap{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let n=this.renderer.context.extensions.vertexArrayObject;K.PREFER_ENV===On.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=()=>n.createVertexArrayOES(),t.bindVertexArray=r=>n.bindVertexArrayOES(r),t.deleteVertexArray=r=>n.deleteVertexArrayOES(r)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const n=t.getExtension("ANGLE_instanced_arrays");n?(t.vertexAttribDivisor=(r,o)=>n.vertexAttribDivisorANGLE(r,o),t.drawElementsInstanced=(r,o,h,l,c)=>n.drawElementsInstancedANGLE(r,o,h,l,c),t.drawArraysInstanced=(r,o,h,l)=>n.drawArraysInstancedANGLE(r,o,h,l)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:n}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},o=!0);const h=r[e.program.id]||this.initGeometryVao(t,e,o);this._activeGeometry=t,this._activeVao!==h&&(this._activeVao=h,this.hasVao?n.bindVertexArray(h):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const r=t.buffers[n];e.update(r)}}checkCompatibility(t,e){const n=t.attributes,r=e.attributeData;for(const o in r)if(!n[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,e){const n=t.attributes,r=e.attributeData,o=["g",t.id];for(const h in n)r[h]&&o.push(h,r[h].location);return o.join("-")}initGeometryVao(t,e,n=!0){const r=this.gl,o=this.CONTEXT_UID,h=this.renderer.buffer,l=e.program;l.glPrograms[o]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,l);const c=this.getSignature(t,l),f=t.glVertexArrayObjects[this.CONTEXT_UID];let d=f[c];if(d)return f[l.id]=d,d;const g=t.buffers,m=t.attributes,_={},x={};for(const T in g)_[T]=0,x[T]=0;for(const T in m)!m[T].size&&l.attributeData[T]?m[T].size=l.attributeData[T].size:m[T].size||console.warn(`PIXI Geometry attribute '${T}' size cannot be determined (likely the bound shader does not have the attribute)`),_[m[T].buffer]+=m[T].size*Uh[m[T].type];for(const T in m){const y=m[T],E=y.size;y.stride===void 0&&(_[y.buffer]===E*Uh[y.type]?y.stride=0:y.stride=_[y.buffer]),y.start===void 0&&(y.start=x[y.buffer],x[y.buffer]+=E*Uh[y.type])}d=r.createVertexArray(),r.bindVertexArray(d);for(let T=0;T<g.length;T++){const y=g[T];h.bind(y),n&&y._glBuffers[o].refCount++}return this.activateVao(t,l),f[l.id]=d,f[c]=d,r.bindVertexArray(null),h.unbind(Ti.ARRAY_BUFFER),d}disposeGeometry(t,e){var l;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,o=t.buffers,h=(l=this.renderer)==null?void 0:l.buffer;if(t.disposeRunner.remove(this),!!n){if(h)for(let c=0;c<o.length;c++){const f=o[c]._glBuffers[this.CONTEXT_UID];f&&(f.refCount--,f.refCount===0&&!e&&h.dispose(o[c],e))}if(!e){for(const c in n)if(c[0]==="g"){const f=n[c];this._activeVao===f&&this.unbind(),r.deleteVertexArray(f)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t)}activateVao(t,e){const n=this.gl,r=this.CONTEXT_UID,o=this.renderer.buffer,h=t.buffers,l=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let c=null;for(const f in l){const d=l[f],g=h[d.buffer],m=g._glBuffers[r];if(e.attributeData[f]){c!==m&&(o.bind(g),c=m);const _=e.attributeData[f].location;if(n.enableVertexAttribArray(_),n.vertexAttribPointer(_,d.size,d.type||n.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)n.vertexAttribDivisor(_,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,n,r){const{gl:o}=this,h=this._activeGeometry;if(h.indexBuffer){const l=h.indexBuffer.data.BYTES_PER_ELEMENT,c=l===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?h.instanced?o.drawElementsInstanced(t,e||h.indexBuffer.data.length,c,(n||0)*l,r||1):o.drawElements(t,e||h.indexBuffer.data.length,c,(n||0)*l):console.warn("unsupported index buffer type: uint32")}else h.instanced?o.drawArraysInstanced(t,n,e||h.getSize(),r||1):o.drawArrays(t,n,e||h.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}Ap.extension={type:q.RendererSystem,name:"geometry"};rt.add(Ap);const fd=new Gt;class Sp{constructor(t,e){this._texture=t,this.mapCoord=new Gt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const n=this.mapCoord;for(let r=0;r<t.length;r+=2){const o=t[r],h=t[r+1];e[r]=o*n.a+h*n.c+n.tx,e[r+1]=o*n.b+h*n.d+n.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const r=e.orig,o=e.trim;o&&(fd.set(r.width/o.width,0,0,r.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(fd));const h=e.baseTexture,l=this.uClampFrame,c=this.clampMargin/h.resolution,f=this.clampOffset;return l[0]=(e._frame.x+c+f)/h.width,l[1]=(e._frame.y+c+f)/h.height,l[2]=(e._frame.x+e._frame.width-c+f)/h.width,l[3]=(e._frame.y+e._frame.height-c+f)/h.height,this.uClampOffset[0]=f/h.realWidth,this.uClampOffset[1]=f/h.realHeight,this.isSimple=e._frame.width===h.width&&e._frame.height===h.height&&e.rotate===0,!0}}var zA=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,$A=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class VA extends be{constructor(t,e,n){let r=null;typeof t!="string"&&e===void 0&&n===void 0&&(r=t,t=void 0,e=void 0,n=void 0),super(t||$A,e||zA,n),this.maskSprite=r,this.maskMatrix=new Gt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,n,r){const o=this._maskSprite,h=o._texture;h.valid&&(h.uvMatrix||(h.uvMatrix=new Sp(h,0)),h.uvMatrix.update(),this.uniforms.npmAlpha=h.baseTexture.alphaMode?0:1,this.uniforms.mask=h,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(h.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=h.uvMatrix.uClampFrame,t.applyFilter(this,e,n,r))}}class YA{constructor(t=null){this.type=se.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=K.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=se.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Cp{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let n=e;if(!n.isMaskData){const o=this.maskDataPool.pop()||new YA;o.pooled=!0,o.maskObject=e,n=o}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(r),n._colorMask=r?r._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==se.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case se.SCISSOR:this.renderer.scissor.push(n);break;case se.STENCIL:this.renderer.stencil.push(n);break;case se.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case se.COLOR:this.pushColorMask(n);break}n.type===se.SPRITE&&this.maskStack.push(n)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case se.SCISSOR:this.renderer.scissor.pop(e);break;case se.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case se.SPRITE:this.popSpriteMask(e);break;case se.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const n=this.maskStack[this.maskStack.length-1];n.type===se.SPRITE&&n._filters&&(n._filters[0].maskSprite=n.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=se.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=se.SCISSOR:t.type=se.STENCIL:t.type=se.COLOR}pushSpriteMask(t){const{maskObject:e}=t,n=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new VA]));const o=this.renderer,h=o.renderTexture;let l,c;if(h.current){const d=h.current;l=t.resolution||d.resolution,c=t.multisample??d.multisample}else l=t.resolution||o.resolution,c=t.multisample??o.multisample;r[0].resolution=l,r[0].multisample=c,r[0].maskSprite=e;const f=n.filterArea;n.filterArea=e.getBounds(!0),o.filter.push(n,r),n.filterArea=f,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,n=t._colorMask=e&t.colorMask;n!==e&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}popColorMask(t){const e=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==e&&this.renderer.gl.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)}destroy(){this.renderer=null}}Cp.extension={type:q.RendererSystem,name:"mask"};rt.add(Cp);class Ip{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,n=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==n&&(r===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const dd=new Gt,pd=[],Co=class extends Ip{constructor(i){super(i),this.glConst=K.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){if(i._scissorRectLocal)return;const t=i._scissorRect,{maskObject:e}=i,{renderer:n}=this,r=n.renderTexture,o=e.getBounds(!0,pd.pop()??new wt);this.roundFrameToPixels(o,r.current?r.current.resolution:n.resolution,r.sourceFrame,r.destinationFrame,n.projection.transform),t&&o.fit(t),i._scissorRectLocal=o}static isMatrixRotated(i){if(!i)return!1;const{a:t,b:e,c:n,d:r}=i;return(Math.abs(e)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(i){const{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||Co.isMatrixRotated(t.worldTransform)||Co.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,n,r){Co.isMatrixRotated(r)||(r=r?dd.copyFrom(r):dd.identity(),r.translate(-e.x,-e.y).scale(n.width/e.width,n.height/e.height).translate(n.x,n.y),this.renderer.filter.transformAABB(r,i),i.fit(n),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:t}=this.renderer;i&&pd.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=i.y:t=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}};let Rp=Co;Rp.extension={type:q.RendererSystem,name:"scissor"};rt.add(Rp);class Pp extends Ip{constructor(t){super(t),this.glConst=K.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:n}=this.renderer,r=t._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const o=t._colorMask;o!==0&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,r,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,o!==0&&(t._colorMask=o,n.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=n?n._colorMask:15;r!==0&&(n._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(n._colorMask=r,e.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Pp.extension={type:q.RendererSystem,name:"stencil"};rt.add(Pp);class Mp{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return At("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return At("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return At("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Mp.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"_plugin"};rt.add(Mp);class Dp{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Gt,this.transform=null}update(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,e,n,r){const o=this.projectionMatrix,h=r?-1:1;o.identity(),o.a=1/e.width*2,o.d=h*(1/e.height*2),o.tx=-1-e.x*o.a,o.ty=-h-e.y*o.d}setTransform(t){}destroy(){this.renderer=null}}Dp.extension={type:q.RendererSystem,name:"projection"};rt.add(Dp);const jA=new $l;class Bp{constructor(t){this.renderer=t,this._tempMatrix=new Gt}generateTexture(t,e){const{region:n,...r}=e||{},o=n||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);const h=cn.create({width:o.width,height:o.height,...r});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const l=t.transform;return t.transform=jA,this.renderer.render(t,{renderTexture:h,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=l,h}destroy(){}}Bp.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"textureGenerator"};rt.add(Bp);const wn=new wt,zr=new wt;class Fp{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new wt,this.destinationFrame=new wt,this.viewportFrame=new wt}bind(t=null,e,n){const r=this.renderer;this.current=t;let o,h,l;t?(o=t.baseTexture,l=o.resolution,e||(wn.width=t.frame.width,wn.height=t.frame.height,e=wn),n||(zr.x=t.frame.x,zr.y=t.frame.y,zr.width=e.width,zr.height=e.height,n=zr),h=o.framebuffer):(l=r.resolution,e||(wn.width=r._view.screen.width,wn.height=r._view.screen.height,e=wn),n||(n=wn,n.width=e.width,n.height=e.height));const c=this.viewportFrame;c.x=n.x*l,c.y=n.y*l,c.width=n.width*l,c.height=n.height*l,t||(c.y=r.view.height-(c.y+c.height)),c.ceil(),this.renderer.framebuffer.bind(h,c),this.renderer.projection.update(n,e,l,!h),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(n)}clear(t,e){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.renderer.background.colorRgba;const n=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==r.width||n.height!==r.height;if(o){let{x:h,y:l,width:c,height:f}=this.viewportFrame;h=Math.round(h),l=Math.round(l),c=Math.round(c),f=Math.round(f),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,c,f)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Fp.extension={type:q.RendererSystem,name:"renderTexture"};rt.add(Fp);class qA{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function KA(i,t){const e={},n=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const o=t.getActiveAttrib(i,r);if(o.name.startsWith("gl_"))continue;const h=pp(t,o.type),l={type:h,name:o.name,size:dp(h),location:t.getAttribLocation(i,o.name)};e[o.name]=l}return e}function ZA(i,t){const e={},n=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const o=t.getActiveUniform(i,r),h=o.name.replace(/\[.*?\]$/,""),l=!!o.name.match(/\[.*?\]$/),c=pp(t,o.type);e[h]={name:h,index:r,type:c,size:o.size,isArray:l,value:cp(c,o.size)}}return e}function JA(i,t){var c;const e=od(i,i.VERTEX_SHADER,t.vertexSrc),n=od(i,i.FRAGMENT_SHADER,t.fragmentSrc),r=i.createProgram();i.attachShader(r,e),i.attachShader(r,n);const o=(c=t.extra)==null?void 0:c.transformFeedbackVaryings;if(o&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(r,o.names,o.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(r),i.getProgramParameter(r,i.LINK_STATUS)||CA(i,r,e,n),t.attributeData=KA(r,i),t.uniformData=ZA(r,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const f=Object.keys(t.attributeData);f.sort((d,g)=>d>g?1:-1);for(let d=0;d<f.length;d++)t.attributeData[f[d]].location=d,i.bindAttribLocation(r,d,f[d]);i.linkProgram(r)}i.deleteShader(e),i.deleteShader(n);const h={};for(const f in t.uniformData){const d=t.uniformData[f];h[f]={location:i.getUniformLocation(r,f),value:cp(d.type,d.size)}}return new qA(r,h)}function QA(i,t,e,n,r){e.buffer.update(r)}const tS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Lp={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function eS(i){const t=i.map(o=>({data:o,offset:0,dataLen:0,dirty:0}));let e=0,n=0,r=0;for(let o=0;o<t.length;o++){const h=t[o];if(e=Lp[h.data.type],h.data.size>1&&(e=Math.max(e,16)*h.data.size),h.dataLen=e,n%e!==0&&n<16){const l=n%e%16;n+=l,r+=l}n+e>16?(r=Math.ceil(r/16)*16,h.offset=r,r+=e,n=e):(h.offset=r,n+=e,r+=e)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function iS(i,t){const e=[];for(const n in i)t[n]&&e.push(t[n]);return e.sort((n,r)=>n.index-r.index),e}function nS(i,t){if(!i.autoManage)return{size:0,syncFunc:QA};const e=iS(i.uniforms,t),{uboElements:n,size:r}=eS(e),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let h=0;h<n.length;h++){const l=n[h],c=i.uniforms[l.data.name],f=l.data.name;let d=!1;for(let g=0;g<fr.length;g++){const m=fr[g];if(m.codeUbo&&m.test(l.data,c)){o.push(`offset = ${l.offset/4};`,fr[g].codeUbo(l.data.name,c)),d=!0;break}}if(!d)if(l.data.size>1){const g=dp(l.data.type),m=Math.max(Lp[l.data.type]/16,1),_=g/m,x=(4-_%4)%4;o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${l.offset/4};

                t = 0;

                for(var i=0; i < ${l.data.size*m}; i++)
                {
                    for(var j = 0; j < ${_}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${x};
                }

                `)}else{const g=tS[l.data.type];o.push(`
                cv = ud.${f}.value;
                v = uv.${f};
                offset = ${l.offset/4};
                ${g};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}let rS=0;const co={textureCount:0,uboCount:0};class Op{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=rS++}systemCheck(){if(!RA())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||(co.textureCount=0,co.uboCount=0,this.syncUniformGroup(t.uniformGroup,co)),r}setUniforms(t){const e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,e){const n=this.getGlProgram();(!t.static||t.dirtyId!==n.uniformDirtyGroups[t.id])&&(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))}syncUniforms(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=EA(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const n=this.getGlProgram();if(!t.static||t.dirtyId!==0||!n.uniformGroups[t.id]){t.dirtyId=0;const r=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,e);t.buffer.update(),r(n.uniformData,t.uniforms,this.renderer,co,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[e])}createSyncBufferGroup(t,e,n){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const o=this.gl.getUniformBlockIndex(e.program,n);e.uniformBufferBindings[n]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const h=this.getSignature(t,this.shader.program.uniformData,"ubo");let l=this._uboCache[h];if(l||(l=this._uboCache[h]=nS(t,this.shader.program.uniformData)),t.autoManage){const c=new Float32Array(l.size/4);t.buffer.update(c)}return e.uniformGroups[t.id]=l.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,n){const r=t.uniforms,o=[`${n}-`];for(const h in r)o.push(h),e[h]&&o.push(e[h].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,n=t.program,r=JA(e,n);return n.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Op.extension={type:q.RendererSystem,name:"shader"};rt.add(Op);class Np{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.1.0 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}Np.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"startup"};rt.add(Np);function sS(i,t=[]){return t[lt.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.ADD]=[i.ONE,i.ONE],t[lt.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.NONE]=[0,0],t[lt.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[lt.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[lt.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[lt.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[lt.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[lt.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[lt.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[lt.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[lt.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[lt.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[lt.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const oS=0,aS=1,hS=2,lS=3,uS=4,cS=5,wl=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=lt.NONE,this._blendEq=!1,this.map=[],this.map[oS]=this.setBlend,this.map[aS]=this.setOffset,this.map[hS]=this.setCullFace,this.map[lS]=this.setDepthTest,this.map[uS]=this.setFrontFace,this.map[cS]=this.setDepthMask,this.checks=[],this.defaultState=new Vi,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=sS(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let t=this.stateId^i.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(i.data&1<<e)),t=t>>1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(wl.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(wl.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const t=this.blendModes[i],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){const e=this.checks.indexOf(i);t&&e===-1?this.checks.push(i):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let kp=wl;kp.extension={type:q.RendererSystem,name:"state"};rt.add(kp);class fS extends ss{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(r=>t.systems[r]),n=[...e,...Object.keys(t.systems).filter(r=>!e.includes(r))];for(const r of n)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach(e=>{this.runners[e]=new fi(e)})}addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const r in this.runners)this.runners[r].add(n);return this}emitWithCustomOptions(t,e){const n=Object.keys(this._systemsHash);t.items.forEach(r=>{const o=n.find(h=>this._systemsHash[h]===r);r[t.name](e[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Io=class{constructor(i){this.renderer=i,this.count=0,this.checkCount=0,this.maxIdle=Io.defaultMaxIdle,this.checkCountMax=Io.defaultCheckCountMax,this.mode=Io.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==kl.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const i=this.renderer.texture,t=i.managedTextures;let e=!1;for(let n=0;n<t.length;n++){const r=t[n];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(i.destroyTexture(r,!0),t[n]=null,e=!0)}if(e){let n=0;for(let r=0;r<t.length;r++)t[r]!==null&&(t[n++]=t[r]);t.length=n}}unload(i){const t=this.renderer.texture,e=i._texture;e&&!e.framebuffer&&t.destroyTexture(e);for(let n=i.children.length-1;n>=0;n--)this.unload(i.children[n])}destroy(){this.renderer=null}};let hi=Io;hi.defaultMode=kl.AUTO;hi.defaultMaxIdle=60*60;hi.defaultCheckCountMax=60*10;hi.extension={type:q.RendererSystem,name:"textureGC"};rt.add(hi);class Gh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=st.UNSIGNED_BYTE,this.internalFormat=z.RGBA,this.samplerType=0}}function dS(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[st.UNSIGNED_BYTE]:{[z.RGBA]:i.RGBA8,[z.RGB]:i.RGB8,[z.RG]:i.RG8,[z.RED]:i.R8,[z.RGBA_INTEGER]:i.RGBA8UI,[z.RGB_INTEGER]:i.RGB8UI,[z.RG_INTEGER]:i.RG8UI,[z.RED_INTEGER]:i.R8UI,[z.ALPHA]:i.ALPHA,[z.LUMINANCE]:i.LUMINANCE,[z.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[st.BYTE]:{[z.RGBA]:i.RGBA8_SNORM,[z.RGB]:i.RGB8_SNORM,[z.RG]:i.RG8_SNORM,[z.RED]:i.R8_SNORM,[z.RGBA_INTEGER]:i.RGBA8I,[z.RGB_INTEGER]:i.RGB8I,[z.RG_INTEGER]:i.RG8I,[z.RED_INTEGER]:i.R8I},[st.UNSIGNED_SHORT]:{[z.RGBA_INTEGER]:i.RGBA16UI,[z.RGB_INTEGER]:i.RGB16UI,[z.RG_INTEGER]:i.RG16UI,[z.RED_INTEGER]:i.R16UI,[z.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[st.SHORT]:{[z.RGBA_INTEGER]:i.RGBA16I,[z.RGB_INTEGER]:i.RGB16I,[z.RG_INTEGER]:i.RG16I,[z.RED_INTEGER]:i.R16I},[st.UNSIGNED_INT]:{[z.RGBA_INTEGER]:i.RGBA32UI,[z.RGB_INTEGER]:i.RGB32UI,[z.RG_INTEGER]:i.RG32UI,[z.RED_INTEGER]:i.R32UI,[z.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[st.INT]:{[z.RGBA_INTEGER]:i.RGBA32I,[z.RGB_INTEGER]:i.RGB32I,[z.RG_INTEGER]:i.RG32I,[z.RED_INTEGER]:i.R32I},[st.FLOAT]:{[z.RGBA]:i.RGBA32F,[z.RGB]:i.RGB32F,[z.RG]:i.RG32F,[z.RED]:i.R32F,[z.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[st.HALF_FLOAT]:{[z.RGBA]:i.RGBA16F,[z.RGB]:i.RGB16F,[z.RG]:i.RG16F,[z.RED]:i.R16F},[st.UNSIGNED_SHORT_5_6_5]:{[z.RGB]:i.RGB565},[st.UNSIGNED_SHORT_4_4_4_4]:{[z.RGBA]:i.RGBA4},[st.UNSIGNED_SHORT_5_5_5_1]:{[z.RGBA]:i.RGB5_A1},[st.UNSIGNED_INT_2_10_10_10_REV]:{[z.RGBA]:i.RGB10_A2,[z.RGBA_INTEGER]:i.RGB10_A2UI},[st.UNSIGNED_INT_10F_11F_11F_REV]:{[z.RGB]:i.R11F_G11F_B10F},[st.UNSIGNED_INT_5_9_9_9_REV]:{[z.RGB]:i.RGB9_E5},[st.UNSIGNED_INT_24_8]:{[z.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[st.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[z.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[st.UNSIGNED_BYTE]:{[z.RGBA]:i.RGBA,[z.RGB]:i.RGB,[z.ALPHA]:i.ALPHA,[z.LUMINANCE]:i.LUMINANCE,[z.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[st.UNSIGNED_SHORT_5_6_5]:{[z.RGB]:i.RGB},[st.UNSIGNED_SHORT_4_4_4_4]:{[z.RGBA]:i.RGBA},[st.UNSIGNED_SHORT_5_5_5_1]:{[z.RGBA]:i.RGBA}},t}class Up{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ft,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=dS(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};const n=new Gh(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Gh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,e=0){const{gl:n}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<n.length;r++)n[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<n.length;r++)n[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),n[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:n,CONTEXT_UID:r}=this;if(n)for(let o=t-1;o>=0;--o){const h=e[o];h&&h._glTextures[r].samplerType!==ol.FLOAT&&this.renderer.texture.unbind(h)}}initTexture(t){const e=new Gh(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var n;e.internalFormat=((n=this.internalFormats[t.type])==null?void 0:n[t.format])??t.format,this.webGLVersion===2&&t.type===st.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var r;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const n=this.renderer;if(this.initTextureType(t,e),(r=t.resource)!=null&&r.upload(n,t,e))e.samplerType!==ol.FLOAT&&(this.hasIntegerTextures=!0);else{const o=t.realWidth,h=t.realHeight,l=n.gl;(e.width!==o||e.height!==h||e.dirtyId<0)&&(e.width=o,e.height=h,l.texImage2D(t.target,0,e.internalFormat,o,h,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:n}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const r=this.managedTextures.indexOf(t);r!==-1&&ur(this.managedTextures,r,1)}}updateTextureStyle(t){var n;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Si.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=an.CLAMP:e.wrapMode=t.wrapMode,(n=t.resource)!=null&&n.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const n=this.gl;if(e.mipmap&&t.mipmap!==Si.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Gi.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===Gi.LINEAR){const o=Math.min(t.anisotropicLevel,n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Gi.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===Gi.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}Up.extension={type:q.RendererSystem,name:"texture"};rt.add(Up);class Gp{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:n,renderer:r}=this;e&&r.shader.bind(e),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:n,CONTEXT_UID:r}=this,o=e.createTransformFeedback();t._glTransformFeedbacks[r]=o,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o);for(let h=0;h<t.buffers.length;h++){const l=t.buffers[h];l&&(n.buffer.update(l),l._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,h,l._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,e){const n=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let h=0;h<t.buffers.length;h++){const l=t.buffers[h];if(!l)continue;const c=l._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!e&&o.dispose(l,e))}n&&(e||r.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Gp.extension={type:q.RendererSystem,name:"transformFeedback"};rt.add(Gp);class Wp{constructor(t){this.renderer=t}init(t){this.screen=new wt(0,0,t.width,t.height),this.element=t.view||K.ADAPTER.createCanvas(),this.resolution=t.resolution||K.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const n=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=n,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",n,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Wp.extension={type:[q.RendererSystem,q.CanvasRendererSystem],name:"_view"};rt.add(Wp);K.PREFER_ENV=On.WEBGL2;K.STRICT_TEXTURE_CACHE=!1;Object.defineProperties(K,{WRAP_MODE:{get(){return ft.defaultOptions.wrapMode},set(i){At("7.1.0","settings.WRAP_MODE is deprecated, use BaseTeture.defaultOptions.wrapMode"),ft.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return ft.defaultOptions.scaleMode},set(i){At("7.1.0","settings.SCALE_MODE is deprecated, use BaseTeture.defaultOptions.scaleMode"),ft.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return ft.defaultOptions.mipmap},set(i){At("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTeture.defaultOptions.mipmap"),ft.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return ft.defaultOptions.anisotropicLevel},set(i){At("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTeture.defaultOptions.anisotropicLevel"),ft.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return At("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),be.defaultResolution},set(i){be.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return At("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),be.defaultMultisample},set(i){be.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return ai.defaultMaxTextures},set(i){At("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ai.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return ai.defaultBatchSize},set(i){At("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ai.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return ai.canUploadSameBuffer},set(i){At("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ai.canUploadSameBuffer=i}},GC_MODE:{get(){return hi.defaultMode},set(i){At("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),hi.defaultMode=i}},GC_MAX_IDLE:{get(){return hi.defaultMaxIdle},set(i){At("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),hi.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return hi.defaultCheckCountMax},set(i){At("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),hi.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return li.defaultVertexPrecision},set(i){At("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),li.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return li.defaultFragmentPrecision},set(i){At("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),li.defaultFragmentPrecision=i}}});var dr=(i=>(i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(dr||{});class Wh{constructor(t,e=null,n=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=n,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Le=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Wh(null,null,1/0),this.deltaMS=1/Le.targetFPMS,this.elapsedMS=1/Le.targetFPMS,this._tick=i=>{this._requestId=null,this.started&&(this.update(i),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(i,t,e=dr.NORMAL){return this._addListener(new Wh(i,t,e))}addOnce(i,t,e=dr.NORMAL){return this._addListener(new Wh(i,t,e,!0))}_addListener(i){let t=this._head.next,e=this._head;if(!t)i.connect(e);else{for(;t;){if(i.priority>t.priority){i.connect(e);break}e=t,t=t.next}i.previous||i.connect(e)}return this._startIfPossible(),this}remove(i,t){let e=this._head.next;for(;e;)e.match(i,t)?e=e.destroy():e=e.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let i=0,t=this._head;for(;t=t.next;)i++;return i}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let i=this._head.next;for(;i;)i=i.destroy(!0);this._head.destroy(),this._head=null}}update(i=performance.now()){let t;if(i>this.lastTime){if(t=this.elapsedMS=i-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=i-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=i-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Le.targetFPMS;const e=this._head;let n=e.next;for(;n;)n=n.emit(this.deltaTime);e.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=i}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(i){const t=Math.min(this.maxFPS,i),e=Math.min(Math.max(0,t)/1e3,Le.targetFPMS);this._maxElapsedMS=1/e}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(i){if(i===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,i);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Le._shared){const i=Le._shared=new Le;i.autoStart=!0,i._protected=!0}return Le._shared}static get system(){if(!Le._system){const i=Le._system=new Le;i.autoStart=!0,i._protected=!0}return Le._system}};let Ce=Le;Ce.targetFPMS=.06;Object.defineProperties(K,{TARGET_FPMS:{get(){return Ce.targetFPMS},set(i){At("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Ce.targetFPMS=i}}});class Hp{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,dr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ce.shared:new Ce,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Hp.extension=q.Application;rt.add(Hp);const Xp=[];rt.handleByList(q.Renderer,Xp);function pS(i){for(const t of Xp)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var gS=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,mS=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const _S=gS,zp=mS;class $p{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}e>=te.HIGH?this.multisample=te.HIGH:e>=te.MEDIUM?this.multisample=te.MEDIUM:e>=te.LOW?this.multisample=te.LOW:this.multisample=te.NONE}destroy(){}}$p.extension={type:q.RendererSystem,name:"_multisample"};rt.add($p);class vS{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Vp{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glBuffers[n]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:n,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const o=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,o.buffer)}}bindBufferRange(t,e,n){const{gl:r,CONTEXT_UID:o}=this;n=n||0;const h=t._glBuffers[o]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,h.buffer,n*256,256)}update(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const o=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,o)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let n=0;n<e.length;n++)this.dispose(this.managedBuffers[e[n]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:n}=this;return t._glBuffers[e]=new vS(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Vp.extension={type:q.RendererSystem,name:"buffer"};rt.add(Vp);class Yp{constructor(t){this.renderer=t}render(t,e){const n=this.renderer;let r,o,h,l;if(e&&(r=e.renderTexture,o=e.clear,h=e.transform,l=e.skipUpdateTransform),this.renderingToScreen=!r,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=h,!n.context.isLost){if(r||(this.lastObjectRendered=t),!l){const c=t.enableTempParent();t.updateTransform(),t.disableTempParent(c)}n.renderTexture.bind(r),n.batch.currentRenderer.start(),(o??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),r&&(e.blit&&n.framebuffer.blit(),r.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Yp.extension={type:q.RendererSystem,name:"objectRenderer"};rt.add(Yp);const Tl=class extends fS{constructor(i){super(),i=Object.assign({},K.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new di({projectionMatrix:new Gt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Tl.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in i&&(At("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),i.premultipliedAlpha=i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",i.backgroundAlpha=i.useContextAlpha===!1?1:i.backgroundAlpha);const e={hello:i.hello,_plugin:Tl.__plugins,background:{alpha:i.backgroundAlpha,color:i.background??i.backgroundColor,clearBeforeRender:i.clearBeforeRender},_view:{height:i.height,width:i.width,autoDensity:i.autoDensity,resolution:i.resolution,view:i.view},context:{antialias:i.antialias,context:i.context,powerPreference:i.powerPreference,premultipliedAlpha:i.premultipliedAlpha,preserveDrawingBuffer:i.preserveDrawingBuffer}};this.startup.run(e),this.options=i}static test(i){return i!=null&&i.forceCanvas?!1:dw()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(i){this._view.resolution=i,this.runners.resolutionChange.emit(i)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return At("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return At("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return At("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return At("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(i){At("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=i}get backgroundAlpha(){return At("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(i){At("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=i}get powerPreference(){return At("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}};let xr=Tl;xr.extension={type:q.Renderer,priority:1};xr.__plugins={};xr.__systems={};rt.handleByMap(q.RendererPlugin,xr.__plugins);rt.handleByMap(q.RendererSystem,xr.__systems);rt.add(xr);class jp extends is{constructor(t,e){const{width:n,height:r}=e||{};super(n,r),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){const h=new ft;this.items.push(h),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof is?this.addResourceAt(t[n],n):this.addResourceAt(ap(t[n],e),n))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(n=>n.resource).filter(n=>n).map(n=>n.load());return this._load=Promise.all(e).then(()=>{const{realWidth:n,realHeight:r}=this.items[0];return this.resize(n,r),Promise.resolve(this)}),this._load}}class xS extends jp{constructor(t,e){const{width:n,height:r}=e||{};let o,h;Array.isArray(t)?(o=t,h=t.length):h=t,super(h,{width:n,height:r}),o&&this.initFromArray(o,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=hr.TEXTURE_2D_ARRAY}upload(t,e,n){const{length:r,itemDirtyIds:o,items:h}=this,{gl:l}=t;n.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,r,0,e.format,n.type,null);for(let c=0;c<r;c++){const f=h[c];o[c]<f.dirtyId&&(o[c]=f.dirtyId,f.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,c,f.resource.width,f.resource.height,1,e.format,n.type,f.resource.source))}return!0}}class yS extends un{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const jr=class extends jp{constructor(i,t){const{width:e,height:n,autoLoad:r,linkBaseTexture:o}=t||{};if(i&&i.length!==jr.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:n});for(let h=0;h<jr.SIDES;h++)this.items[h].target=hr.TEXTURE_CUBE_MAP_POSITIVE_X+h;this.linkBaseTexture=o!==!1,i&&this.initFromArray(i,t),r!==!1&&this.load()}bind(i){super.bind(i),i.target=hr.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=hr.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){const n=this.itemDirtyIds;for(let r=0;r<jr.SIDES;r++){const o=this.items[r];(n[r]<o.dirtyId||e.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(i,o,e),n[r]=o.dirtyId):n[r]<-1&&(i.gl.texImage2D(o.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),n[r]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===jr.SIDES}};let qp=jr;qp.SIDES=6;class ar extends un{constructor(t,e){var n=(...r)=>{super(...r)};e=e||{},typeof t=="string"?(n(ar.EMPTY),this.url=t):(n(t),this.url=null),this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const n=await K.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await n.blob();if(this.destroyed)return;const o=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===pi.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(n){if(this.destroyed)return;e(n),this.onError.emit(n)}}),this._load)}upload(t,e,n){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,n)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return ar._EMPTY=ar._EMPTY??K.ADAPTER.createCanvas(0,0),ar._EMPTY}}const Ro=class extends un{constructor(i,t){t=t||{},super(K.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},Ro.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const i=new Image;un.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{this._resolve&&(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;const t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=t*this.scale,r=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/e*t,r=this._overrideHeight||this._overrideWidth/t*e),n=Math.round(n),r=Math.round(r);const o=this.source;o.width=n,o.height=r,o._pixiId=`canvas_${Fn()}`,o.getContext("2d").drawImage(i,0,0,t,e,0,0,n,r),this._resolve(),this._resolve=null}}static getSize(i){const t=Ro.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return t==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&Ro.SVG_XML.test(i)}};let ns=Ro;ns.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;ns.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const El=class extends un{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);const n=i[0].src||i[0];un.crossOrigin(e,n,t.crossorigin);for(let r=0;r<i.length;++r){const o=document.createElement("source");let{src:h,mime:l}=i[r];h=h||i[r];const c=h.split("?").shift().toLowerCase(),f=c.slice(c.lastIndexOf(".")+1);l=l||El.MIME_TYPES[f]||`video/${f}`,o.src=h,o.type=l,e.appendChild(o)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){const t=Ce.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ce.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ce.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(Ce.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Ce.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ce.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||El.TYPES.includes(t)}};let Vl=El;Vl.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Vl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};_l.push(ar,xp,yS,Vl,ns,os,qp,xS);class Oo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?wt.EMPTY:(t=t||new wt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:n,b:r,c:o,d:h,tx:l,ty:c}=t,f=n*e.x+o*e.y+l,d=r*e.x+h*e.y+c;this.minX=Math.min(this.minX,f),this.maxX=Math.max(this.maxX,f),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let e=this.minX,n=this.minY,r=this.maxX,o=this.maxY,h=t[0],l=t[1];e=h<e?h:e,n=l<n?l:n,r=h>r?h:r,o=l>o?l:o,h=t[2],l=t[3],e=h<e?h:e,n=l<n?l:n,r=h>r?h:r,o=l>o?l:o,h=t[4],l=t[5],e=h<e?h:e,n=l<n?l:n,r=h>r?h:r,o=l>o?l:o,h=t[6],l=t[7],e=h<e?h:e,n=l<n?l:n,r=h>r?h:r,o=l>o?l:o,this.minX=e,this.minY=n,this.maxX=r,this.maxY=o}addFrame(t,e,n,r,o){this.addFrameMatrix(t.worldTransform,e,n,r,o)}addFrameMatrix(t,e,n,r,o){const h=t.a,l=t.b,c=t.c,f=t.d,d=t.tx,g=t.ty;let m=this.minX,_=this.minY,x=this.maxX,T=this.maxY,y=h*e+c*n+d,E=l*e+f*n+g;m=y<m?y:m,_=E<_?E:_,x=y>x?y:x,T=E>T?E:T,y=h*r+c*n+d,E=l*r+f*n+g,m=y<m?y:m,_=E<_?E:_,x=y>x?y:x,T=E>T?E:T,y=h*e+c*o+d,E=l*e+f*o+g,m=y<m?y:m,_=E<_?E:_,x=y>x?y:x,T=E>T?E:T,y=h*r+c*o+d,E=l*r+f*o+g,m=y<m?y:m,_=E<_?E:_,x=y>x?y:x,T=E>T?E:T,this.minX=m,this.minY=_,this.maxX=x,this.maxY=T}addVertexData(t,e,n){let r=this.minX,o=this.minY,h=this.maxX,l=this.maxY;for(let c=e;c<n;c+=2){const f=t[c],d=t[c+1];r=f<r?f:r,o=d<o?d:o,h=f>h?f:h,l=d>l?d:l}this.minX=r,this.minY=o,this.maxX=h,this.maxY=l}addVertices(t,e,n,r){this.addVerticesMatrix(t.worldTransform,e,n,r)}addVerticesMatrix(t,e,n,r,o=0,h=o){const l=t.a,c=t.b,f=t.c,d=t.d,g=t.tx,m=t.ty;let _=this.minX,x=this.minY,T=this.maxX,y=this.maxY;for(let E=n;E<r;E+=2){const S=e[E],A=e[E+1],I=l*S+f*A+g,D=d*A+c*S+m;_=Math.min(_,I-o),T=Math.max(T,I+o),x=Math.min(x,D-h),y=Math.max(y,D+h)}this.minX=_,this.minY=x,this.maxX=T,this.maxY=y}addBounds(t){const e=this.minX,n=this.minY,r=this.maxX,o=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,e){const n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,o=t.maxX<e.maxX?t.maxX:e.maxX,h=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=o&&r<=h){const l=this.minX,c=this.minY,f=this.maxX,d=this.maxY;this.minX=n<l?n:l,this.minY=r<c?r:c,this.maxX=o>f?o:f,this.maxY=h>d?h:d}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,o=t.maxX<e.x+e.width?t.maxX:e.x+e.width,h=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=o&&r<=h){const l=this.minX,c=this.minY,f=this.maxX,d=this.maxY;this.minX=n<l?n:l,this.minY=r<c?r:c,this.maxX=o>f?o:f,this.maxY=h>d?h:d}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,n,r,o,h){t-=o,e-=h,n+=o,r+=h,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r}}class zt extends ss{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new $l,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Oo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let n=0;n<e.length;++n){const r=e[n];Object.defineProperty(zt.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new wt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new wt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Oo);const e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const h=this.getBounds(!1,t);return this.parent=n,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-o,h}toGlobal(t,e,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,n=1,r=1,o=0,h=0,l=0,c=0,f=0){return this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=o,this.skew.x=h,this.skew.y=l,this.pivot.x=c,this.pivot.y=f,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new bS),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*_A}set angle(t){this.transform.rotation=t*vA}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class bS extends zt{constructor(){super(...arguments),this.sortDirty=null}}zt.prototype.displayObjectUpdateTransform=zt.prototype.updateTransform;const wS=new Gt;function TS(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const Al=class extends zt{constructor(){super(),this.children=[],this.sortableChildren=Al.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(i){}addChild(...i){if(i.length>1)for(let t=0;t<i.length;t++)this.addChild(i[t]);else{const t=i[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return i[0]}addChildAt(i,t){if(t<0||t>this.children.length)throw new Error(`${i}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.splice(t,0,i),this._boundsID++,this.onChildrenChange(t),i.emit("added",this),this.emit("childAdded",i,this,t),i}swapChildren(i,t){if(i===t)return;const e=this.getChildIndex(i),n=this.getChildIndex(t);this.children[e]=t,this.children[n]=i,this.onChildrenChange(e<n?e:n)}getChildIndex(i){const t=this.children.indexOf(i);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(i,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const e=this.getChildIndex(i);ur(this.children,e,1),this.children.splice(t,0,i),this.onChildrenChange(t)}getChildAt(i){if(i<0||i>=this.children.length)throw new Error(`getChildAt: Index (${i}) does not exist.`);return this.children[i]}removeChild(...i){if(i.length>1)for(let t=0;t<i.length;t++)this.removeChild(i[t]);else{const t=i[0],e=this.children.indexOf(t);if(e===-1)return null;t.parent=null,t.transform._parentID=-1,ur(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e)}return i[0]}removeChildAt(i){const t=this.getChildAt(i);return t.parent=null,t.transform._parentID=-1,ur(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i),t}removeChildren(i=0,t=this.children.length){const e=i,n=t,r=n-e;let o;if(r>0&&r<=n){o=this.children.splice(e,r);for(let h=0;h<o.length;++h)o[h].parent=null,o[h].transform&&(o[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(i);for(let h=0;h<o.length;++h)o[h].emit("removed",this),this.emit("childRemoved",o[h],this,h);return o}else if(r===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let i=!1;for(let t=0,e=this.children.length;t<e;++t){const n=this.children[t];n._lastSortedIndex=t,!i&&n.zIndex!==0&&(i=!0)}i&&this.children.length>1&&this.children.sort(TS),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let i=0,t=this.children.length;i<t;++i){const e=this.children[i];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let i=0;i<this.children.length;i++){const t=this.children[i];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(i,t=!1){const e=super.getLocalBounds(i);if(!t)for(let n=0,r=this.children.length;n<r;++n){const o=this.children[n];o.visible&&o.updateTransform()}return e}_calculateBounds(){}_renderWithCulling(i){const t=i.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let e,n;this.cullArea?(e=this.cullArea,n=this.worldTransform):this._render!==Al.prototype._render&&(e=this.getBounds(!0));const r=i.projection.transform;if(r&&(n?(n=wS.copyFrom(n),n.prepend(r)):n=r),e&&t.intersects(e,n))this._render(i);else if(this.cullArea)return;for(let o=0,h=this.children.length;o<h;++o){const l=this.children[o],c=l.cullable;l.cullable=c||!this.cullArea,l.render(i),l.cullable=c}}render(i){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(i);else if(this.cullable)this._renderWithCulling(i);else{this._render(i);for(let e=0,n=this.children.length;e<n;++e)this.children[e].render(i)}}renderAdvanced(i){var r,o,h;const t=this.filters,e=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<t.length;l++)t[l].enabled&&this._enabledFilters.push(t[l])}const n=t&&((r=this._enabledFilters)==null?void 0:r.length)||e&&(!e.isMaskData||e.enabled&&(e.autoDetect||e.type!==se.NONE));if(n&&i.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&i.filter.push(this,this._enabledFilters),e&&i.mask.push(this,this._mask),this.cullable)this._renderWithCulling(i);else{this._render(i);for(let l=0,c=this.children.length;l<c;++l)this.children[l].render(i)}n&&i.batch.flush(),e&&i.mask.pop(this),t&&((h=this._enabledFilters)!=null&&h.length)&&i.filter.pop()}_render(i){}destroy(i){super.destroy(),this.sortDirty=!1;const t=typeof i=="boolean"?i:i==null?void 0:i.children,e=this.removeChildren(0,this.children.length);if(t)for(let n=0;n<e.length;++n)e[n].destroy(i)}get width(){return this.scale.x*this.getLocalBounds().width}set width(i){const t=this.getLocalBounds().width;t!==0?this.scale.x=i/t:this.scale.x=1,this._width=i}get height(){return this.scale.y*this.getLocalBounds().height}set height(i){const t=this.getLocalBounds().height;t!==0?this.scale.y=i/t:this.scale.y=1,this._height=i}};let ke=Al;ke.defaultSortableChildren=!1;ke.prototype.containerUpdateTransform=ke.prototype.updateTransform;Object.defineProperties(K,{SORTABLE_CHILDREN:{get(){return ke.defaultSortableChildren},set(i){At("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ke.defaultSortableChildren=i}}});const $r=new Et,ES=new Uint16Array([0,1,2,0,2,3]);class yr extends ke{constructor(t){super(),this._anchor=new on(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=lt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||nt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ES,this.pluginName="batch",this.isSprite=!0,this._roundPixels=K.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=or(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=or(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,n=e.a,r=e.b,o=e.c,h=e.d,l=e.tx,c=e.ty,f=this.vertexData,d=t.trim,g=t.orig,m=this._anchor;let _=0,x=0,T=0,y=0;if(d?(x=d.x-m._x*g.width,_=x+d.width,y=d.y-m._y*g.height,T=y+d.height):(x=-m._x*g.width,_=x+g.width,y=-m._y*g.height,T=y+g.height),f[0]=n*x+o*y+l,f[1]=h*y+r*x+c,f[2]=n*_+o*y+l,f[3]=h*y+r*_+c,f[4]=n*_+o*T+l,f[5]=h*T+r*_+c,f[6]=n*x+o*T+l,f[7]=h*T+r*x+c,this._roundPixels){const E=K.RESOLUTION;for(let S=0;S<f.length;++S)f[S]=Math.round(f[S]*E)/E}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,n=t.orig,r=this._anchor,o=this.transform.worldTransform,h=o.a,l=o.b,c=o.c,f=o.d,d=o.tx,g=o.ty,m=-r._x*n.width,_=m+n.width,x=-r._y*n.height,T=x+n.height;e[0]=h*m+c*x+d,e[1]=f*x+l*m+g,e[2]=h*_+c*x+d,e[3]=f*x+l*_+g,e[4]=h*_+c*T+d,e[5]=f*T+l*_+g,e[6]=h*m+c*T+d,e[7]=f*T+l*m+g}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Oo),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new wt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,$r);const e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x;let o=0;return $r.x>=r&&$r.x<r+e&&(o=-n*this.anchor.y,$r.y>=o&&$r.y<o+n)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!n)}this._texture=null}static from(t,e){const n=t instanceof nt?t:nt.from(t,e);return new yr(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=or(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=or(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||nt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Kp=new Gt;zt.prototype._cacheAsBitmap=!1;zt.prototype._cacheData=null;zt.prototype._cacheAsBitmapResolution=null;zt.prototype._cacheAsBitmapMultisample=null;class AS{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(zt.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new AS),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});zt.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};zt.prototype._initCachedDisplayObject=function(t){var m,_;if((m=this._cacheData)!=null&&m.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const n=this.getLocalBounds(null,!0).clone();if((_=this.filters)!=null&&_.length){const x=this.filters[0].padding;n.pad(x)}n.ceil(K.RESOLUTION);const r=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),h=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,c=cn.create({width:n.width,height:n.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),f=`cacheAsBitmap_${Fn()}`;this._cacheData.textureCacheId=f,ft.addToCache(c.baseTexture,f),nt.addToCache(c,f);const d=this.transform.localTransform.copyTo(Kp).invert().translate(-n.x,-n.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(r,o,h),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const g=new yr(c);g.transform.worldTransform=this.transform.worldTransform,g.anchor.x=-(n.x/n.width),g.anchor.y=-(n.y/n.height),g.alpha=e,g._bounds=this._bounds,this._cacheData.sprite=g,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=g.containsPoint.bind(g)};zt.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};zt.prototype._initCachedDisplayObjectCanvas=function(t){var d;if((d=this._cacheData)!=null&&d.sprite)return;const e=this.getLocalBounds(null,!0),n=this.alpha;this.alpha=1;const r=t.canvasContext.activeContext,o=t._projTransform;e.ceil(K.RESOLUTION);const h=cn.create({width:e.width,height:e.height}),l=`cacheAsBitmap_${Fn()}`;this._cacheData.textureCacheId=l,ft.addToCache(h.baseTexture,l),nt.addToCache(h,l);const c=Kp;this.transform.localTransform.copyTo(c),c.invert(),c.tx-=e.x,c.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.canvasContext.activeContext=r,t._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=n;const f=new yr(h);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(e.x/e.width),f.anchor.y=-(e.y/e.height),f.alpha=n,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=f.containsPoint.bind(f)};zt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};zt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};zt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ft.removeFromCache(this._cacheData.textureCacheId),nt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};zt.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};zt.prototype.name=null;ke.prototype.getChildByName=function(t,e){for(let n=0,r=this.children.length;n<r;n++)if(this.children[n].name===t)return this.children[n];if(e)for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n];if(!o.getChildByName)continue;const h=o.getChildByName(t,!0);if(h)return h}return null};zt.prototype.getGlobalPosition=function(t=new Et,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var SS=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class CS extends be{constructor(t=1){super(_S,SS,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const IS={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},RS=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function PS(i){const t=IS[i],e=t.length;let n=RS,r="";const o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let h;for(let l=0;l<i;l++){let c=o.replace("%index%",l.toString());h=l,l>=e&&(h=i-l-1),c=c.replace("%value%",t[h].toString()),r+=c,r+=`
`}return n=n.replace("%blur%",r),n=n.replace("%size%",i.toString()),n}const MS=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function DS(i,t){const e=Math.ceil(i/2);let n=MS,r="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let h=0;h<i;h++){let l=o.replace("%index%",h.toString());l=l.replace("%sampleIndex%",`${h-(e-1)}.0`),r+=l,r+=`
`}return n=n.replace("%blur%",r),n=n.replace("%size%",i.toString()),n}class Sl extends be{constructor(t,e=8,n=4,r=K.FILTER_RESOLUTION,o=5){const h=DS(o,t),l=PS(o);super(h,l),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=n,this.blur=e}apply(t,e,n,r){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/e.width):this.uniforms.strength=1/n.height*(n.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,n,r);else{const o=t.getFilterTexture(),h=t.renderer;let l=e,c=o;this.state.blend=!1,t.applyFilter(this,l,c,yi.CLEAR);for(let f=1;f<this.passes-1;f++){t.bindAndClear(l,yi.BLIT),this.uniforms.uSampler=c;const d=c;c=l,l=d,h.shader.bind(this),h.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,c,n,r),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class BS extends be{constructor(t=8,e=4,n=be.defaultResolution,r=5){super(),this.blurXFilter=new Sl(!0,t,e,n,r),this.blurYFilter=new Sl(!1,t,e,n,r),this.resolution=n,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,n,r){const o=Math.abs(this.blurXFilter.strength),h=Math.abs(this.blurYFilter.strength);if(o&&h){const l=t.getFilterTexture();this.blurXFilter.apply(t,e,l,yi.CLEAR),this.blurYFilter.apply(t,l,n,r),t.returnFilterTexture(l)}else h?this.blurYFilter.apply(t,e,n,r):this.blurXFilter.apply(t,e,n,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var FS=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Cl extends be{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(zp,FS,t),this.alpha=1}_loadMatrix(t,e=!1){let n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}tint(t,e){const n=t>>16&255,r=t>>8&255,o=t&255,h=[n/255,0,0,0,0,0,r/255,0,0,0,0,0,o/255,0,0,0,0,0,1,0];this._loadMatrix(h,e)}greyscale(t,e){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const n=Math.cos(t),r=Math.sin(t),o=Math.sqrt,h=1/3,l=o(h),c=n+(1-n)*h,f=h*(1-n)-l*r,d=h*(1-n)+l*r,g=h*(1-n)+l*r,m=n+h*(1-n),_=h*(1-n)-l*r,x=h*(1-n)-l*r,T=h*(1-n)+l*r,y=n+h*(1-n),E=[c,f,d,0,0,g,m,_,0,0,x,T,y,0,0,0,0,0,1,0];this._loadMatrix(E,e)}contrast(t,e){const n=(t||0)+1,r=-.5*(n-1),o=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(o,e)}saturate(t=0,e){const n=t*2/3+1,r=(n-1)*-.5,o=[n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0];this._loadMatrix(o,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,n,r,o){t=t||.2,e=e||.15,n=n||16770432,r=r||3375104;const h=(n>>16&255)/255,l=(n>>8&255)/255,c=(n&255)/255,f=(r>>16&255)/255,d=(r>>8&255)/255,g=(r&255)/255,m=[.3,.59,.11,0,0,h,l,c,t,0,f,d,g,e,0,h-f,l-d,c-g,0,0];this._loadMatrix(m,o)}night(t,e){t=t||.1;const n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,e)}predator(t,e){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}Cl.prototype.grayscale=Cl.prototype.greyscale;var LS=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,OS=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class NS extends be{constructor(t,e){const n=new Gt;t.renderable=!1,super(OS,LS,{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,e==null&&(e=20),this.scale=new Et(e,e)}apply(t,e,n,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,h=Math.sqrt(o.a*o.a+o.b*o.b),l=Math.sqrt(o.c*o.c+o.d*o.d);h!==0&&l!==0&&(this.uniforms.rotation[0]=o.a/h,this.uniforms.rotation[1]=o.b/h,this.uniforms.rotation[2]=o.c/l,this.uniforms.rotation[3]=o.d/l),t.applyFilter(this,e,n,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var kS=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,US=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class GS extends be{constructor(){super(US,kS)}}var WS=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class HS extends be{constructor(t=.5,e=Math.random()){super(zp,WS,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const gd={AlphaFilter:CS,BlurFilter:BS,BlurFilterPass:Sl,ColorMatrixFilter:Cl,DisplacementFilter:NS,FXAAFilter:GS,NoiseFilter:HS};Object.entries(gd).forEach(([i,t])=>{Object.defineProperty(gd,i,{get(){return At("7.1.0",`filters.${i} has moved to ${i}`),t}})});class as{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=as.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Et,this.page=new Et,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,r,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class No extends as{constructor(){super(...arguments),this.client=new Et,this.movement=new Et,this.offset=new Et,this.global=new Et,this.screen=new Et}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,r,o,h,l,c,f,d,g,m,_,x,T){throw new Error("Method not implemented.")}}class si extends No{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Il extends No{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const XS=2048,zS=new Et,Hh=new Et;class $S{constructor(t){this.dispatch=new ss,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((n,r)=>n.priority-r.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,r=e.length;n<r;n++)e[n].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const n=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,zS.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,o=n.length-1;r<o;r++)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let r=n.length-2;r>=0;r--)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const r=n.children;if(r)for(let o=0;o<r.length;o++)this.all(t,e,r[o]);t.currentTarget=n,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let n=0;n<XS&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,n,r,o){if(!t||!t.visible||o(t,n))return null;if(t.interactiveChildren&&t.children){const h=t.children;for(let l=h.length-1;l>=0;l--){const c=h[l],f=this.hitTestRecursive(c,e||c.interactive,n,r,o);if(f){if(f.length>0&&!f[f.length-1].parent)continue;return(f.length>0||t.interactive)&&f.push(t),f}}}return e&&r(t,n)?t.interactive?[t]:[]:null}hitPruneFn(t,e){var n;if(t.hitArea&&(t.worldTransform.applyInverse(e,Hh),!t.hitArea.contains(Hh.x,Hh.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!((n=r.containsPoint)!=null&&n.call(r,e)))return!0}return!1}hitTestFn(t,e){return t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var o,h;e=e??t.type;const n=`on${e}`;(h=(o=t.currentTarget)[n])==null||h.call(o,t);const r=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,r),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof si)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const r=e.button===2;this.dispatchEvent(e,r?"rightdown":"mousedown")}const n=this.trackingData(t.pointerId);n.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var l;if(!(t instanceof si)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t),n=e.pointerType==="mouse"||e.pointerType==="pen",r=this.trackingData(t.pointerId),o=this.findMountedTarget(r.overTargets);if(r.overTargets&&o!==e.target){const c=t.type==="mousemove"?"mouseout":"pointerout",f=this.createPointerEvent(t,c,o);if(this.dispatchEvent(f,"pointerout"),n&&this.dispatchEvent(f,"mouseout"),!e.composedPath().includes(o)){const d=this.createPointerEvent(t,"pointerleave",o);for(d.eventPhase=d.AT_TARGET;d.target&&!e.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(f)}if(o!==e.target){const c=t.type==="mousemove"?"mouseover":"pointerover",f=this.clonePointerEvent(e,c);this.dispatchEvent(f,"pointerover"),n&&this.dispatchEvent(f,"mouseover");let d=o==null?void 0:o.parent;for(;d&&d!==this.rootTarget.parent&&d!==e.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const m=this.clonePointerEvent(e,"pointerenter");for(m.eventPhase=m.AT_TARGET;m.target&&m.target!==o&&m.target!==this.rootTarget.parent;)m.currentTarget=m.target,this.notifyTarget(m),n&&this.notifyTarget(m,"mouseenter"),m.target=m.target.parent;this.freeEvent(m)}this.freeEvent(f)}const h=this.moveOnAll?"all":"dispatchEvent";this[h](e,"pointermove"),e.pointerType==="touch"&&this[h](e,"touchmove"),n&&(this[h](e,"mousemove"),this.cursor=(l=e.target)==null?void 0:l.cursor),r.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var h;if(!(t instanceof si)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.createPointerEvent(t),r=n.pointerType==="mouse"||n.pointerType==="pen";this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover"),n.pointerType==="mouse"&&(this.cursor=(h=n.target)==null?void 0:h.cursor);const o=this.clonePointerEvent(n,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;e.overTargets=n.composedPath(),this.freeEvent(n),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof si)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const n=t.pointerType==="mouse"||t.pointerType==="pen",r=this.findMountedTarget(e.overTargets),o=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(o),n&&this.dispatchEvent(o,"mouseout");const h=this.createPointerEvent(t,"pointerleave",r);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),n&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;e.overTargets=null,this.freeEvent(o),this.freeEvent(h)}this.cursor=null}mapPointerUp(t){if(!(t instanceof si)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const l=n.button===2;this.dispatchEvent(n,l?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),o=this.findMountedTarget(r.pressTargetsByButton[t.button]);let h=o;if(o&&!n.composedPath().includes(o)){let l=o;for(;l&&!n.composedPath().includes(l);){if(n.currentTarget=l,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const c=n.button===2;this.notifyTarget(n,c?"rightupoutside":"mouseupoutside")}l=l.parent}delete r.pressTargetsByButton[t.button],h=l}if(h){const l=this.clonePointerEvent(n,"click");l.target=h,l.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:l.target,timeStamp:e});const c=r.clicksByButton[t.button];c.target===l.target&&e-c.timeStamp<200?++c.clickCount:c.clickCount=1,c.target=l.target,c.timeStamp=e,l.detail=c.clickCount,l.pointerType==="mouse"?this.dispatchEvent(l,"click"):l.pointerType==="touch"&&this.dispatchEvent(l,"tap"),this.dispatchEvent(l,"pointertap"),this.freeEvent(l)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof si)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(n){let o=n;for(;o;)r.currentTarget=o,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch"?this.notifyTarget(r,"touchendoutside"):(r.pointerType==="mouse"||r.pointerType==="pen")&&this.notifyTarget(r,r.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof Il)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const r=this.allocateEvent(si);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=n??this.hitTest(r.global.x,r.global.y),typeof e=="string"&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(Il);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(si);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof si&&e instanceof si&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof No&&e instanceof No&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const n=t.currentTarget._events[e];if(n)if("fn"in n)n.fn.call(n.context,t);else for(let r=0,o=n.length;r<o&&!t.propagationImmediatelyStopped;r++)n[r].fn.call(n[r].context,t)}}const VS=1,YS={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Zp{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new $S(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new si(null),this.rootWheelEvent=new Il(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let n=0,r=e.length;n<r;n++){const o=e[n],h=this.bootstrapEvent(this.rootPointerEvent,o);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const o=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let o=0,h=r.length;o<h;o++){const l=this.bootstrapEvent(this.rootPointerEvent,r[o]);l.type+=n,this.rootBoundary.mapEvent(l)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&t.pointerType==="touch")return;const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const o=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,n){let r;this.domElement.parentElement?r=this.domElement.getBoundingClientRect():r={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const o=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*o,t.y=(n-r.top)*(this.domElement.height/r.height)*o}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,r=t.changedTouches.length;n<r;n++){const o=t.changedTouches[n];typeof o.button>"u"&&(o.button=0),typeof o.buttons>"u"&&(o.buttons=1),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const n=t;typeof n.isPrimary>"u"&&(n.isPrimary=!0),typeof n.width>"u"&&(n.width=1),typeof n.height>"u"&&(n.height=1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="mouse"),typeof n.pointerId>"u"&&(n.pointerId=VS),typeof n.pressure>"u"&&(n.pressure=.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=YS[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}Zp.extension={name:"events",type:[q.RendererSystem,q.CanvasRendererSystem]};rt.add(Zp);const jS={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,r=typeof t=="function"?void 0:t;i=n?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,r)},removeEventListener(i,t,e){const n=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,r=typeof t=="function"?void 0:t;i=n?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,r)},dispatchEvent(i){if(!(i instanceof as))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};zt.mixin(jS);const qS={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};zt.mixin(qS);const KS=9,fo=100,ZS=0,JS=0,md=2,_d=1,QS=-1e3,tC=-1e3,eC=2;class Jp{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Wi.tablet||Wi.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${fo}px`,e.style.height=`${fo}px`,e.style.position="absolute",e.style.top=`${ZS}px`,e.style.left=`${JS}px`,e.style.zIndex=md.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${_d}px`,t.style.height=`${_d}px`,t.style.position="absolute",t.style.top=`${QS}px`,t.style.left=`${tC}px`,t.style.zIndex=eC.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}update(){const t=performance.now();if(Wi.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:n,width:r,height:o}=this.renderer.view.getBoundingClientRect(),{width:h,height:l,resolution:c}=this.renderer,f=r/h*c,d=o/l*c;let g=this.div;g.style.left=`${e}px`,g.style.top=`${n}px`,g.style.width=`${h}px`,g.style.height=`${l}px`;for(let m=0;m<this.children.length;m++){const _=this.children[m];if(_.renderId!==this.renderId)_._accessibleActive=!1,ur(this.children,m,1),this.div.removeChild(_._accessibleDiv),this.pool.push(_._accessibleDiv),_._accessibleDiv=null,m--;else{g=_._accessibleDiv;let x=_.hitArea;const T=_.worldTransform;_.hitArea?(g.style.left=`${(T.tx+x.x*T.a)*f}px`,g.style.top=`${(T.ty+x.y*T.d)*d}px`,g.style.width=`${x.width*T.a*f}px`,g.style.height=`${x.height*T.d*d}px`):(x=_.getBounds(),this.capHitArea(x),g.style.left=`${x.x*f}px`,g.style.top=`${x.y*d}px`,g.style.width=`${x.width*f}px`,g.style.height=`${x.height*d}px`,g.title!==_.accessibleTitle&&_.accessibleTitle!==null&&(g.title=_.accessibleTitle),g.getAttribute("aria-label")!==_.accessibleHint&&_.accessibleHint!==null&&g.setAttribute("aria-label",_.accessibleHint)),(_.accessibleTitle!==g.title||_.tabIndex!==g.tabIndex)&&(g.title=_.accessibleTitle,g.tabIndex=_.tabIndex,this.debug&&this.updateDebugHTML(g))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:n}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${fo}px`,e.style.height=`${fo}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=md.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:n}=t.target,r=this.renderer.events.rootBoundary,o=Object.assign(new as(r),{target:n});r.rootTarget=this.renderer.lastObjectRendered,e.forEach(h=>r.dispatchEvent(o,h))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===KS&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Jp.extension={name:"accessibility",type:[q.RendererPlugin,q.CanvasRendererPlugin]};rt.add(Jp);const Rl=class{constructor(i){this.stage=new ke,i=Object.assign({forceCanvas:!1},i),this.renderer=pS(i),Rl._plugins.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,t){const e=Rl._plugins.slice(0);e.reverse(),e.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let Yl=Rl;Yl._plugins=[];rt.handleByList(q.Application,Yl._plugins);class Qp{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,n;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:o}=this._resizeTo;e=r,n=o}this.renderer.resize(e,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Qp.extension=q.Application;rt.add(Qp);const vd={loader:q.LoadParser,resolver:q.ResolveParser,cache:q.CacheParser,detection:q.DetectionParser};rt.handle(q.Asset,i=>{const t=i.ref;Object.entries(vd).filter(([e])=>!!t[e]).forEach(([e,n])=>rt.add(Object.assign(t[e],{extension:t[e].extension??n})))},i=>{const t=i.ref;Object.keys(vd).filter(e=>!!t[e]).forEach(e=>rt.remove(t[e]))});class iC{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function tg(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function Jo(i,t){const e=i.split("?")[0],n=fe.extname(e).toLowerCase();return Array.isArray(t)?t.includes(n):n===t}const Hi=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>typeof e=="string"?t(e):e):i);function eg(i,t,e,n,r){const o=t[e];for(let h=0;h<o.length;h++){const l=o[h];e<t.length-1?eg(i.replace(n[e],l),t,e+1,n,r):r.push(i.replace(n[e],l))}}function nC(i){const t=/\{(.*?)\}/g,e=i.match(t),n=[];if(e){const r=[];e.forEach(o=>{const h=o.substring(1,o.length-1).split(",");r.push(h)}),eg(i,r,0,e,n)}else n.push(i);return n}const ko=i=>!Array.isArray(i);class rC{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const n=Hi(t);let r;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(e)){r=c.getCacheableAssets(n,e);break}}r||(r={},n.forEach(l=>{r[l]=e}));const o=Object.keys(r),h={cacheKeys:o,keys:n};if(n.forEach(l=>{this._cacheMap.set(l,h)}),o.forEach(l=>{this._cache.has(l)&&this._cache.get(l)!==e&&console.warn("[Cache] already has key:",l),this._cache.set(l,r[l])}),e instanceof nt){const l=e;n.forEach(c=>{l.baseTexture!==nt.EMPTY.baseTexture&&ft.addToCache(l.baseTexture,c),nt.addToCache(l,c)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const Vr=new rC;class sC{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{var o,h;let r=null;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.load&&((o=c.test)!=null&&o.call(c,t,e,this))){r=await c.load(t,e,this),n.parser=c;break}}if(!n.parser)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has being added`),null;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];c.parse&&c.parse&&await((h=c.testParse)==null?void 0:h.call(c,r,e,this))&&(r=await c.parse(r,e,this)||r,n.parser=c)}return r})(),n}async load(t,e){let n=0;const r={},o=ko(t),h=Hi(t,f=>({src:f})),l=h.length,c=h.map(async f=>{const d=fe.toAbsolute(f.src);if(!r[f.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,f)),r[f.src]=await this.promiseCache[d].promise,e&&e(++n/l)}catch(g){throw delete this.promiseCache[d],delete r[f.src],new Error(`[Loader.load] Failed to load ${d}.
${g}`)}});return await Promise.all(c),o?r[h[0].src]:r}async unload(t){const n=Hi(t,r=>({src:r})).map(async r=>{var l,c;const o=fe.toAbsolute(r.src),h=this.promiseCache[o];if(h){const f=await h.promise;(c=(l=h.parser)==null?void 0:l.unload)==null||c.call(l,f,r,this),delete this.promiseCache[o]}});await Promise.all(n)}get parsers(){return this._parsers}}var Ci=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Ci||{});const oC={extension:{type:q.LoadParser,priority:Ci.Low},test(i){return fe.extname(i).toLowerCase()===".json"},async load(i){return await(await K.ADAPTER.fetch(i)).json()}};rt.add(oC);const aC={extension:{type:q.LoadParser,priority:Ci.Low},test(i){return fe.extname(i).toLowerCase()===".txt"},async load(i){return await(await K.ADAPTER.fetch(i)).text()}};rt.add(aC);const hC=["normal","bold","100","200","300","400","500","600","700","800","900"],lC=[".ttf",".otf",".woff",".woff2"],uC=["font/ttf","font/otf","font/woff","font/woff2"];function cC(i){const t=fe.extname(i);return fe.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ")}const fC={extension:{type:q.LoadParser,priority:Ci.Low},test(i){return tg(i,uC)||Jo(i,lC)},async load(i,t){var n,r,o;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const e=K.ADAPTER.getFontFaceSet();if(e){const h=[],l=((n=t.data)==null?void 0:n.family)??cC(i),c=((o=(r=t.data)==null?void 0:r.weights)==null?void 0:o.filter(d=>hC.includes(d)))??["normal"],f=t.data??{};for(let d=0;d<c.length;d++){const g=c[d],m=new FontFace(l,`url(${encodeURI(i)})`,{...f,weight:g});await m.load(),e.add(m),h.push(m)}return h.length===1?h[0]:h}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>K.ADAPTER.getFontFaceSet().delete(t))}};rt.add(fC);let xd=0,Xh;const dC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",pC={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${dC}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},gC={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let zh;class mC{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([pC.code],{type:"application/javascript"})),n=new Worker(e);n.addEventListener("message",r=>{n.terminate(),URL.revokeObjectURL(e),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Xh===void 0&&(Xh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Xh&&(zh||(zh=URL.createObjectURL(new Blob([gC.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(zh),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const n=new Promise((r,o)=>{this.queue.push({id:t,arguments:e,resolve:r,reject:o})});return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),n=e.id;this.resolveHash[xd]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:xd++,id:n})}}const yd=new mC;function Qo(i,t,e){const n=new nt(i);return n.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),n}const _C=[".jpeg",".jpg",".png",".webp",".avif"],vC=["image/jpeg","image/png","image/webp","image/avif"];async function xC(i){const t=await K.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const rs={extension:{type:q.LoadParser,priority:Ci.High},config:{preferWorkers:!0},test(i){return tg(i,vC)||Jo(i,_C)},async load(i,t,e){let n=null;globalThis.createImageBitmap?this.config.preferWorkers&&await yd.isImageBitmapSupported()?n=await yd.loadImageBitmap(i):n=await xC(i):n=await new Promise(o=>{n=new Image,n.crossOrigin="anonymous",n.src=i,n.complete?o(n):n.onload=()=>{o(n)}});const r=new ft(n,{resolution:hn(i),...t.data});return r.resource.src=i,Qo(r,e,i)},unload(i){i.destroy(!0)}};rt.add(rs);const yC={extension:{type:q.LoadParser,priority:Ci.High},test(i){return fe.extname(i).toLowerCase()===".svg"},async testParse(i){return ns.test(i)},async parse(i,t,e){var h,l,c;const n=new ns(i,(h=t==null?void 0:t.data)==null?void 0:h.resourceOptions),r=new ft(n,{resolution:hn(i),...t==null?void 0:t.data});r.resource.src=i;const o=Qo(r,e,i);return(c=(l=t==null?void 0:t.data)==null?void 0:l.resourceOptions)!=null&&c.autoLoad||await n.load(),o},async load(i,t){return(await K.ADAPTER.fetch(i)).text()},unload:rs.unload};rt.add(yC);class bC{constructor(){this._bundleIdConnector="-",this._createBundleAssetId=(t,e)=>`${t}${this._bundleIdConnector}${e}`,this._extractAssetIdFromBundle=(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,""),this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(e[n])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const n=[];Array.isArray(e)?e.forEach(r=>{if(typeof r.name=="string"){const o=this._createBundleAssetId(t,r.name);n.push(o),this.add([r.name,o],r.srcs)}else{const o=r.name.map(h=>this._createBundleAssetId(t,h));o.forEach(h=>{n.push(h)}),this.add([...r.name,...o],r.srcs)}}):Object.keys(e).forEach(r=>{n.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],e[r])}),this._bundles[t]=n}add(t,e,n){const r=Hi(t);r.forEach(h=>{this._assetMap[h]&&console.warn(`[Resolver] already has key: ${h} overwriting`)}),Array.isArray(e)||(typeof e=="string"?e=nC(e):e=[e]);const o=e.map(h=>{let l=h;if(typeof h=="string"){let c=!1;for(let f=0;f<this._parsers.length;f++){const d=this._parsers[f];if(d.test(h)){l=d.parse(h),c=!0;break}}c||(l={src:h})}return l.format||(l.format=l.src.split(".").pop()),l.alias||(l.alias=r),(this._basePath||this._rootPath)&&(l.src=fe.toAbsolute(l.src,this._basePath,this._rootPath)),l.src=this._appendDefaultSearchParams(l.src),l.data=l.data??n,l});r.forEach(h=>{this._assetMap[h]=o})}resolveBundle(t){const e=ko(t);t=Hi(t);const n={};return t.forEach(r=>{const o=this._bundles[r];if(o){const h=this.resolve(o),l={};for(const c in h){const f=h[c];l[this._extractAssetIdFromBundle(r,c)]=f}n[r]=l}}),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const n={};for(const r in e)n[r]=e[r].src;return n}return e.src}resolve(t){const e=ko(t);t=Hi(t);const n={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let o=this._assetMap[r];const h=this._getPreferredOrder(o),l=o[0];h==null||h.priority.forEach(c=>{h.params[c].forEach(f=>{const d=o.filter(g=>g[c]?g[c]===f:!1);d.length&&(o=d)})}),this._resolverHash[r]=o[0]??l}else{let o=r;(this._basePath||this._rootPath)&&(o=fe.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[r]={src:o}}n[r]=this._resolverHash[r]}),e?n[t[0]]:n}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const n=t[0],r=this._preferredOrder.find(o=>o.params.format.includes(n.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}}class wC{constructor(){this._detections=[],this._initialized=!1,this.resolver=new bC,this.loader=new sC,this.cache=Vr,this._backgroundLoader=new iC(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var o,h,l;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let c=t.manifest;typeof c=="string"&&(c=await this.load(c)),this.resolver.addManifest(c)}const e=((o=t.texturePreference)==null?void 0:o.resolution)??1,n=typeof e=="number"?[e]:e;let r=[];if((h=t.texturePreference)!=null&&h.format){const c=(l=t.texturePreference)==null?void 0:l.format;r=typeof c=="string"?[c]:c;for(const f of this._detections)await f.test()||(r=await f.remove(r))}else for(const c of this._detections)await c.test()&&(r=await c.add(r));this.resolver.prefer({params:{format:r,resolution:n}})}add(t,e,n){this.resolver.add(t,e,n)}async load(t,e){this._initialized||await this.init();const n=ko(t),r=Hi(t).map(l=>typeof l!="string"?(this.resolver.add(l.src,l),l.src):l),o=this.resolver.resolve(r),h=await this._mapLoadToResolve(o,e);return n?h[r[0]]:h}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;typeof t=="string"&&(n=!0,t=[t]);const r=this.resolver.resolveBundle(t),o={},h=Object.keys(r);let l=0,c=0;const f=()=>{e==null||e(++l/c)},d=h.map(g=>{const m=r[g];return c+=Object.keys(m).length,this._mapLoadToResolve(m,f).then(_=>{o[g]=_})});return await Promise.all(d),n?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Vr.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=Vr.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const o=await this.loader.load(n,e);this._backgroundLoader.active=!0;const h={};return n.forEach((l,c)=>{const f=o[l.src],d=[l.src];l.alias&&d.push(...l.alias),h[r[c]]=f,Vr.set(d,f)}),h}async unload(t){this._initialized||await this.init();const e=Hi(t).map(r=>typeof r!="string"?r.src:r),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=Hi(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(n=>{Vr.remove(n.src)}),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return rs.config.preferWorkers}set preferWorkers(t){rs.config.preferWorkers=t}}const Rn=new wC;rt.handleByList(q.LoadParser,Rn.loader.parsers).handleByList(q.ResolveParser,Rn.resolver.parsers).handleByList(q.CacheParser,Rn.cache.parsers).handleByList(q.DetectionParser,Rn.detections);const TC={extension:q.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof nt),getCacheableAssets:(i,t)=>{const e={};return i.forEach(n=>{t.forEach((r,o)=>{e[n+(o===0?"":o+1)]=r})}),e}};rt.add(TC);const EC={extension:{type:q.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await K.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};rt.add(EC);const AC={extension:{type:q.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await K.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};rt.add(AC);const bd=["png","jpg","jpeg"],SC={extension:{type:q.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...bd],remove:async i=>i.filter(t=>!bd.includes(t))};rt.add(SC);const CC={extension:q.ResolveParser,test:rs.test,parse:i=>{var t;return{resolution:parseFloat(((t=K.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:i.split(".").pop(),src:i}}};rt.add(CC);var Oe=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(Oe||{});const Uo={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};let ki,rr;function wd(){rr={s3tc:ki.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ki.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:ki.getExtension("WEBGL_compressed_texture_etc"),etc1:ki.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:ki.getExtension("WEBGL_compressed_texture_pvrtc")||ki.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:ki.getExtension("WEBGL_compressed_texture_atc"),astc:ki.getExtension("WEBGL_compressed_texture_astc")}}const IC={extension:{type:q.DetectionParser,priority:2},test:async()=>{const t=K.ADAPTER.createCanvas().getContext("webgl");return t?(ki=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{rr||wd();const t=[];for(const e in rr)rr[e]&&t.push(e);return[...t,...i]},remove:async i=>(rr||wd(),i.filter(t=>!(t in rr)))};rt.add(IC);class RC extends os{constructor(t,e={width:1,height:1,autoLoad:!0}){let n,r;typeof t=="string"?(n=t,r=new Uint8Array):(n=null,r=t),super(r,e),this.origin=n,this.buffer=r?new ml(r):null,this.origin&&e.autoLoad!==!1&&this.load(),r!=null&&r.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const n=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(n),this.buffer=new ml(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),this}}class Dn extends RC{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Dn._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Dn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,n){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let h=0,l=this.levels;h<l;h++){const{levelID:c,levelWidth:f,levelHeight:d,levelBuffer:g}=this._levelBuffers[h];r.compressedTexImage2D(r.TEXTURE_2D,c,this.format,f,d,0,g)}return!0}onBlobLoaded(){this._levelBuffers=Dn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,n,r,o,h,l){const c=new Array(n);let f=t.byteOffset,d=h,g=l,m=d+r-1&~(r-1),_=g+o-1&~(o-1),x=m*_*Uo[e];for(let T=0;T<n;T++)c[T]={levelID:T,levelWidth:n>1?d:m,levelHeight:n>1?g:_,levelBuffer:new Uint8Array(t.buffer,f,x)},f+=x,d=d>>1||1,g=g>>1||1,m=d+r-1&~(r-1),_=g+o-1&~(o-1),x=m*_*Uo[e];return c}}const $h=4,po=124,PC=32,Td=20,MC=542327876,go={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DC={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},mo={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},BC=1,FC=2,LC=4,OC=64,NC=512,kC=131072,UC=827611204,GC=861165636,WC=894720068,HC=808540228,XC=4,zC={[UC]:Oe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[GC]:Oe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[WC]:Oe.COMPRESSED_RGBA_S3TC_DXT5_EXT},$C={[70]:Oe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Oe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Oe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Oe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Oe.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Oe.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Oe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Oe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Oe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function VC(i){const t=new Uint32Array(i);if(t[0]!==MC)throw new Error("Invalid DDS file magic word");const n=new Uint32Array(i,0,po/Uint32Array.BYTES_PER_ELEMENT),r=n[go.HEIGHT],o=n[go.WIDTH],h=n[go.MIPMAP_COUNT],l=new Uint32Array(i,go.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,PC/Uint32Array.BYTES_PER_ELEMENT),c=l[BC];if(c&LC){const f=l[DC.FOURCC];if(f!==HC){const A=zC[f],I=$h+po,D=new Uint8Array(i,I);return[new Dn(D,{format:A,width:o,height:r,levels:h})]}const d=$h+po,g=new Uint32Array(t.buffer,d,Td/Uint32Array.BYTES_PER_ELEMENT),m=g[mo.DXGI_FORMAT],_=g[mo.RESOURCE_DIMENSION],x=g[mo.MISC_FLAG],T=g[mo.ARRAY_SIZE],y=$C[m];if(y===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${m}`);if(x===XC)throw new Error("DDSParser does not support cubemap textures");if(_===6)throw new Error("DDSParser does not supported 3D texture data");const E=new Array,S=$h+po+Td;if(T===1)E.push(new Uint8Array(i,S));else{const A=Uo[y];let I=0,D=o,N=r;for(let F=0;F<h;F++){const V=Math.max(1,D+3&-4),J=Math.max(1,N+3&-4),$=V*J*A;I+=$,D=D>>>1,N=N>>>1}let L=S;for(let F=0;F<T;F++)E.push(new Uint8Array(i,L,I)),L+=I}return E.map(A=>new Dn(A,{format:y,width:o,height:r,levels:h}))}throw c&OC?new Error("DDSParser does not support uncompressed texture data."):c&NC?new Error("DDSParser does not supported YUV uncompressed texture data."):c&kC?new Error("DDSParser does not support single-channel (lumninance) texture data!"):c&FC?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Ed=[171,75,84,88,32,49,49,187,13,10,26,10],YC=67305985,ni={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Pl=64,Ad={[st.UNSIGNED_BYTE]:1,[st.UNSIGNED_SHORT]:2,[st.INT]:4,[st.UNSIGNED_INT]:4,[st.FLOAT]:4,[st.HALF_FLOAT]:8},jC={[z.RGBA]:4,[z.RGB]:3,[z.RG]:2,[z.RED]:1,[z.LUMINANCE]:1,[z.LUMINANCE_ALPHA]:2,[z.ALPHA]:1},qC={[st.UNSIGNED_SHORT_4_4_4_4]:2,[st.UNSIGNED_SHORT_5_5_5_1]:2,[st.UNSIGNED_SHORT_5_6_5]:2};function KC(i,t,e=!1){const n=new DataView(t);if(!ZC(i,n))return null;const r=n.getUint32(ni.ENDIANNESS,!0)===YC,o=n.getUint32(ni.GL_TYPE,r),h=n.getUint32(ni.GL_FORMAT,r),l=n.getUint32(ni.GL_INTERNAL_FORMAT,r),c=n.getUint32(ni.PIXEL_WIDTH,r),f=n.getUint32(ni.PIXEL_HEIGHT,r)||1,d=n.getUint32(ni.PIXEL_DEPTH,r)||1,g=n.getUint32(ni.NUMBER_OF_ARRAY_ELEMENTS,r)||1,m=n.getUint32(ni.NUMBER_OF_FACES,r),_=n.getUint32(ni.NUMBER_OF_MIPMAP_LEVELS,r),x=n.getUint32(ni.BYTES_OF_KEY_VALUE_DATA,r);if(f===0||d!==1)throw new Error("Only 2D textures are supported");if(m!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(g!==1)throw new Error("WebGL does not support array textures");const T=4,y=4,E=c+3&-4,S=f+3&-4,A=new Array(g);let I=c*f;o===0&&(I=E*S);let D;if(o!==0?Ad[o]?D=Ad[o]*jC[h]:D=qC[o]:D=Uo[l],D===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const N=e?QC(n,x,r):null;let F=I*D,V=c,J=f,$=E,Q=S,X=Pl+x;for(let G=0;G<_;G++){const dt=n.getUint32(X,r);let _t=X+4;for(let j=0;j<g;j++){let vt=A[j];vt||(vt=A[j]=new Array(_)),vt[G]={levelID:G,levelWidth:_>1||o!==0?V:$,levelHeight:_>1||o!==0?J:Q,levelBuffer:new Uint8Array(t,_t,F)},_t+=F}X+=dt+4,X=X%4!==0?X+4-X%4:X,V=V>>1||1,J=J>>1||1,$=V+T-1&~(T-1),Q=J+y-1&~(y-1),F=$*Q*D}return o!==0?{uncompressed:A.map(G=>{let dt=G[0].levelBuffer,_t=!1;return o===st.FLOAT?dt=new Float32Array(G[0].levelBuffer.buffer,G[0].levelBuffer.byteOffset,G[0].levelBuffer.byteLength/4):o===st.UNSIGNED_INT?(_t=!0,dt=new Uint32Array(G[0].levelBuffer.buffer,G[0].levelBuffer.byteOffset,G[0].levelBuffer.byteLength/4)):o===st.INT&&(_t=!0,dt=new Int32Array(G[0].levelBuffer.buffer,G[0].levelBuffer.byteOffset,G[0].levelBuffer.byteLength/4)),{resource:new os(dt,{width:G[0].levelWidth,height:G[0].levelHeight}),type:o,format:_t?JC(h):h}}),kvData:N}:{compressed:A.map(G=>new Dn(null,{format:l,width:c,height:f,levels:_,levelBuffers:G})),kvData:N}}function ZC(i,t){for(let e=0;e<Ed.length;e++)if(t.getUint8(e)!==Ed[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function JC(i){switch(i){case z.RGBA:return z.RGBA_INTEGER;case z.RGB:return z.RGB_INTEGER;case z.RG:return z.RG_INTEGER;case z.RED:return z.RED_INTEGER;default:return i}}function QC(i,t,e){const n=new Map;let r=0;for(;r<t;){const o=i.getUint32(Pl+r,e),h=Pl+r+4,l=3-(o+3)%4;if(o===0||o>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let c=0;for(;c<o&&i.getUint8(h+c)!==0;c++);if(c===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const f=new TextDecoder().decode(new Uint8Array(i.buffer,h,c)),d=new DataView(i.buffer,h+c+1,o-c-1);n.set(f,d),r+=4+o+l}return n}const tI={extension:{type:q.LoadParser,priority:Ci.High},test(i){return Jo(i,".dds")},async load(i,t,e){const r=await(await K.ADAPTER.fetch(i)).arrayBuffer(),h=VC(r).map(l=>{const c=new ft(l,{mipmap:Si.OFF,alphaMode:pi.NO_PREMULTIPLIED_ALPHA,resolution:hn(i),...t.data});return Qo(c,e,i)});return h.length===1?h[0]:h},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};rt.add(tI);const eI={extension:{type:q.LoadParser,priority:Ci.High},test(i){return Jo(i,".ktx")},async load(i,t,e){const r=await(await K.ADAPTER.fetch(i)).arrayBuffer(),{compressed:o,uncompressed:h,kvData:l}=KC(i,r),c=o??h,f={mipmap:Si.OFF,alphaMode:pi.NO_PREMULTIPLIED_ALPHA,resolution:hn(i),...t.data},d=c.map(g=>{c===h&&Object.assign(f,{type:g.type,format:g.format});const m=new ft(g,f);return m.ktxKeyValueData=l,Qo(m,e,i)});return d.length===1?d[0]:d},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};rt.add(eI);const iI={extension:q.ResolveParser,test:i=>{const e=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:i=>{var n,r;if(i.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(h=>i.endsWith(h)))return{resolution:parseFloat(((n=K.RETINA_PREFIX.exec(i))==null?void 0:n[1])??"1"),format:o.find(h=>i.endsWith(h)),src:i}}return{resolution:parseFloat(((r=K.RETINA_PREFIX.exec(i))==null?void 0:r[1])??"1"),format:i.split(".").pop(),src:i}}};rt.add(iI);const Sd=new wt,Cd=4,Ml=class{constructor(i){this.renderer=i}async image(i,t,e){const n=new Image;return n.src=await this.base64(i,t,e),n}async base64(i,t,e){const n=this.canvas(i);if(n.toDataURL!==void 0)return n.toDataURL(t,e);if(n.convertToBlob!==void 0){const r=await n.convertToBlob({type:t,quality:e});return await new Promise(o=>{const h=new FileReader;h.onload=()=>o(h.result),h.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(i,t){const e=this.renderer;let n,r=!1,o,h=!1;i&&(i instanceof cn?o=i:(o=this.renderer.generateTexture(i),h=!0)),o?(n=o.baseTexture.resolution,t=t??o.frame,r=!1,e.renderTexture.bind(o)):(n=e.resolution,t||(t=Sd,t.width=e.width,t.height=e.height),r=!0,e.renderTexture.bind(null));const l=Math.round(t.width*n),c=Math.round(t.height*n);let f=new ed(l,c,1);const d=new Uint8Array(Cd*l*c),g=e.gl;g.readPixels(Math.round(t.x*n),Math.round(t.y*n),l,c,g.RGBA,g.UNSIGNED_BYTE,d);const m=f.context.getImageData(0,0,l,c);if(Ml.arrayPostDivide(d,m.data),f.context.putImageData(m,0,0),r){const _=new ed(f.width,f.height,1);_.context.scale(1,-1),_.context.drawImage(f.canvas,0,-c),f.destroy(),f=_}return h&&o.destroy(!0),f.canvas}pixels(i,t){const e=this.renderer;let n,r,o=!1;i&&(i instanceof cn?r=i:(r=this.renderer.generateTexture(i),o=!0)),r?(n=r.baseTexture.resolution,t=t??r.frame,e.renderTexture.bind(r)):(n=e.resolution,t||(t=Sd,t.width=e.width,t.height=e.height),e.renderTexture.bind(null));const h=Math.round(t.width*n),l=Math.round(t.height*n),c=new Uint8Array(Cd*h*l),f=e.gl;return f.readPixels(Math.round(t.x*n),Math.round(t.y*n),h,l,f.RGBA,f.UNSIGNED_BYTE,c),o&&r.destroy(!0),Ml.arrayPostDivide(c,c),c}destroy(){this.renderer=null}static arrayPostDivide(i,t){for(let e=0;e<i.length;e+=4){const n=t[e+3]=i[e+3];n!==0?(t[e]=Math.round(Math.min(i[e]*255/n,255)),t[e+1]=Math.round(Math.min(i[e+1]*255/n,255)),t[e+2]=Math.round(Math.min(i[e+2]*255/n,255))):(t[e]=i[e],t[e+1]=i[e+1],t[e+2]=i[e+2])}}};let ig=Ml;ig.extension={name:"extract",type:q.RendererSystem};rt.add(ig);const Go={build(i){const t=i.points;let e,n,r,o,h,l;if(i.type===ce.CIRC){const x=i.shape;e=x.x,n=x.y,h=l=x.radius,r=o=0}else if(i.type===ce.ELIP){const x=i.shape;e=x.x,n=x.y,h=x.width,l=x.height,r=o=0}else{const x=i.shape,T=x.width/2,y=x.height/2;e=x.x+T,n=x.y+y,h=l=Math.max(0,Math.min(x.radius,Math.min(T,y))),r=T-h,o=y-l}if(!(h>=0&&l>=0&&r>=0&&o>=0)){t.length=0;return}const c=Math.ceil(2.3*Math.sqrt(h+l)),f=c*8+(r?4:0)+(o?4:0);if(t.length=f,f===0)return;if(c===0){t.length=8,t[0]=t[6]=e+r,t[1]=t[3]=n+o,t[2]=t[4]=e-r,t[5]=t[7]=n-o;return}let d=0,g=c*4+(r?2:0)+2,m=g,_=f;{const x=r+h,T=o,y=e+x,E=e-x,S=n+T;if(t[d++]=y,t[d++]=S,t[--g]=S,t[--g]=E,o){const A=n-T;t[m++]=E,t[m++]=A,t[--_]=A,t[--_]=y}}for(let x=1;x<c;x++){const T=Math.PI/2*(x/c),y=r+Math.cos(T)*h,E=o+Math.sin(T)*l,S=e+y,A=e-y,I=n+E,D=n-E;t[d++]=S,t[d++]=I,t[--g]=I,t[--g]=A,t[m++]=A,t[m++]=D,t[--_]=D,t[--_]=S}{const x=r,T=o+l,y=e+x,E=e-x,S=n+T,A=n-T;t[d++]=y,t[d++]=S,t[--_]=A,t[--_]=y,r&&(t[d++]=E,t[d++]=S,t[--_]=A,t[--_]=E)}},triangulate(i,t){const e=i.points,n=t.points,r=t.indices;if(e.length===0)return;let o=n.length/2;const h=o;let l,c;if(i.type!==ce.RREC){const d=i.shape;l=d.x,c=d.y}else{const d=i.shape;l=d.x+d.width/2,c=d.y+d.height/2}const f=i.matrix;n.push(i.matrix?f.a*l+f.c*c+f.tx:l,i.matrix?f.b*l+f.d*c+f.ty:c),o++,n.push(e[0],e[1]);for(let d=2;d<e.length;d+=2)n.push(e[d],e[d+1]),r.push(o++,h,o);r.push(h+1,h,o)}};function Id(i,t=!1){const e=i.length;if(e<6)return;let n=0;for(let r=0,o=i[e-2],h=i[e-1];r<e;r+=2){const l=i[r],c=i[r+1];n+=(l-o)*(c+h),o=l,h=c}if(!t&&n>0||t&&n<=0){const r=e/2;for(let o=r+r%2;o<e;o+=2){const h=e-o-2,l=e-o-1,c=o,f=o+1;[i[h],i[c]]=[i[c],i[h]],[i[l],i[f]]=[i[f],i[l]]}}}const ng={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const n=i.holes,r=t.points,o=t.indices;if(e.length>=6){Id(e,!1);const h=[];for(let f=0;f<n.length;f++){const d=n[f];Id(d.points,!0),h.push(e.length/2),e=e.concat(d.points)}const l=Ul.exports(e,h,2);if(!l)return;const c=r.length/2;for(let f=0;f<l.length;f+=3)o.push(l[f]+c),o.push(l[f+1]+c),o.push(l[f+2]+c);for(let f=0;f<e.length;f++)r.push(e[f])}}},nI={build(i){const t=i.shape,e=t.x,n=t.y,r=t.width,o=t.height,h=i.points;h.length=0,r>=0&&o>=0&&h.push(e,n,e+r,n,e+r,n+o,e,n+o)},triangulate(i,t){const e=i.points,n=t.points;if(e.length===0)return;const r=n.length/2;n.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},rI={build(i){Go.build(i)},triangulate(i,t){Go.triangulate(i,t)}};var rn=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(rn||{}),Pn=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(Pn||{});const pr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Rd{static curveTo(t,e,n,r,o,h){const l=h[h.length-2],f=h[h.length-1]-e,d=l-t,g=r-e,m=n-t,_=Math.abs(f*m-d*g);if(_<1e-8||o===0)return(h[h.length-2]!==t||h[h.length-1]!==e)&&h.push(t,e),null;const x=f*f+d*d,T=g*g+m*m,y=f*g+d*m,E=o*Math.sqrt(x)/_,S=o*Math.sqrt(T)/_,A=E*y/x,I=S*y/T,D=E*m+S*d,N=E*g+S*f,L=d*(S+A),F=f*(S+A),V=m*(E+I),J=g*(E+I),$=Math.atan2(F-N,L-D),Q=Math.atan2(J-N,V-D);return{cx:D+t,cy:N+e,radius:o,startAngle:$,endAngle:Q,anticlockwise:d*g>m*f}}static arc(t,e,n,r,o,h,l,c,f){const d=l-h,g=pr._segmentsCount(Math.abs(d)*o,Math.ceil(Math.abs(d)/Lo)*40),m=d/(g*2),_=m*2,x=Math.cos(m),T=Math.sin(m),y=g-1,E=y%1/y;for(let S=0;S<=y;++S){const A=S+E*S,I=m+h+_*A,D=Math.cos(I),N=-Math.sin(I);f.push((x*D+T*N)*o+n,(x*-N+T*D)*o+r)}}}class sI{constructor(){this.reset()}begin(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class jl{static curveLength(t,e,n,r,o,h,l,c){let d=0,g=0,m=0,_=0,x=0,T=0,y=0,E=0,S=0,A=0,I=0,D=t,N=e;for(let L=1;L<=10;++L)g=L/10,m=g*g,_=m*g,x=1-g,T=x*x,y=T*x,E=y*t+3*T*g*n+3*x*m*o+_*l,S=y*e+3*T*g*r+3*x*m*h+_*c,A=D-E,I=N-S,D=E,N=S,d+=Math.sqrt(A*A+I*I);return d}static curveTo(t,e,n,r,o,h,l){const c=l[l.length-2],f=l[l.length-1];l.length-=2;const d=pr._segmentsCount(jl.curveLength(c,f,t,e,n,r,o,h));let g=0,m=0,_=0,x=0,T=0;l.push(c,f);for(let y=1,E=0;y<=d;++y)E=y/d,g=1-E,m=g*g,_=m*g,x=E*E,T=x*E,l.push(_*c+3*m*E*t+3*g*x*n+T*o,_*f+3*m*E*e+3*g*x*r+T*h)}}function Pd(i,t,e,n,r,o,h,l){const c=i-e*r,f=t-n*r,d=i+e*o,g=t+n*o;let m,_;h?(m=n,_=-e):(m=-n,_=e);const x=c+m,T=f+_,y=d+m,E=g+_;return l.push(x,T),l.push(y,E),2}function Tn(i,t,e,n,r,o,h,l){const c=e-i,f=n-t;let d=Math.atan2(c,f),g=Math.atan2(r-i,o-t);l&&d<g?d+=Math.PI*2:!l&&d>g&&(g+=Math.PI*2);let m=d;const _=g-d,x=Math.abs(_),T=Math.sqrt(c*c+f*f),y=(15*x*Math.sqrt(T)/Math.PI>>0)+1,E=_/y;if(m+=E,l){h.push(i,t),h.push(e,n);for(let S=1,A=m;S<y;S++,A+=E)h.push(i,t),h.push(i+Math.sin(A)*T,t+Math.cos(A)*T);h.push(i,t),h.push(r,o)}else{h.push(e,n),h.push(i,t);for(let S=1,A=m;S<y;S++,A+=E)h.push(i+Math.sin(A)*T,t+Math.cos(A)*T),h.push(i,t);h.push(r,o),h.push(i,t)}return y*2}function oI(i,t){const e=i.shape;let n=i.points||e.points.slice();const r=t.closePointEps;if(n.length===0)return;const o=i.lineStyle,h=new Et(n[0],n[1]),l=new Et(n[n.length-2],n[n.length-1]),c=e.type!==ce.POLY||e.closeStroke,f=Math.abs(h.x-l.x)<r&&Math.abs(h.y-l.y)<r;if(c){n=n.slice(),f&&(n.pop(),n.pop(),l.set(n[n.length-2],n[n.length-1]));const j=(h.x+l.x)*.5,vt=(l.y+h.y)*.5;n.unshift(j,vt),n.push(j,vt)}const d=t.points,g=n.length/2;let m=n.length;const _=d.length/2,x=o.width/2,T=x*x,y=o.miterLimit*o.miterLimit;let E=n[0],S=n[1],A=n[2],I=n[3],D=0,N=0,L=-(S-I),F=E-A,V=0,J=0,$=Math.sqrt(L*L+F*F);L/=$,F/=$,L*=x,F*=x;const Q=o.alignment,X=(1-Q)*2,G=Q*2;c||(o.cap===Pn.ROUND?m+=Tn(E-L*(X-G)*.5,S-F*(X-G)*.5,E-L*X,S-F*X,E+L*G,S+F*G,d,!0)+2:o.cap===Pn.SQUARE&&(m+=Pd(E,S,L,F,X,G,!0,d))),d.push(E-L*X,S-F*X),d.push(E+L*G,S+F*G);for(let j=1;j<g-1;++j){E=n[(j-1)*2],S=n[(j-1)*2+1],A=n[j*2],I=n[j*2+1],D=n[(j+1)*2],N=n[(j+1)*2+1],L=-(S-I),F=E-A,$=Math.sqrt(L*L+F*F),L/=$,F/=$,L*=x,F*=x,V=-(I-N),J=A-D,$=Math.sqrt(V*V+J*J),V/=$,J/=$,V*=x,J*=x;const vt=A-E,kt=S-I,H=A-D,it=N-I,yt=vt*H+kt*it,Ct=kt*H-it*vt,Rt=Ct<0;if(Math.abs(Ct)<.001*Math.abs(yt)){d.push(A-L*X,I-F*X),d.push(A+L*G,I+F*G),yt>=0&&(o.join===rn.ROUND?m+=Tn(A,I,A-L*X,I-F*X,A-V*X,I-J*X,d,!1)+4:m+=2,d.push(A-V*G,I-J*G),d.push(A+V*X,I+J*X));continue}const Ft=(-L+E)*(-F+I)-(-L+A)*(-F+S),Lt=(-V+D)*(-J+I)-(-V+A)*(-J+N),Jt=(vt*Lt-H*Ft)/Ct,$t=(it*Ft-kt*Lt)/Ct,Qt=(Jt-A)*(Jt-A)+($t-I)*($t-I),ie=A+(Jt-A)*X,Pt=I+($t-I)*X,Ot=A-(Jt-A)*G,Vt=I-($t-I)*G,Yt=Math.min(vt*vt+kt*kt,H*H+it*it),pe=Rt?X:G,fn=Yt+pe*pe*T;Qt<=fn?o.join===rn.BEVEL||Qt/T>y?(Rt?(d.push(ie,Pt),d.push(A+L*G,I+F*G),d.push(ie,Pt),d.push(A+V*G,I+J*G)):(d.push(A-L*X,I-F*X),d.push(Ot,Vt),d.push(A-V*X,I-J*X),d.push(Ot,Vt)),m+=2):o.join===rn.ROUND?Rt?(d.push(ie,Pt),d.push(A+L*G,I+F*G),m+=Tn(A,I,A+L*G,I+F*G,A+V*G,I+J*G,d,!0)+4,d.push(ie,Pt),d.push(A+V*G,I+J*G)):(d.push(A-L*X,I-F*X),d.push(Ot,Vt),m+=Tn(A,I,A-L*X,I-F*X,A-V*X,I-J*X,d,!1)+4,d.push(A-V*X,I-J*X),d.push(Ot,Vt)):(d.push(ie,Pt),d.push(Ot,Vt)):(d.push(A-L*X,I-F*X),d.push(A+L*G,I+F*G),o.join===rn.ROUND?Rt?m+=Tn(A,I,A+L*G,I+F*G,A+V*G,I+J*G,d,!0)+2:m+=Tn(A,I,A-L*X,I-F*X,A-V*X,I-J*X,d,!1)+2:o.join===rn.MITER&&Qt/T<=y&&(Rt?(d.push(Ot,Vt),d.push(Ot,Vt)):(d.push(ie,Pt),d.push(ie,Pt)),m+=2),d.push(A-V*X,I-J*X),d.push(A+V*G,I+J*G),m+=2)}E=n[(g-2)*2],S=n[(g-2)*2+1],A=n[(g-1)*2],I=n[(g-1)*2+1],L=-(S-I),F=E-A,$=Math.sqrt(L*L+F*F),L/=$,F/=$,L*=x,F*=x,d.push(A-L*X,I-F*X),d.push(A+L*G,I+F*G),c||(o.cap===Pn.ROUND?m+=Tn(A-L*(X-G)*.5,I-F*(X-G)*.5,A-L*X,I-F*X,A+L*G,I+F*G,d,!1)+2:o.cap===Pn.SQUARE&&(m+=Pd(A,I,L,F,X,G,!1,d)));const dt=t.indices,_t=pr.epsilon*pr.epsilon;for(let j=_;j<m+_-2;++j)E=d[j*2],S=d[j*2+1],A=d[(j+1)*2],I=d[(j+1)*2+1],D=d[(j+2)*2],N=d[(j+2)*2+1],!(Math.abs(E*(I-N)+A*(N-S)+D*(S-I))<_t)&&dt.push(j,j+1,j+2)}function aI(i,t){let e=0;const n=i.shape,r=i.points||n.points,o=n.type!==ce.POLY||n.closeStroke;if(r.length===0)return;const h=t.points,l=t.indices,c=r.length/2,f=h.length/2;let d=f;for(h.push(r[0],r[1]),e=1;e<c;e++)h.push(r[e*2],r[e*2+1]),l.push(d,d+1),d++;o&&l.push(d,f)}function Md(i,t){i.lineStyle.native?aI(i,t):oI(i,t)}class ql{static curveLength(t,e,n,r,o,h){const l=t-2*n+o,c=e-2*r+h,f=2*n-2*t,d=2*r-2*e,g=4*(l*l+c*c),m=4*(l*f+c*d),_=f*f+d*d,x=2*Math.sqrt(g+m+_),T=Math.sqrt(g),y=2*g*T,E=2*Math.sqrt(_),S=m/T;return(y*x+T*m*(x-E)+(4*_*g-m*m)*Math.log((2*T+S+x)/(S+E)))/(4*y)}static curveTo(t,e,n,r,o){const h=o[o.length-2],l=o[o.length-1],c=pr._segmentsCount(ql.curveLength(h,l,t,e,n,r));let f=0,d=0;for(let g=1;g<=c;++g){const m=g/c;f=h+(t-h)*m,d=l+(e-l)*m,o.push(f+(t+(n-t)*m-f)*m,d+(e+(r-e)*m-d)*m)}}}const Vh={[ce.POLY]:ng,[ce.CIRC]:Go,[ce.ELIP]:Go,[ce.RECT]:nI,[ce.RREC]:rI},Dd=[],_o=[];class Wo{constructor(t,e=null,n=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type}clone(){return new Wo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const er=new Et,rg=class extends hp{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Oo,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),_o.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t.reset(),Dd.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,t=null,e=null,n=null){const r=new Wo(i,t,e,n);return this.graphicsData.push(r),this.dirty++,this}drawHole(i,t=null){if(!this.graphicsData.length)return null;const e=new Wo(i,null,null,t),n=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=n.lineStyle,n.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const t=this.graphicsData;for(let e=0;e<t.length;++e){const n=t[e];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(i,er):er.copyFrom(i),n.shape.contains(er.x,er.y))){let r=!1;if(n.holes){for(let o=0;o<n.holes.length;o++)if(n.holes[o].shape.contains(er.x,er.y)){r=!0;break}}if(!r)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,t=this.graphicsData;let e=null,n=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],n=e.style);for(let l=this.shapeIndex;l<t.length;l++){this.shapeIndex++;const c=t[l],f=c.fillStyle,d=c.lineStyle;Vh[c.type].build(c),c.matrix&&this.transformPoints(c.points,c.matrix),(f.visible||d.visible)&&this.processHoles(c.holes);for(let m=0;m<2;m++){const _=m===0?f:d;if(!_.visible)continue;const x=_.texture.baseTexture,T=this.indices.length,y=this.points.length/2;x.wrapMode=an.REPEAT,m===0?this.processFill(c):this.processLine(c);const E=this.points.length/2-y;E!==0&&(e&&!this._compareStyles(n,_)&&(e.end(T,y),e=null),e||(e=Dd.pop()||new sI,e.begin(_,T,y),this.batches.push(e),n=_),this.addUvs(this.points,i,_.texture,y,E,_.matrix))}}const r=this.indices.length,o=this.points.length/2;if(e&&e.end(r,o),this.batches.length===0){this.batchable=!0;return}const h=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&h===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=h?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,t){return!(!i||!t||i.texture.baseTexture!==t.texture.baseTexture||i.color+i.alpha!==t.color+t.alpha||!!i.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,t=this.graphicsData.length;i<t;i++){const e=this.graphicsData[i],n=e.fillStyle,r=e.lineStyle;if(n&&!n.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let t=0,e=i.length;t<e;t++){const n=i[t];for(let r=0;r<n.size;r++){const o=n.start+r;this.indicesUint16[o]=this.indicesUint16[o]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const i=this.batches;for(let t=0;t<i.length;t++)if(i[t].style.native)return!1;return this.points.length<rg.BATCHABLE_SIZE*2}buildDrawCalls(){let i=++ft._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),_o.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let n=_o.pop();n||(n=new vl,n.texArray=new yl),n.texArray.count=0,n.start=0,n.size=0,n.type=wi.TRIANGLES;let r=0,o=null,h=0,l=!1,c=wi.TRIANGLES,f=0;this.drawCalls.push(n);for(let d=0;d<this.batches.length;d++){const g=this.batches[d],m=8,_=g.style,x=_.texture.baseTexture;l!==!!_.native&&(l=!!_.native,c=l?wi.LINES:wi.TRIANGLES,o=null,r=m,i++),o!==x&&(o=x,x._batchEnabled!==i&&(r===m&&(i++,r=0,n.size>0&&(n=_o.pop(),n||(n=new vl,n.texArray=new yl),this.drawCalls.push(n)),n.start=f,n.size=0,n.texArray.count=0,n.type=c),x.touched=1,x._batchEnabled=i,x._batchLocation=r,x.wrapMode=an.REPEAT,n.texArray.elements[n.texArray.count++]=x,r++)),n.size+=g.size,f+=g.size,h=x._batchLocation,this.addColors(t,_.color,_.alpha,g.attribSize,g.attribStart),this.addTextureIds(e,h,g.attribSize,g.attribStart)}ft._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,t=this.uvs,e=this.colors,n=this.textureIds,r=new ArrayBuffer(i.length*3*4),o=new Float32Array(r),h=new Uint32Array(r);let l=0;for(let c=0;c<i.length/2;c++)o[l++]=i[c*2],o[l++]=i[c*2+1],o[l++]=t[c*2],o[l++]=t[c*2+1],h[l++]=e[c],o[l++]=n[c];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?ng.triangulate(i,this):Vh[i.type].triangulate(i,this)}processLine(i){Md(i,this);for(let t=0;t<i.holes.length;t++)Md(i.holes[t],this)}processHoles(i){for(let t=0;t<i.length;t++){const e=i[t];Vh[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,t){for(let e=0;e<i.length/2;e++){const n=i[e*2],r=i[e*2+1];i[e*2]=t.a*n+t.c*r+t.tx,i[e*2+1]=t.b*n+t.d*r+t.ty}}addColors(i,t,e,n,r=0){const o=(t>>16)+(t&65280)+((t&255)<<16),h=Wl(o,e);i.length=Math.max(i.length,r+n);for(let l=0;l<n;l++)i[r+l]=h}addTextureIds(i,t,e,n=0){i.length=Math.max(i.length,n+e);for(let r=0;r<e;r++)i[n+r]=t}addUvs(i,t,e,n,r,o=null){let h=0;const l=t.length,c=e.frame;for(;h<r;){let d=i[(n+h)*2],g=i[(n+h)*2+1];if(o){const m=o.a*d+o.c*g+o.tx;g=o.b*d+o.d*g+o.ty,d=m}h++,t.push(d/c.width,g/c.height)}const f=e.baseTexture;(c.width<f.width||c.height<f.height)&&this.adjustUvs(t,e,l,r)}adjustUvs(i,t,e,n){const r=t.baseTexture,o=1e-6,h=e+n*2,l=t.frame,c=l.width/r.width,f=l.height/r.height;let d=l.x/l.width,g=l.y/l.height,m=Math.floor(i[e]+o),_=Math.floor(i[e+1]+o);for(let x=e+2;x<h;x+=2)m=Math.min(m,Math.floor(i[x]+o)),_=Math.min(_,Math.floor(i[x+1]+o));d-=m,g-=_;for(let x=e;x<h;x+=2)i[x]=(i[x]+d)*c,i[x+1]=(i[x+1]+g)*f}};let sg=rg;sg.BATCHABLE_SIZE=100;class ta{constructor(){this.color=16777215,this.alpha=1,this.texture=nt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new ta;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=nt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Kl extends ta{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Pn.BUTT,this.join=rn.MITER,this.miterLimit=10}clone(){const t=new Kl;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const hI=new Float32Array(3),Yh={},Po=class extends ke{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new ta,this._lineStyle=new Kl,this._matrix=null,this._holeMode=!1,this.state=Vi.for2d(),this._geometry=i||new sg,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=lt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Po(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(i){this._tint=i}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,t=0,e=1,n=.5,r=!1){return typeof i=="number"&&(i={width:i,color:t,alpha:e,alignment:n,native:r}),this.lineTextureStyle(i)}lineTextureStyle(i){i=Object.assign({width:0,texture:nt.WHITE,color:i!=null&&i.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Pn.BUTT,join:rn.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();const t=i.width>0&&i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:t},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new cr,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[t-2],i[t-1]))}else this.currentPath=new cr,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,t){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=t,this}lineTo(i,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points,n=e[e.length-2],r=e[e.length-1];return(n!==i||r!==t)&&e.push(i,t),this}_initCurve(i=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,t]):this.moveTo(i,t)}quadraticCurveTo(i,t,e,n){this._initCurve();const r=this.currentPath.points;return r.length===0&&this.moveTo(0,0),ql.curveTo(i,t,e,n,r),this}bezierCurveTo(i,t,e,n,r,o){return this._initCurve(),jl.curveTo(i,t,e,n,r,o,this.currentPath.points),this}arcTo(i,t,e,n,r){this._initCurve(i,t);const o=this.currentPath.points,h=Rd.curveTo(i,t,e,n,r,o);if(h){const{cx:l,cy:c,radius:f,startAngle:d,endAngle:g,anticlockwise:m}=h;this.arc(l,c,f,d,g,m)}return this}arc(i,t,e,n,r,o=!1){if(n===r)return this;if(!o&&r<=n?r+=Lo:o&&n<=r&&(n+=Lo),r-n===0)return this;const l=i+Math.cos(n)*e,c=t+Math.sin(n)*e,f=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const g=Math.abs(d[d.length-2]-l),m=Math.abs(d[d.length-1]-c);g<f&&m<f||d.push(l,c)}else this.moveTo(l,c),d=this.currentPath.points;return Rd.arc(l,c,i,t,e,n,r,o,d),this}beginFill(i=0,t=1){return this.beginTextureFill({texture:nt.WHITE,color:i,alpha:t})}beginTextureFill(i){i=Object.assign({texture:nt.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();const t=i.alpha>0;return t?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:t},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,t,e,n){return this.drawShape(new wt(i,t,e,n))}drawRoundedRect(i,t,e,n,r){return this.drawShape(new zl(i,t,e,n,r))}drawCircle(i,t,e){return this.drawShape(new Hl(i,t,e))}drawEllipse(i,t,e,n){return this.drawShape(new Xl(i,t,e,n))}drawPolygon(...i){let t,e=!0;const n=i[0];n.points?(e=n.closeStroke,t=n.points):Array.isArray(i[0])?t=i[0]:t=i;const r=new cr(t);return r.closeStroke=e,this.drawShape(r),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===ce.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,t=this.blendMode,e=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(i.points);for(let n=0;n<e;n++){const r=i.batches[n],o=r.style.color,h=new Float32Array(this.vertexData.buffer,r.attribStart*4*2,r.attribSize*2),l=new Float32Array(i.uvsFloat32.buffer,r.attribStart*4*2,r.attribSize*2),c=new Uint16Array(i.indicesUint16.buffer,r.start*2,r.size),f={vertexData:h,blendMode:t,indices:c,uvs:l,_batchRGB:es(o),_tintRGB:o,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[n]=f}}_renderBatched(i){if(this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,i.plugins[this.pluginName].render(n)}}}_renderDirect(i){const t=this._resolveDirectShader(i),e=this._geometry,n=this.tint,r=this.worldAlpha,o=t.uniforms,h=e.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(n>>16&255)/255*r,o.tint[1]=(n>>8&255)/255*r,o.tint[2]=(n&255)/255*r,o.tint[3]=r,i.shader.bind(t),i.geometry.bind(e,t),i.state.set(this.state);for(let l=0,c=h.length;l<c;l++)this._renderDrawCallDirect(i,e.drawCalls[l])}_renderDrawCallDirect(i,t){const{texArray:e,type:n,size:r,start:o}=t,h=e.count;for(let l=0;l<h;l++)i.texture.bind(e.elements[l],l);i.geometry.draw(n,r,o)}_resolveDirectShader(i){let t=this.shader;const e=this.pluginName;if(!t){if(!Yh[e]){const{maxTextures:n}=i.plugins[e],r=new Int32Array(n);for(let l=0;l<n;l++)r[l]=l;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Gt,default:di.from({uSamplers:r},!0)},h=i.plugins[e]._shader.program;Yh[e]=new Ei(h,o)}t=Yh[e]}return t}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:t,minY:e,maxX:n,maxY:r}=i.bounds;this._bounds.addFrame(this.transform,t,e,n,r)}containsPoint(i){return this.worldTransform.applyInverse(i,Po._TEMP_POINT),this._geometry.containsPoint(Po._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const i=es(this.tint,hI);for(let t=0;t<this.batches.length;t++){const e=this.batches[t],n=e._batchRGB,r=i[0]*n[0]*255,o=i[1]*n[1]*255,h=i[2]*n[2]*255,l=(r<<16)+(o<<8)+(h|0);e._tintRGB=(l>>16)+(l&65280)+((l&255)<<16)}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const t=this.transform.worldTransform,e=t.a,n=t.b,r=t.c,o=t.d,h=t.tx,l=t.ty,c=this._geometry.points,f=this.vertexData;let d=0;for(let g=0;g<c.length;g+=2){const m=c[g],_=c[g+1];f[d++]=e*m+r*_+h,f[d++]=o*_+n*m+l}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let ea=Po;ea.curves=pr;ea._TEMP_POINT=new Et;class lI{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const jh=new Et,Bd=new cr,og=class extends ke{constructor(i,t,e,n=wi.TRIANGLES){super(),this.geometry=i,this.shader=t,this.state=e||Vi.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=K.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===wi.TRIANGLES&&t.length<og.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),i.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(t),i.state.set(this.state),i.geometry.bind(this.geometry,t),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const n=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[n]),i.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const r=this.transform.worldTransform,o=r.a,h=r.b,l=r.c,c=r.d,f=r.tx,d=r.ty,g=this.vertexData;for(let m=0;m<g.length/2;m++){const _=e[m*2],x=e[m*2+1];g[m*2]=o*_+l*x+f,g[m*2+1]=h*_+c*x+d}if(this._roundPixels){const m=K.RESOLUTION;for(let _=0;_<g.length;++_)g[_]=Math.round(g[_]*m)/m}this.vertexDirty=n}calculateUvs(){const i=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new lI(i,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,jh);const t=this.geometry.getBuffer("aVertexPosition").data,e=Bd.points,n=this.geometry.getIndex().data,r=n.length,o=this.drawMode===4?3:1;for(let h=0;h+2<r;h+=o){const l=n[h]*2,c=n[h+1]*2,f=n[h+2]*2;if(e[0]=t[l],e[1]=t[l+1],e[2]=t[c],e[3]=t[c+1],e[4]=t[f],e[5]=t[f+1],Bd.contains(jh.x,jh.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Dl=og;Dl.BATCHABLE_SIZE=100;class uI extends ln{constructor(t,e,n){super();const r=new Zt(t),o=new Zt(e,!0),h=new Zt(n,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,st.FLOAT).addAttribute("aTextureCoord",o,2,!1,st.FLOAT).addIndex(h),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var cI=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,fI=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Fd extends Ei{constructor(t,e){const n={uSampler:t,alpha:1,uTextureMatrix:Gt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(n,e.uniforms),super(e.program||li.from(fI,cI),n),this._colorDirty=!1,this.uvMatrix=new Sp(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;rp(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Ld{constructor(t,e,n){this.geometry=new ln,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let o=t[r];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||st.FLOAT,offset:o.offset},e[r]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new Zt(nA(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let h=0;h<this.dynamicProperties.length;++h){const l=this.dynamicProperties[h];l.offset=e,e+=l.size,this.dynamicStride+=l.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new Zt(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let h=0;h<this.staticProperties.length;++h){const l=this.staticProperties[h];l.offset=r,r+=l.size,this.staticStride+=l.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new Zt(this.staticData,!0,!1);for(let h=0;h<this.dynamicProperties.length;++h){const l=this.dynamicProperties[h];t.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===st.UNSIGNED_BYTE,l.type,this.dynamicStride*4,l.offset*4)}for(let h=0;h<this.staticProperties.length;++h){const l=this.staticProperties[h];t.addAttribute(l.attributeName,this.staticBuffer,0,l.type===st.UNSIGNED_BYTE,l.type,this.staticStride*4,l.offset*4)}}uploadDynamic(t,e,n){for(let r=0;r<this.dynamicProperties.length;r++){const o=this.dynamicProperties[r];o.uploadFunction(t,e,n,o.type===st.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,n){for(let r=0;r<this.staticProperties.length;r++){const o=this.staticProperties[r];o.uploadFunction(t,e,n,o.type===st.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var dI=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,pI=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ag extends Zo{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Gt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:st.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ei.from(pI,dI,{}),this.state=Vi.for2d()}render(t){const e=t.children,n=t._maxSize,r=t._batchSize,o=this.renderer;let h=e.length;if(h===0)return;h>n&&!t.autoResize&&(h=n);let l=t._buffers;l||(l=t._buffers=this.generateBuffers(t));const c=e[0]._texture.baseTexture,f=c.alphaMode>0;this.state.blendMode=np(t.blendMode,f),o.state.set(this.state);const d=o.gl,g=t.worldTransform.copyTo(this.tempMatrix);g.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=g.toArray(!0),this.shader.uniforms.uColor=iA(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,f),this.shader.uniforms.uSampler=c,this.renderer.shader.bind(this.shader);let m=!1;for(let _=0,x=0;_<h;_+=r,x+=1){let T=h-_;T>r&&(T=r),x>=l.length&&l.push(this._generateOneMoreBuffer(t));const y=l[x];y.uploadDynamic(e,_,T);const E=t._bufferUpdateIDs[x]||0;m=m||y._updateID<E,m&&(y._updateID=t._updateID,y.uploadStatic(e,_,T)),o.geometry.bind(y.geometry),d.drawElements(d.TRIANGLES,T*6,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],n=t._maxSize,r=t._batchSize,o=t._properties;for(let h=0;h<n;h+=r)e.push(new Ld(this.properties,o,r));return e}_generateOneMoreBuffer(t){const e=t._batchSize,n=t._properties;return new Ld(this.properties,n,e)}uploadVertices(t,e,n,r,o,h){let l=0,c=0,f=0,d=0;for(let g=0;g<n;++g){const m=t[e+g],_=m._texture,x=m.scale.x,T=m.scale.y,y=_.trim,E=_.orig;y?(c=y.x-m.anchor.x*E.width,l=c+y.width,d=y.y-m.anchor.y*E.height,f=d+y.height):(l=E.width*(1-m.anchor.x),c=E.width*-m.anchor.x,f=E.height*(1-m.anchor.y),d=E.height*-m.anchor.y),r[h]=c*x,r[h+1]=d*T,r[h+o]=l*x,r[h+o+1]=d*T,r[h+o*2]=l*x,r[h+o*2+1]=f*T,r[h+o*3]=c*x,r[h+o*3+1]=f*T,h+=o*4}}uploadPosition(t,e,n,r,o,h){for(let l=0;l<n;l++){const c=t[e+l].position;r[h]=c.x,r[h+1]=c.y,r[h+o]=c.x,r[h+o+1]=c.y,r[h+o*2]=c.x,r[h+o*2+1]=c.y,r[h+o*3]=c.x,r[h+o*3+1]=c.y,h+=o*4}}uploadRotation(t,e,n,r,o,h){for(let l=0;l<n;l++){const c=t[e+l].rotation;r[h]=c,r[h+o]=c,r[h+o*2]=c,r[h+o*3]=c,h+=o*4}}uploadUvs(t,e,n,r,o,h){for(let l=0;l<n;++l){const c=t[e+l]._texture._uvs;c?(r[h]=c.x0,r[h+1]=c.y0,r[h+o]=c.x1,r[h+o+1]=c.y1,r[h+o*2]=c.x2,r[h+o*2+1]=c.y2,r[h+o*3]=c.x3,r[h+o*3+1]=c.y3,h+=o*4):(r[h]=0,r[h+1]=0,r[h+o]=0,r[h+o+1]=0,r[h+o*2]=0,r[h+o*2+1]=0,r[h+o*3]=0,r[h+o*3+1]=0,h+=o*4)}}uploadTint(t,e,n,r,o,h){for(let l=0;l<n;++l){const c=t[e+l],f=c._texture.baseTexture.alphaMode>0,d=c.alpha,g=d<1&&f?Wl(c._tintRGB,d):c._tintRGB+(d*255<<24);r[h]=g,r[h+o]=g,r[h+o*2]=g,r[h+o*3]=g,h+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ag.extension={name:"particle",type:q.RendererPlugin};rt.add(ag);var ia=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(ia||{});const vo={willReadFrequently:!0},et=class{static get experimentalLetterSpacingSupported(){let i=et._experimentalLetterSpacingSupported;if(i!==void 0){const t=K.ADAPTER.getCanvasRenderingContext2D().prototype;i=et._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return i}constructor(i,t,e,n,r,o,h,l,c){this.text=i,this.style=t,this.width=e,this.height=n,this.lines=r,this.lineWidths=o,this.lineHeight=h,this.maxLineWidth=l,this.fontProperties=c}static measureText(i,t,e,n=et._canvas){e=e??t.wordWrap;const r=t.toFontString(),o=et.measureFont(r);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const h=n.getContext("2d",vo);h.font=r;const c=(e?et.wordWrap(i,t,n):i).split(/(?:\r\n|\r|\n)/),f=new Array(c.length);let d=0;for(let x=0;x<c.length;x++){const T=et._measureText(c[x],t.letterSpacing,h);f[x]=T,d=Math.max(d,T)}let g=d+t.strokeThickness;t.dropShadow&&(g+=t.dropShadowDistance);const m=t.lineHeight||o.fontSize+t.strokeThickness;let _=Math.max(m,o.fontSize+t.strokeThickness*2)+(c.length-1)*(m+t.leading);return t.dropShadow&&(_+=t.dropShadowDistance),new et(i,t,g,_,c,f,m+t.leading,d,o)}static _measureText(i,t,e){let n=!1;et.experimentalLetterSpacingSupported&&(et.experimentalLetterSpacing?(e.letterSpacing=`${t}px`,e.textLetterSpacing=`${t}px`,n=!0):(e.letterSpacing="0px",e.textLetterSpacing="0px"));let r=e.measureText(i).width;return r>0&&(n?r-=t:r+=(et.graphemeSegmenter(i).length-1)*t),r}static wordWrap(i,t,e=et._canvas){const n=e.getContext("2d",vo);let r=0,o="",h="";const l=Object.create(null),{letterSpacing:c,whiteSpace:f}=t,d=et.collapseSpaces(f),g=et.collapseNewlines(f);let m=!d;const _=t.wordWrapWidth+c,x=et.tokenize(i);for(let T=0;T<x.length;T++){let y=x[T];if(et.isNewline(y)){if(!g){h+=et.addLine(o),m=!d,o="",r=0;continue}y=" "}if(d){const S=et.isBreakingSpace(y),A=et.isBreakingSpace(o[o.length-1]);if(S&&A)continue}const E=et.getFromCache(y,c,l,n);if(E>_)if(o!==""&&(h+=et.addLine(o),o="",r=0),et.canBreakWords(y,t.breakWords)){const S=et.wordWrapSplit(y);for(let A=0;A<S.length;A++){let I=S[A],D=I,N=1;for(;S[A+N];){const F=S[A+N];if(!et.canBreakChars(D,F,y,A,t.breakWords))I+=F;else break;D=F,N++}A+=N-1;const L=et.getFromCache(I,c,l,n);L+r>_&&(h+=et.addLine(o),m=!1,o="",r=0),o+=I,r+=L}}else{o.length>0&&(h+=et.addLine(o),o="",r=0);const S=T===x.length-1;h+=et.addLine(y,!S),m=!1,o="",r=0}else E+r>_&&(m=!1,h+=et.addLine(o),o="",r=0),(o.length>0||!et.isBreakingSpace(y)||m)&&(o+=y,r+=E)}return h+=et.addLine(o,!1),h}static addLine(i,t=!0){return i=et.trimRight(i),i=t?`${i}
`:i,i}static getFromCache(i,t,e,n){let r=e[i];return typeof r!="number"&&(r=et._measureText(i,t,n)+t,e[i]=r),r}static collapseSpaces(i){return i==="normal"||i==="pre-line"}static collapseNewlines(i){return i==="normal"}static trimRight(i){if(typeof i!="string")return"";for(let t=i.length-1;t>=0;t--){const e=i[t];if(!et.isBreakingSpace(e))break;i=i.slice(0,-1)}return i}static isNewline(i){return typeof i!="string"?!1:et._newlines.includes(i.charCodeAt(0))}static isBreakingSpace(i,t){return typeof i!="string"?!1:et._breakingSpaces.includes(i.charCodeAt(0))}static tokenize(i){const t=[];let e="";if(typeof i!="string")return t;for(let n=0;n<i.length;n++){const r=i[n],o=i[n+1];if(et.isBreakingSpace(r,o)||et.isNewline(r)){e!==""&&(t.push(e),e=""),t.push(r);continue}e+=r}return e!==""&&t.push(e),t}static canBreakWords(i,t){return t}static canBreakChars(i,t,e,n,r){return!0}static wordWrapSplit(i){return et.graphemeSegmenter(i)}static measureFont(i){if(et._fonts[i])return et._fonts[i];const t={ascent:0,descent:0,fontSize:0},e=et._canvas,n=et._context;n.font=i;const r=et.METRICS_STRING+et.BASELINE_SYMBOL,o=Math.ceil(n.measureText(r).width);let h=Math.ceil(n.measureText(et.BASELINE_SYMBOL).width);const l=Math.ceil(et.HEIGHT_MULTIPLIER*h);if(h=h*et.BASELINE_MULTIPLIER|0,o===0||l===0)return et._fonts[i]=t,t;e.width=o,e.height=l,n.fillStyle="#f00",n.fillRect(0,0,o,l),n.font=i,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(r,0,h);const c=n.getImageData(0,0,o,l).data,f=c.length,d=o*4;let g=0,m=0,_=!1;for(g=0;g<h;++g){for(let x=0;x<d;x+=4)if(c[m+x]!==255){_=!0;break}if(!_)m+=d;else break}for(t.ascent=h-g,m=f-d,_=!1,g=l;g>h;--g){for(let x=0;x<d;x+=4)if(c[m+x]!==255){_=!0;break}if(!_)m-=d;else break}return t.descent=g-h,t.fontSize=t.ascent+t.descent,et._fonts[i]=t,t}static clearMetrics(i=""){i?delete et._fonts[i]:et._fonts={}}static get _canvas(){if(!et.__canvas){let i;try{const t=new OffscreenCanvas(0,0),e=t.getContext("2d",vo);if(e!=null&&e.measureText)return et.__canvas=t,t;i=K.ADAPTER.createCanvas()}catch{i=K.ADAPTER.createCanvas()}i.width=i.height=10,et.__canvas=i}return et.__canvas}static get _context(){return et.__context||(et.__context=et._canvas.getContext("2d",vo)),et.__context}};let ue=et;ue.METRICS_STRING="|ÉqÅ";ue.BASELINE_SYMBOL="M";ue.BASELINE_MULTIPLIER=1.4;ue.HEIGHT_MULTIPLIER=2;ue.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})();ue.experimentalLetterSpacing=!1;ue._fonts={};ue._newlines=[10,13];ue._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const gI=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],qr=class{constructor(i){this.styleID=0,this.reset(),Kh(this,i,i)}clone(){const i={};return Kh(i,this,qr.defaultStyle),new qr(i)}reset(){Kh(this,qr.defaultStyle,qr.defaultStyle)}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(i){this._breakWords!==i&&(this._breakWords=i,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(i){this._dropShadow!==i&&(this._dropShadow=i,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(i){this._dropShadowAlpha!==i&&(this._dropShadowAlpha=i,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(i){this._dropShadowAngle!==i&&(this._dropShadowAngle=i,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(i){this._dropShadowBlur!==i&&(this._dropShadowBlur=i,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(i){const t=qh(i);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(i){this._dropShadowDistance!==i&&(this._dropShadowDistance=i,this.styleID++)}get fill(){return this._fill}set fill(i){const t=qh(i);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(i){this._fillGradientType!==i&&(this._fillGradientType=i,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(i){mI(this._fillGradientStops,i)||(this._fillGradientStops=i,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(i){this.fontFamily!==i&&(this._fontFamily=i,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(i){this._fontStyle!==i&&(this._fontStyle=i,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(i){this._fontVariant!==i&&(this._fontVariant=i,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(i){this._fontWeight!==i&&(this._fontWeight=i,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(i){this._lineHeight!==i&&(this._lineHeight=i,this.styleID++)}get leading(){return this._leading}set leading(i){this._leading!==i&&(this._leading=i,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(i){this._lineJoin!==i&&(this._lineJoin=i,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(i){this._miterLimit!==i&&(this._miterLimit=i,this.styleID++)}get padding(){return this._padding}set padding(i){this._padding!==i&&(this._padding=i,this.styleID++)}get stroke(){return this._stroke}set stroke(i){const t=qh(i);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(i){this._strokeThickness!==i&&(this._strokeThickness=i,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(i){this._textBaseline!==i&&(this._textBaseline=i,this.styleID++)}get trim(){return this._trim}set trim(i){this._trim!==i&&(this._trim=i,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(i){this._whiteSpace!==i&&(this._whiteSpace=i,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(i){this._wordWrap!==i&&(this._wordWrap=i,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(i){this._wordWrapWidth!==i&&(this._wordWrapWidth=i,this.styleID++)}toFontString(){const i=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let n=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!gI.includes(n)&&(n=`"${n}"`),t[e]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${i} ${t.join(",")}`}};let Ln=qr;Ln.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ia.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Od(i){return typeof i=="number"?ep(i):(typeof i=="string"&&i.startsWith("0x")&&(i=i.replace("0x","#")),i)}function qh(i){if(Array.isArray(i)){for(let t=0;t<i.length;++t)i[t]=Od(i[t]);return i}else return Od(i)}function mI(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function Kh(i,t,e){for(const n in e)Array.isArray(t[n])?i[n]=t[n].slice():i[n]=t[n]}const _I={texture:!0,children:!1,baseTexture:!0},Bl=class extends yr{constructor(i,t,e){let n=!1;e||(e=K.ADAPTER.createCanvas(),n=!0),e.width=3,e.height=3;const r=nt.from(e);r.orig=new wt,r.trim=new wt,super(r),this._ownCanvas=n,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=Bl.defaultResolution??K.RESOLUTION,this._autoResolution=Bl.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ue.experimentalLetterSpacing}static set experimentalLetterSpacing(i){At("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ue.experimentalLetterSpacing=i}updateText(i){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const e=this.context,n=ue.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=n.width,o=n.height,h=n.lines,l=n.lineHeight,c=n.lineWidths,f=n.maxLineWidth,d=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;let g,m;const _=t.dropShadow?2:1;for(let x=0;x<_;++x){const T=t.dropShadow&&x===0,y=T?Math.ceil(Math.max(1,o)+t.padding*2):0,E=y*this._resolution;if(T){e.fillStyle="black",e.strokeStyle="black";const A=t.dropShadowColor,I=es(typeof A=="number"?A:Gl(A)),D=t.dropShadowBlur*this._resolution,N=t.dropShadowDistance*this._resolution;e.shadowColor=`rgba(${I[0]*255},${I[1]*255},${I[2]*255},${t.dropShadowAlpha})`,e.shadowBlur=D,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*N,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*N+E}else e.fillStyle=this._generateFillStyle(t,h,n),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let S=(l-d.fontSize)/2;l-d.fontSize<0&&(S=0);for(let A=0;A<h.length;A++)g=t.strokeThickness/2,m=t.strokeThickness/2+A*l+d.ascent+S,t.align==="right"?g+=f-c[A]:t.align==="center"&&(g+=(f-c[A])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(h[A],g+t.padding,m+t.padding-y,!0),t.fill&&this.drawLetterSpacing(h[A],g+t.padding,m+t.padding-y)}this.updateTexture()}drawLetterSpacing(i,t,e,n=!1){const o=this._style.letterSpacing;let h=!1;if(ue.experimentalLetterSpacingSupported&&(ue.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,h=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||h){n?this.context.strokeText(i,t,e):this.context.fillText(i,t,e);return}let l=t;const c=ue.graphemeSegmenter(i);let f=this.context.measureText(i).width,d=0;for(let g=0;g<c.length;++g){const m=c[g];n?this.context.strokeText(m,l,e):this.context.fillText(m,l,e);let _="";for(let x=g+1;x<c.length;++x)_+=c[x];d=this.context.measureText(_).width,l+=f-d+o,f=d}}updateTexture(){const i=this.canvas;if(this._style.trim){const o=oA(i);o.data&&(i.width=o.width,i.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,e=this._style,n=e.trim?0:e.padding,r=t.baseTexture;t.trim.width=t._frame.width=i.width/this._resolution,t.trim.height=t._frame.height=i.height/this._resolution,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),r.setRealSize(i.width,i.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,t){return this.updateText(!0),this._textureID===-1&&(i=!1),super.getBounds(i,t)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,t,e){const n=i.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let r;const o=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,l=this.canvas.width/this._resolution-o-h*2,c=this.canvas.height/this._resolution-o-h*2,f=n.slice(),d=i.fillGradientStops.slice();if(!d.length){const g=f.length+1;for(let m=1;m<g;++m)d.push(m/g)}if(f.unshift(n[0]),d.unshift(0),f.push(n[n.length-1]),d.push(1),i.fillGradientType===ia.LINEAR_VERTICAL){r=this.context.createLinearGradient(l/2,h,l/2,c+h);const g=e.fontProperties.fontSize+i.strokeThickness;for(let m=0;m<t.length;m++){const _=e.lineHeight*(m-1)+g,x=e.lineHeight*m;let T=x;m>0&&_>x&&(T=(x+_)/2);const y=x+g,E=e.lineHeight*(m+1);let S=y;m+1<t.length&&E<y&&(S=(y+E)/2);const A=(S-T)/c;for(let I=0;I<f.length;I++){let D=0;typeof d[I]=="number"?D=d[I]:D=I/f.length;let N=Math.min(1,Math.max(0,T/c+D*A));N=Number(N.toFixed(5)),r.addColorStop(N,f[I])}}}else{r=this.context.createLinearGradient(h,c/2,l+h,c/2);const g=f.length+1;let m=1;for(let _=0;_<f.length;_++){let x;typeof d[_]=="number"?x=d[_]:x=m/g,r.addColorStop(x,f[_]),m++}}return r}destroy(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},_I,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const t=or(this.scale.x)||1;this.scale.x=t*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const t=or(this.scale.y)||1;this.scale.y=t*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){i=i||{},i instanceof Ln?this._style=i:this._style=new Ln(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Zl=Bl;Zl.defaultAutoResolution=!0;class vI{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function xI(i,t){var n;let e=!1;if((n=i==null?void 0:i._textures)!=null&&n.length){for(let r=0;r<i._textures.length;r++)if(i._textures[r]instanceof nt){const o=i._textures[r].baseTexture;t.includes(o)||(t.push(o),e=!0)}}return e}function yI(i,t){if(i.baseTexture instanceof ft){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function bI(i,t){if(i._texture&&i._texture instanceof nt){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function wI(i,t){return t instanceof Zl?(t.updateText(!0),!0):!1}function TI(i,t){if(t instanceof Ln){const e=t.toFontString();return ue.measureFont(e),!0}return!1}function EI(i,t){if(i instanceof Zl){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function AI(i,t){return i instanceof Ln?(t.includes(i)||t.push(i),!0):!1}const hg=class{constructor(i){this.limiter=new vI(hg.uploadsPerFrame),this.renderer=i,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(EI),this.registerFindHook(AI),this.registerFindHook(xI),this.registerFindHook(yI),this.registerFindHook(bI),this.registerUploadHook(wI),this.registerUploadHook(TI)}upload(i){return new Promise(t=>{i&&this.add(i),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Ce.system.addOnce(this.tick,this,dr.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const i=this.queue[0];let t=!1;if(i&&!i._destroyed){for(let e=0,n=this.uploadHooks.length;e<n;e++)if(this.uploadHooks[e](this.uploadHookHelper,i)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Ce.system.addOnce(this.tick,this,dr.UTILITY);else{this.ticking=!1;const i=this.completes.slice(0);this.completes.length=0;for(let t=0,e=i.length;t<e;t++)i[t]()}}registerFindHook(i){return i&&this.addHooks.push(i),this}registerUploadHook(i){return i&&this.uploadHooks.push(i),this}add(i){for(let t=0,e=this.addHooks.length;t<e&&!this.addHooks[t](i,this.queue);t++);if(i instanceof ke)for(let t=i.children.length-1;t>=0;t--)this.add(i.children[t]);return this}destroy(){this.ticking&&Ce.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Ho=hg;Ho.uploadsPerFrame=4;Object.defineProperties(K,{UPLOADS_PER_FRAME:{get(){return Ho.uploadsPerFrame},set(i){At("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ho.uploadsPerFrame=i}}});function lg(i,t){return t instanceof ft?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function SI(i,t){if(!(t instanceof ea))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:n}=e;for(let r=0;r<n.length;r++){const{texture:o}=n[r].style;o&&lg(i,o.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function CI(i,t){return i instanceof ea?(t.push(i),!0):!1}class ug extends Ho{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(CI),this.registerUploadHook(lg),this.registerUploadHook(SI)}}ug.extension={name:"prepare",type:q.RendererSystem};rt.add(ug);new Et;var II=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,RI=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,PI=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Nd=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,MI=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const xo=new Gt;class cg extends Zo{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new wp,this.state=Vi.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Ei.from(Nd,MI,e),this.shader=t.context.webGLVersion>1?Ei.from(RI,II,e):Ei.from(Nd,PI,e)}render(t){const e=this.renderer,n=this.quad;let r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const o=t.uvRespectAnchor?t.anchor.x:0,h=t.uvRespectAnchor?t.anchor.y:0;r=n.uvs,r[0]=r[6]=-o,r[1]=r[3]=-h,r[2]=r[4]=1-o,r[5]=r[7]=1-h,n.invalidate();const l=t._texture,c=l.baseTexture,f=c.alphaMode>0,d=t.tileTransform.localTransform,g=t.uvMatrix;let m=c.isPowerOfTwo&&l.frame.width===c.width&&l.frame.height===c.height;m&&(c._glTextures[e.CONTEXT_UID]?m=c.wrapMode!==an.CLAMP:c.wrapMode===an.CLAMP&&(c.wrapMode=an.REPEAT));const _=m?this.simpleShader:this.shader,x=l.width,T=l.height,y=t._width,E=t._height;xo.set(d.a*x/y,d.b*x/E,d.c*T/y,d.d*T/E,d.tx/y,d.ty/E),xo.invert(),m?xo.prepend(g.mapCoord):(_.uniforms.uMapCoord=g.mapCoord.toArray(!0),_.uniforms.uClampFrame=g.uClampFrame,_.uniforms.uClampOffset=g.uClampOffset),_.uniforms.uTransform=xo.toArray(!0),_.uniforms.uColor=rp(t.tint,t.worldAlpha,_.uniforms.uColor,f),_.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),_.uniforms.uSampler=l,e.shader.bind(_),e.geometry.bind(n),this.state.blendMode=np(t.blendMode,f),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}cg.extension={name:"tilingSprite",type:q.RendererPlugin};rt.add(cg);const Kr=class{constructor(i,t,e=null){this.linkedSheets=[],this._texture=i instanceof nt?i:null,this.baseTexture=i instanceof ft?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const n=this.baseTexture.resource;this.resolution=this._updateResolution(e||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:t}=this.data.meta;let e=hn(i,null);return e===null&&(e=parseFloat(t??"1")),e!==1&&this.baseTexture.setResolution(e),e}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=Kr.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let t=i;const e=Kr.BATCH_SIZE;for(;t-i<e&&t<this._frameKeys.length;){const n=this._frameKeys[t],r=this._frames[n],o=r.frame;if(o){let h=null,l=null;const c=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,f=new wt(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);r.rotated?h=new wt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):h=new wt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(l=new wt(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new nt(this.baseTexture,h,f,l,r.rotated?2:0,r.anchor),nt.addToCache(this.textures[n],n)}t++}}_processAnimations(){const i=this.data.animations||{};for(const t in i){this.animations[t]=[];for(let e=0;e<i[t].length;e++){const n=i[t][e];this.animations[t].push(this.textures[n])}}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Kr.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Kr.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Fl=Kr;Fl.BATCH_SIZE=1e3;const DI=["jpg","png","jpeg","avif","webp"];function fg(i,t,e){const n={};if(i.forEach(r=>{n[r]=t}),Object.keys(t.textures).forEach(r=>{n[r]=t.textures[r]}),!e){const r=fe.dirname(i[0]);t.linkedSheets.forEach((o,h)=>{const l=fg([`${r}/${t.data.meta.related_multi_packs[h]}`],o,!0);Object.assign(n,l)})}return n}const BI={extension:q.Asset,cache:{test:i=>i instanceof Fl,getCacheableAssets:(i,t)=>fg(i,t,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),n=e.pop(),r=e.pop();return n==="json"&&DI.includes(r)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=K.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{extension:{type:q.LoadParser,priority:Ci.Normal},async testParse(i,t){return fe.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var f,d;let n=fe.dirname(t.src);n&&n.lastIndexOf("/")!==n.length-1&&(n+="/");const r=n+i.meta.image,h=(await e.load([r]))[r],l=new Fl(h.baseTexture,i,t.src);await l.parse();const c=(f=i==null?void 0:i.meta)==null?void 0:f.related_multi_packs;if(Array.isArray(c)){const g=[];for(const _ of c){if(typeof _!="string")continue;const x=n+_;(d=t.data)!=null&&d.ignoreMultiPack||g.push(e.load({src:x,data:{ignoreMultiPack:!0}}))}const m=await Promise.all(g);l.linkedSheets=m,m.forEach(_=>{_.linkedSheets=[l].concat(l.linkedSheets.filter(x=>x!==_))})}return l},unload(i){i.destroy(!0)}}};rt.add(BI);class Xo{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Mo{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in e){const h=e[o].match(/^[a-z]+/gm)[0],l=e[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),c={};for(const f in l){const d=l[f].split("="),g=d[0],m=d[1].replace(/"/gm,""),_=parseFloat(m),x=isNaN(_)?m:_;c[g]=x}n[h].push(c)}const r=new Xo;return n.info.forEach(o=>r.info.push({face:o.face,size:parseInt(o.size,10)})),n.common.forEach(o=>r.common.push({lineHeight:parseInt(o.lineHeight,10)})),n.page.forEach(o=>r.page.push({id:parseInt(o.id,10),file:o.file})),n.char.forEach(o=>r.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),n.kerning.forEach(o=>r.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),n.distanceField.forEach(o=>r.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),r}}class Ll{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new Xo,n=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),h=t.getElementsByTagName("char"),l=t.getElementsByTagName("kerning"),c=t.getElementsByTagName("distanceField");for(let f=0;f<n.length;f++)e.info.push({face:n[f].getAttribute("face"),size:parseInt(n[f].getAttribute("size"),10)});for(let f=0;f<r.length;f++)e.common.push({lineHeight:parseInt(r[f].getAttribute("lineHeight"),10)});for(let f=0;f<o.length;f++)e.page.push({id:parseInt(o[f].getAttribute("id"),10)||0,file:o[f].getAttribute("file")});for(let f=0;f<h.length;f++){const d=h[f];e.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let f=0;f<l.length;f++)e.kerning.push({first:parseInt(l[f].getAttribute("first"),10),second:parseInt(l[f].getAttribute("second"),10),amount:parseInt(l[f].getAttribute("amount"),10)});for(let f=0;f<c.length;f++)e.distanceField.push({fieldType:c[f].getAttribute("fieldType"),distanceRange:parseInt(c[f].getAttribute("distanceRange"),10)});return e}}class Ol{static test(t){return typeof t=="string"&&t.includes("<font>")?Ll.test(K.ADAPTER.parseXML(t)):!1}static parse(t){return Ll.parse(K.ADAPTER.parseXML(t))}}const Zh=[Mo,Ll,Ol];function FI(i){for(let t=0;t<Zh.length;t++)if(Zh[t].test(i))return Zh[t];return null}function LI(i,t,e,n,r,o){const h=e.fill;if(Array.isArray(h)){if(h.length===1)return h[0]}else return h;let l;const c=e.dropShadow?e.dropShadowDistance:0,f=e.padding||0,d=i.width/n-c-f*2,g=i.height/n-c-f*2,m=h.slice(),_=e.fillGradientStops.slice();if(!_.length){const x=m.length+1;for(let T=1;T<x;++T)_.push(T/x)}if(m.unshift(h[0]),_.unshift(0),m.push(h[h.length-1]),_.push(1),e.fillGradientType===ia.LINEAR_VERTICAL){l=t.createLinearGradient(d/2,f,d/2,g+f);let x=0;const y=(o.fontProperties.fontSize+e.strokeThickness)/g;for(let E=0;E<r.length;E++){const S=o.lineHeight*E;for(let A=0;A<m.length;A++){let I=0;typeof _[A]=="number"?I=_[A]:I=A/m.length;const D=S/g+I*y;let N=Math.max(x,D);N=Math.min(N,1),l.addColorStop(N,m[A]),x=N}}}else{l=t.createLinearGradient(f,g/2,d+f,g/2);const x=m.length+1;let T=1;for(let y=0;y<m.length;y++){let E;typeof _[y]=="number"?E=_[y]:E=T/x,l.addColorStop(E,m[y]),T++}}return l}function OI(i,t,e,n,r,o,h){const l=e.text,c=e.fontProperties;t.translate(n,r),t.scale(o,o);const f=h.strokeThickness/2,d=-(h.strokeThickness/2);if(t.font=h.toFontString(),t.lineWidth=h.strokeThickness,t.textBaseline=h.textBaseline,t.lineJoin=h.lineJoin,t.miterLimit=h.miterLimit,t.fillStyle=LI(i,t,h,o,[l],e),t.strokeStyle=h.stroke,h.dropShadow){const g=h.dropShadowColor,m=es(typeof g=="number"?g:Gl(g)),_=h.dropShadowBlur*o,x=h.dropShadowDistance*o;t.shadowColor=`rgba(${m[0]*255},${m[1]*255},${m[2]*255},${h.dropShadowAlpha})`,t.shadowBlur=_,t.shadowOffsetX=Math.cos(h.dropShadowAngle)*x,t.shadowOffsetY=Math.sin(h.dropShadowAngle)*x}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;h.stroke&&h.strokeThickness&&t.strokeText(l,f,d+e.lineHeight-c.descent),h.fill&&t.fillText(l,f,d+e.lineHeight-c.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Do(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function dg(i){return Array.from?Array.from(i):i.split("")}function NI(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,n=i.length;e<n;e++){const r=i[e];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const o=r[0].charCodeAt(0),h=r[1].charCodeAt(0);if(h<o)throw new Error("[BitmapFont]: Invalid character range.");for(let l=o,c=h;l<=c;l++)t.push(String.fromCharCode(l))}else t.push(...dg(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const oi=class{constructor(i,t,e){var f;const[n]=i.info,[r]=i.common,[o]=i.page,[h]=i.distanceField,l=hn(o.file),c={};this._ownsTextures=e,this.font=n.face,this.size=n.size,this.lineHeight=r.lineHeight/l,this.chars={},this.pageTextures=c;for(let d=0;d<i.page.length;d++){const{id:g,file:m}=i.page[d];c[g]=t instanceof Array?t[d]:t[m],h!=null&&h.fieldType&&h.fieldType!=="none"&&(c[g].baseTexture.alphaMode=pi.NO_PREMULTIPLIED_ALPHA,c[g].baseTexture.mipmap=Si.OFF)}for(let d=0;d<i.char.length;d++){const{id:g,page:m}=i.char[d];let{x:_,y:x,width:T,height:y,xoffset:E,yoffset:S,xadvance:A}=i.char[d];_/=l,x/=l,T/=l,y/=l,E/=l,S/=l,A/=l;const I=new wt(_+c[m].frame.x/l,x+c[m].frame.y/l,T,y);this.chars[g]={xOffset:E,yOffset:S,xAdvance:A,kerning:{},texture:new nt(c[m].baseTexture,I),page:m}}for(let d=0;d<i.kerning.length;d++){let{first:g,second:m,amount:_}=i.kerning[d];g/=l,m/=l,_/=l,this.chars[m]&&(this.chars[m].kerning[g]=_)}this.distanceFieldRange=h==null?void 0:h.distanceRange,this.distanceFieldType=((f=h==null?void 0:h.fieldType)==null?void 0:f.toLowerCase())??"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,t,e){let n;if(i instanceof Xo)n=i;else{const o=FI(i);if(!o)throw new Error("Unrecognized data format for font.");n=o.parse(i)}t instanceof nt&&(t=[t]);const r=new oi(n,t,e);return oi.available[r.font]=r,r}static uninstall(i){const t=oi.available[i];if(!t)throw new Error(`No font found named '${i}'`);t.destroy(),delete oi.available[i]}static from(i,t,e){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:r,resolution:o,textureWidth:h,textureHeight:l,...c}=Object.assign({},oi.defaultOptions,e),f=NI(n),d=t instanceof Ln?t:new Ln(t),g=h,m=new Xo;m.info[0]={face:d.fontFamily,size:d.fontSize},m.common[0]={lineHeight:d.fontSize};let _=0,x=0,T,y,E,S=0;const A=[];for(let D=0;D<f.length;D++){T||(T=K.ADAPTER.createCanvas(),T.width=h,T.height=l,y=T.getContext("2d"),E=new ft(T,{resolution:o,...c}),A.push(new nt(E)),m.page.push({id:A.length-1,file:""}));const N=f[D],L=ue.measureText(N,d,!1,T),F=L.width,V=Math.ceil(L.height),J=Math.ceil((d.fontStyle==="italic"?2:1)*F);if(x>=l-V*o){if(x===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${N}')`);--D,T=null,y=null,E=null,x=0,_=0,S=0;continue}if(S=Math.max(V+L.fontProperties.descent,S),J*o+_>=g){if(_===0)throw new Error(`[BitmapFont] textureWidth ${h}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${N}')`);--D,x+=S*o,x=Math.ceil(x),_=0,S=0;continue}OI(T,y,L,_,x,o,d);const $=Do(L.text);m.char.push({id:$,page:A.length-1,x:_/o,y:x/o,width:J,height:V,xoffset:0,yoffset:0,xadvance:Math.ceil(F-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0))}),_+=(J+2*r)*o,_=Math.ceil(_)}for(let D=0,N=f.length;D<N;D++){const L=f[D];for(let F=0;F<N;F++){const V=f[F],J=y.measureText(L).width,$=y.measureText(V).width,X=y.measureText(L+V).width-(J+$);X&&m.kerning.push({first:Do(L),second:Do(V),amount:X})}}const I=new oi(m,A,!0);return oi.available[i]!==void 0&&oi.uninstall(i),oi.available[i]=I,I}};let Se=oi;Se.ALPHA=[["a","z"],["A","Z"]," "];Se.NUMERIC=[["0","9"]];Se.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Se.ASCII=[[" ","~"]];Se.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:oi.ALPHANUMERIC};Se.available={};var kI=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,UI=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const kd=[],Ud=[],Gd=[],pg=class extends ke{constructor(i,t={}){super(),this._tint=16777215;const{align:e,tint:n,maxWidth:r,letterSpacing:o,fontName:h,fontSize:l}=Object.assign({},pg.styleDefaults,t);if(!Se.available[h])throw new Error(`Missing BitmapFont "${h}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tint=n,this._font=void 0,this._fontName=h,this._fontSize=l,this.text=i,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new on(()=>{this.dirty=!0},this,0,0),this._roundPixels=K.ROUND_PIXELS,this.dirty=!0,this._resolution=K.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var J;const i=Se.available[this._fontName],t=this.fontSize,e=t/i.size,n=new Et,r=[],o=[],h=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",c=dg(l),f=this._maxWidth*i.size/t,d=i.distanceFieldType==="none"?kd:Ud;let g=null,m=0,_=0,x=0,T=-1,y=0,E=0,S=0,A=0;for(let $=0;$<c.length;$++){const Q=c[$],X=Do(Q);if(/(?:\s)/.test(Q)&&(T=$,y=m,A++),Q==="\r"||Q===`
`){o.push(m),h.push(-1),_=Math.max(_,m),++x,++E,n.x=0,n.y+=i.lineHeight,g=null,A=0;continue}const G=i.chars[X];if(!G)continue;g&&G.kerning[g]&&(n.x+=G.kerning[g]);const dt=Gd.pop()||{texture:nt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Et};dt.texture=G.texture,dt.line=x,dt.charCode=X,dt.position.x=n.x+G.xOffset+this._letterSpacing/2,dt.position.y=n.y+G.yOffset,dt.prevSpaces=A,r.push(dt),m=dt.position.x+Math.max(G.xAdvance-G.xOffset,G.texture.orig.width),n.x+=G.xAdvance+this._letterSpacing,S=Math.max(S,G.yOffset+G.texture.height),g=X,T!==-1&&f>0&&n.x>f&&(++E,ur(r,1+T-E,1+$-T),$=T,T=-1,o.push(y),h.push(r.length>0?r[r.length-1].prevSpaces:0),_=Math.max(_,y),x++,n.x=0,n.y+=i.lineHeight,g=null,A=0)}const I=c[c.length-1];I!=="\r"&&I!==`
`&&(/(?:\s)/.test(I)&&(m=y),o.push(m),_=Math.max(_,m),h.push(-1));const D=[];for(let $=0;$<=x;$++){let Q=0;this._align==="right"?Q=_-o[$]:this._align==="center"?Q=(_-o[$])/2:this._align==="justify"&&(Q=h[$]<0?0:(_-o[$])/h[$]),D.push(Q)}const N=r.length,L={},F=[],V=this._activePagesMeshData;d.push(...V);for(let $=0;$<N;$++){const Q=r[$].texture,X=Q.baseTexture.uid;if(!L[X]){let G=d.pop();if(!G){const _t=new uI;let j,vt;i.distanceFieldType==="none"?(j=new Fd(nt.EMPTY),vt=lt.NORMAL):(j=new Fd(nt.EMPTY,{program:li.from(UI,kI),uniforms:{uFWidth:0}}),vt=lt.NORMAL_NPM);const kt=new Dl(_t,j);kt.blendMode=vt,G={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:kt,vertices:null,uvs:null,indices:null}}G.index=0,G.indexCount=0,G.vertexCount=0,G.uvsCount=0,G.total=0;const{_textureCache:dt}=this;dt[X]=dt[X]||new nt(Q.baseTexture),G.mesh.texture=dt[X],G.mesh.tint=this._tint,F.push(G),L[X]=G}L[X].total++}for(let $=0;$<V.length;$++)F.includes(V[$])||this.removeChild(V[$].mesh);for(let $=0;$<F.length;$++)F[$].mesh.parent!==this&&this.addChild(F[$].mesh);this._activePagesMeshData=F;for(const $ in L){const Q=L[$],X=Q.total;if(!(((J=Q.indices)==null?void 0:J.length)>6*X)||Q.vertices.length<Dl.BATCHABLE_SIZE*2)Q.vertices=new Float32Array(4*2*X),Q.uvs=new Float32Array(4*2*X),Q.indices=new Uint16Array(6*X);else{const G=Q.total,dt=Q.vertices;for(let _t=G*4*2;_t<dt.length;_t++)dt[_t]=0}Q.mesh.size=6*X}for(let $=0;$<N;$++){const Q=r[$];let X=Q.position.x+D[Q.line]*(this._align==="justify"?Q.prevSpaces:1);this._roundPixels&&(X=Math.round(X));const G=X*e,dt=Q.position.y*e,_t=Q.texture,j=L[_t.baseTexture.uid],vt=_t.frame,kt=_t._uvs,H=j.index++;j.indices[H*6+0]=0+H*4,j.indices[H*6+1]=1+H*4,j.indices[H*6+2]=2+H*4,j.indices[H*6+3]=0+H*4,j.indices[H*6+4]=2+H*4,j.indices[H*6+5]=3+H*4,j.vertices[H*8+0]=G,j.vertices[H*8+1]=dt,j.vertices[H*8+2]=G+vt.width*e,j.vertices[H*8+3]=dt,j.vertices[H*8+4]=G+vt.width*e,j.vertices[H*8+5]=dt+vt.height*e,j.vertices[H*8+6]=G,j.vertices[H*8+7]=dt+vt.height*e,j.uvs[H*8+0]=kt.x0,j.uvs[H*8+1]=kt.y0,j.uvs[H*8+2]=kt.x1,j.uvs[H*8+3]=kt.y1,j.uvs[H*8+4]=kt.x2,j.uvs[H*8+5]=kt.y2,j.uvs[H*8+6]=kt.x3,j.uvs[H*8+7]=kt.y3}this._textWidth=_*e,this._textHeight=(n.y+i.lineHeight)*e;for(const $ in L){const Q=L[$];if(this.anchor.x!==0||this.anchor.y!==0){let _t=0;const j=this._textWidth*this.anchor.x,vt=this._textHeight*this.anchor.y;for(let kt=0;kt<Q.total;kt++)Q.vertices[_t++]-=j,Q.vertices[_t++]-=vt,Q.vertices[_t++]-=j,Q.vertices[_t++]-=vt,Q.vertices[_t++]-=j,Q.vertices[_t++]-=vt,Q.vertices[_t++]-=j,Q.vertices[_t++]-=vt}this._maxLineHeight=S*e;const X=Q.mesh.geometry.getBuffer("aVertexPosition"),G=Q.mesh.geometry.getBuffer("aTextureCoord"),dt=Q.mesh.geometry.getIndex();X.data=Q.vertices,G.data=Q.uvs,dt.data=Q.indices,X.update(),G.update(),dt.update()}for(let $=0;$<r.length;$++)Gd.push(r[$]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:n}=Se.available[this._fontName];if(e!=="none"){const{a:r,b:o,c:h,d:l}=this.worldTransform,c=Math.sqrt(r*r+o*o),f=Math.sqrt(h*h+l*l),d=(Math.abs(c)+Math.abs(f))/2,g=this.fontSize/n,m=i._view.resolution;for(const _ of this._activePagesMeshData)_.mesh.shader.uniforms.uFWidth=d*t*g*m}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=Se.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(i){if(this._tint!==i){this._tint=i;for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!Se.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){return this._fontSize??Se.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:t}=this,n=Se.available[this._fontName].distanceFieldType==="none"?kd:Ud;n.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],n.filter(r=>t[r.mesh.texture.baseTexture.uid]).forEach(r=>{r.mesh.texture=nt.EMPTY});for(const r in t)t[r].destroy(),delete t[r];this._font=null,this._textureCache=null,super.destroy(i)}};let GI=pg;GI.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const WI=[".xml",".fnt"],HI={extension:{type:q.LoadParser,priority:Ci.Normal},test(i){return WI.includes(fe.extname(i).toLowerCase())},async testParse(i){return Mo.test(i)||Ol.test(i)},async parse(i,t,e){const n=Mo.test(i)?Mo.parse(i):Ol.parse(i),{src:r}=t,{page:o}=n,h=[];for(let f=0;f<o.length;++f){const d=o[f].file,g=fe.join(fe.dirname(r),d);h.push(g)}const l=await e.load(h),c=h.map(f=>l[f]);return Se.install(n,c,!0)},async load(i,t){return(await K.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};rt.add(HI);const XI={A:"menlo-bold-0.png",B:"menlo-bold-1.png",C:"menlo-bold-2.png",D:"menlo-bold-3.png",E:"menlo-bold-4.png",F:"menlo-bold-5.png",G:"menlo-bold-6.png",H:"menlo-bold-7.png",I:"menlo-bold-8.png",J:"menlo-bold-9.png",K:"menlo-bold-10.png",L:"menlo-bold-11.png",M:"menlo-bold-12.png",N:"menlo-bold-13.png",O:"menlo-bold-14.png",P:"menlo-bold-15.png",Q:"menlo-bold-16.png",R:"menlo-bold-17.png",S:"menlo-bold-18.png",T:"menlo-bold-19.png",U:"menlo-bold-20.png",V:"menlo-bold-21.png",W:"menlo-bold-22.png",X:"menlo-bold-23.png",Y:"menlo-bold-24.png",Z:"menlo-bold-25.png",a:"menlo-bold-26.png",b:"menlo-bold-27.png",c:"menlo-bold-28.png",d:"menlo-bold-29.png",e:"menlo-bold-30.png",f:"menlo-bold-31.png",g:"menlo-bold-32.png",h:"menlo-bold-33.png",i:"menlo-bold-34.png",j:"menlo-bold-35.png",k:"menlo-bold-36.png",l:"menlo-bold-37.png",m:"menlo-bold-38.png",n:"menlo-bold-39.png",o:"menlo-bold-40.png",p:"menlo-bold-41.png",q:"menlo-bold-42.png",r:"menlo-bold-43.png",s:"menlo-bold-44.png",t:"menlo-bold-45.png",u:"menlo-bold-46.png",v:"menlo-bold-47.png",w:"menlo-bold-48.png",x:"menlo-bold-49.png",y:"menlo-bold-50.png",z:"menlo-bold-51.png",0:"menlo-bold-52.png",1:"menlo-bold-53.png",2:"menlo-bold-54.png",3:"menlo-bold-55.png",4:"menlo-bold-56.png",5:"menlo-bold-57.png",6:"menlo-bold-58.png",7:"menlo-bold-59.png",8:"menlo-bold-60.png",9:"menlo-bold-61.png","!":"menlo-bold-62.png","@":"menlo-bold-63.png","#":"menlo-bold-64.png",$:"menlo-bold-65.png","%":"menlo-bold-66.png","^":"menlo-bold-67.png","&":"menlo-bold-68.png","*":"menlo-bold-69.png","(":"menlo-bold-70.png",")":"menlo-bold-71.png","-":"menlo-bold-72.png",_:"menlo-bold-73.png","=":"menlo-bold-74.png","+":"menlo-bold-75.png",",":"menlo-bold-76.png",".":"menlo-bold-77.png","<":"menlo-bold-78.png",">":"menlo-bold-79.png","/":"menlo-bold-80.png","?":"menlo-bold-81.png",";":"menlo-bold-82.png",":":"menlo-bold-83.png",'"':"menlo-bold-84.png","'":"menlo-bold-85.png","[":"menlo-bold-86.png","]":"menlo-bold-87.png","{":"menlo-bold-88.png","}":"menlo-bold-89.png","\\":"menlo-bold-90.png","|":"menlo-bold-91.png","`":"menlo-bold-92.png","~":"menlo-bold-93.png","•":"menlo-bold-94.png"},zI={A:"menlo-bold-half-0.png",B:"menlo-bold-half-1.png",C:"menlo-bold-half-2.png",D:"menlo-bold-half-3.png",E:"menlo-bold-half-4.png",F:"menlo-bold-half-5.png",G:"menlo-bold-half-6.png",H:"menlo-bold-half-7.png",I:"menlo-bold-half-8.png",J:"menlo-bold-half-9.png",K:"menlo-bold-half-10.png",L:"menlo-bold-half-11.png",M:"menlo-bold-half-12.png",N:"menlo-bold-half-13.png",O:"menlo-bold-half-14.png",P:"menlo-bold-half-15.png",Q:"menlo-bold-half-16.png",R:"menlo-bold-half-17.png",S:"menlo-bold-half-18.png",T:"menlo-bold-half-19.png",U:"menlo-bold-half-20.png",V:"menlo-bold-half-21.png",W:"menlo-bold-half-22.png",X:"menlo-bold-half-23.png",Y:"menlo-bold-half-24.png",Z:"menlo-bold-half-25.png",a:"menlo-bold-half-26.png",b:"menlo-bold-half-27.png",c:"menlo-bold-half-28.png",d:"menlo-bold-half-29.png",e:"menlo-bold-half-30.png",f:"menlo-bold-half-31.png",g:"menlo-bold-half-32.png",h:"menlo-bold-half-33.png",i:"menlo-bold-half-34.png",j:"menlo-bold-half-35.png",k:"menlo-bold-half-36.png",l:"menlo-bold-half-37.png",m:"menlo-bold-half-38.png",n:"menlo-bold-half-39.png",o:"menlo-bold-half-40.png",p:"menlo-bold-half-41.png",q:"menlo-bold-half-42.png",r:"menlo-bold-half-43.png",s:"menlo-bold-half-44.png",t:"menlo-bold-half-45.png",u:"menlo-bold-half-46.png",v:"menlo-bold-half-47.png",w:"menlo-bold-half-48.png",x:"menlo-bold-half-49.png",y:"menlo-bold-half-50.png",z:"menlo-bold-half-51.png",0:"menlo-bold-half-52.png",1:"menlo-bold-half-53.png",2:"menlo-bold-half-54.png",3:"menlo-bold-half-55.png",4:"menlo-bold-half-56.png",5:"menlo-bold-half-57.png",6:"menlo-bold-half-58.png",7:"menlo-bold-half-59.png",8:"menlo-bold-half-60.png",9:"menlo-bold-half-61.png","!":"menlo-bold-half-62.png","@":"menlo-bold-half-63.png","#":"menlo-bold-half-64.png",$:"menlo-bold-half-65.png","%":"menlo-bold-half-66.png","^":"menlo-bold-half-67.png","&":"menlo-bold-half-68.png","*":"menlo-bold-half-69.png","(":"menlo-bold-half-70.png",")":"menlo-bold-half-71.png","-":"menlo-bold-half-72.png",_:"menlo-bold-half-73.png","=":"menlo-bold-half-74.png","+":"menlo-bold-half-75.png",",":"menlo-bold-half-76.png",".":"menlo-bold-half-77.png","<":"menlo-bold-half-78.png",">":"menlo-bold-half-79.png","/":"menlo-bold-half-80.png","?":"menlo-bold-half-81.png",";":"menlo-bold-half-82.png",":":"menlo-bold-half-83.png",'"':"menlo-bold-half-84.png","'":"menlo-bold-half-85.png","[":"menlo-bold-half-86.png","]":"menlo-bold-half-87.png","{":"menlo-bold-half-88.png","}":"menlo-bold-half-89.png","\\":"menlo-bold-half-90.png","|":"menlo-bold-half-91.png","`":"menlo-bold-half-92.png","~":"menlo-bold-half-93.png","•":"menlo-bold-half-94.png"};let gg;const mg={width:100,height:44,map:{width:74,height:39,x:13,y:3}},sn=window.innerWidth/mg.width,$I=(i,t,e)=>{const n=Math.trunc(i/sn),r=Math.trunc(t/sn);return`${n},${r},${e}`},Mn={};async function VI(i){gg=new Yl({view:i,width:window.innerWidth,height:sn*mg.height,autoDensity:!0,resolution:window.devicePixelRatio||1}),await YI()}const YI=async()=>(Mn.ascii=await Rn.load("/skulltooth/fonts/menlo-bold.json"),Mn.text=await Rn.load("/skulltooth/fonts/menlo-bold-half.json"),Mn.tile=await Rn.load("/skulltooth/tile.png"),Mn),jI=i=>Mn.ascii.textures[XI[i]],qI=i=>Mn.text.textures[zI[i]],KI=()=>Mn.tile;class yo{constructor(t){le(this,"x",0);le(this,"y",0);le(this,"halfWidth",!1);le(this,"width");le(this,"height");le(this,"layers",[]);le(this,"sprites",[]);le(this,"tileSets",[]);le(this,"tints",[]);le(this,"alphas",[]);le(this,"_getTexture",t=>{const{tileSet:e,char:n}=t;return e==="ascii"?jI(n):e==="text"?qI(n):KI()});le(this,"_createSprite",t=>{const{char:e,width:n,height:r,layer:o,x:h,y:l,tileSet:c,tint:f=16777215,alpha:d=1}=t,g=this._getTexture({tileSet:c,char:e});let m=new yr(g);m.width=this.halfWidth?n/2:n,m.height=r,m.x=this.halfWidth?h*(n/2):h*n,m.y=l*r,m.tint=f,m.alpha=d,this.sprites[o][l][h]=m,this.layers[o].addChild(m)});le(this,"updateCell",t=>(Object.keys(t).forEach(e=>{const{char:n,tint:r,alpha:o,tileSet:h,x:l,y:c}=t[e];this.updateSprite({char:n,tint:r,alpha:o,tileSet:h,x:l,y:c,layer:parseInt(e)})}),this));le(this,"updateSprite",async t=>{const{char:e="",layer:n,x:r,y:o,tileSet:h="text",tint:l,alpha:c}=t,f=this.sprites[n][o][r];return f.texture=this._getTexture({tileSet:h,char:e}),l&&(f.tint=l),c&&(f.alpha=c),this});le(this,"updateRows",t=>(t.forEach((e,n)=>{e.forEach((r,o)=>{this.updateRow({...r,layer:o,y:n})})}),this));le(this,"updateRow",t=>{const{string:e="",layer:n=0,x:r,y:o,tileSet:h,tint:l,alpha:c}=t;return[...e].forEach((d,g)=>this.updateSprite({char:d,layer:n||0,x:r||0+g,y:o||0,tileSet:h||this.tileSets[n],tint:l||this.tints[n],alpha:c||this.alphas[n]})),(h||this.tileSets[n])==="tile"&&Jn.times(this.width,d=>{this.updateSprite({layer:n,x:r||0+d,y:o||0,tileSet:h||this.tileSets[n],tint:l||this.tints[n],alpha:c||this.alphas[n]})}),this});return this.width=t.width,this.height=t.height,this.tileSets=t.tileSets,this.tints=t.tints,this.alphas=t.alphas,this.halfWidth=this.tileSets.includes("text"),Jn.times(t.layers,()=>this.layers.push(new ke)),this.layers.forEach(e=>{const n=this.halfWidth?t.x*(sn/2):t.x*sn,r=t.y*sn;e.x=n,e.y=r,e.interactiveChildren=!1,gg.stage.addChild(e)}),Jn.times(t.layers,()=>this.sprites.push(Array.from(Array(this.height),()=>Array.from(Array(this.width))))),Jn.times(t.layers,e=>{Jn.times(this.height,n=>{Jn.times(this.width,async r=>{this._createSprite({char:"",width:sn,height:sn,layer:e,x:r,y:n,tileSet:t.tileSets[e],tint:t.tints[e],alpha:t.alphas[e]})})})}),this}}var je=(i=>(i.Ai="ai",i.Appearance="appearance",i.IsBlocking="isBlocking",i.IsInFov="isInFov",i.IsOpaque="isOpaque",i.IsPlayer="isPlayer",i.IsRevealed="isRevealed",i.PathThrough="pathThrough",i.Position="position",i.TryMove="tryMove",i))(je||{});let _g=0;const Jl=new Map,Ql={},zi={},vg=()=>++_g+Math.random().toString(36).slice(2,10),Xi=i=>zi[i],En=(i,t)=>{const e={name:i,filters:t,entities:new Set};return zi[i]=e,zi},ZI=(i,t)=>{const e=zi[t].filters.all;if(e.length){const n=de(i);if(!n)throw`entity ${i} does not exist`;return Ie.exports.every(e,r=>n.components[r])}return!0},JI=(i,t)=>{const e=zi[t].filters.any;if(e.length){const n=de(i);if(!n)throw`entity ${i} does not exist`;return Ie.exports.some(e,r=>n.components[r])}return!0},QI=(i,t)=>{const e=zi[t].filters.none;if(e.length){const n=de(i);if(!n)throw`entity ${i} does not exist`;return Ie.exports.every(e,r=>!n.components[r])}return!0},tR=(i,t)=>{const e=zi[t];return ZI(i,t)&&JI(i,t)&&QI(i,t)?e.entities.add(i):e.entities.delete(i),e.entities},xg=i=>{Object.keys(zi).forEach(e=>tR(i,e))},eR=i=>{const t=(i==null?void 0:i.wId)||vg(),e=(i==null?void 0:i.eIds)||new Set,n={id:t,eIds:e};return Ql[t]=n,n},na=({eId:i,wId:t})=>{const e=i||vg(),n={id:e,wId:t,components:{}};return Jl.set(e,n),Ql[t].eIds.add(e),n},de=i=>Jl.get(i),Ne=(i,t)=>{const e=de(i);if(!e)throw`entity ${i} does not exist`;return Object.assign(e.components,t),xg(i),e},yg=(i,t)=>{const e=de(i);if(!e)throw`entity ${i} does not exist`;return delete e.components[t],xg(i),e},ra=(i,t)=>{t.forEach(e=>{Ne(i,Ie.exports.cloneDeep(e))})},iR=()=>({entities:Jl,worlds:Ql,queries:zi,_id:_g}),br=i=>`${i.x},${i.y},${i.z}`,bg=i=>{const t=i.split(",").map(e=>parseInt(e,10));return{x:t[0],y:t[1],z:t[2]}},Wd=(i,t)=>{const{x:e,y:n,z:r,width:o,height:h,hasWalls:l}=i,c={},f=e,d=e+o,g=n,m=n+h;if(l)for(let x=g+1;x<m-1;x++)for(let T=f+1;T<d-1;T++)c[`${T},${x},${r}`]={x:T,y:x,z:r,...t};else for(let x=g;x<m;x++)for(let T=f;T<d;T++)c[`${T},${x},${r}`]={x:T,y:x,z:r,...t};const _={x:Math.round((f+d)/2),y:Math.round((g+m)/2),z:r};return{x1:f,x2:d,y1:g,y2:m,z:r,center:_,hasWalls:l,tiles:c,width:o,height:h}},nR=(i,t)=>i.x1<=t.x2&&i.x2>=t.x1&&i.y1<=t.y2&&i.y2>=t.y1;var Ai=(i=>(i.HasAi="hasAi",i.HasAppearance="hasAppearance",i.IsInFov="isInFov",i.IsOpaque="isOpaque",i.IsPlayer="isPlayer",i.IsRevealed="isRevealed",i.IsTryingToMove="isTryingToMove",i))(Ai||{});const rR=()=>{En("hasAi",{any:[],all:[je.Ai],none:[]}),En("hasAppearance",{any:[],all:[je.Appearance],none:[]}),En("isInFov",{any:[je.IsInFov],all:[],none:[]}),En("isOpaque",{any:[je.IsOpaque],all:[],none:[]}),En("isRevealed",{any:[je.IsRevealed],all:[],none:[je.IsInFov]}),En("isPlayer",{any:[je.IsPlayer],all:[],none:[]}),En("isTryingToMove",{any:[],all:[je.Position,je.TryMove],none:[]})},sR=()=>{const{userInput:i}=ee(),t=Xi(Ai.IsPlayer);if(!i)return ui(n=>{n.userInput=null});const{key:e}=i;t.entities.forEach(n=>{const r=de(n);if(r!=null&&r.components.position){ui(c=>{c.toRender.add(br(r.components.position))});const{x:o,y:h,z:l}=r.components.position;if(e==="h"||e==="ArrowLeft"){const c={x:o-1,y:h,z:l};Ne(n,{tryMove:c})}if(e==="j"||e==="ArrowDown"){const c={x:o,y:h+1,z:l};Ne(n,{tryMove:c})}if(e==="k"||e==="ArrowUp"){const c={x:o,y:h-1,z:l};Ne(n,{tryMove:c})}if(e==="l"||e==="ArrowRight"){const c={x:o+1,y:h,z:l};Ne(n,{tryMove:c})}}}),ui(n=>{n.userInput=null})};var wg={exports:{}},hs={exports:{}},Tg={exports:{}};(function(i){(function(){var t,e,n,r,o,h,l,c,f,d,g,m,_,x,T;n=Math.floor,d=Math.min,e=function(y,E){return y<E?-1:y>E?1:0},f=function(y,E,S,A,I){var D;if(S==null&&(S=0),I==null&&(I=e),S<0)throw new Error("lo must be non-negative");for(A==null&&(A=y.length);S<A;)D=n((S+A)/2),I(E,y[D])<0?A=D:S=D+1;return[].splice.apply(y,[S,S-S].concat(E)),E},h=function(y,E,S){return S==null&&(S=e),y.push(E),x(y,0,y.length-1,S)},o=function(y,E){var S,A;return E==null&&(E=e),S=y.pop(),y.length?(A=y[0],y[0]=S,T(y,0,E)):A=S,A},c=function(y,E,S){var A;return S==null&&(S=e),A=y[0],y[0]=E,T(y,0,S),A},l=function(y,E,S){var A;return S==null&&(S=e),y.length&&S(y[0],E)<0&&(A=[y[0],E],E=A[0],y[0]=A[1],T(y,0,S)),E},r=function(y,E){var S,A,I,D,N,L;for(E==null&&(E=e),D=function(){L=[];for(var F=0,V=n(y.length/2);0<=V?F<V:F>V;0<=V?F++:F--)L.push(F);return L}.apply(this).reverse(),N=[],A=0,I=D.length;A<I;A++)S=D[A],N.push(T(y,S,E));return N},_=function(y,E,S){var A;if(S==null&&(S=e),A=y.indexOf(E),A!==-1)return x(y,0,A,S),T(y,A,S)},g=function(y,E,S){var A,I,D,N,L;if(S==null&&(S=e),I=y.slice(0,E),!I.length)return I;for(r(I,S),L=y.slice(E),D=0,N=L.length;D<N;D++)A=L[D],l(I,A,S);return I.sort(S).reverse()},m=function(y,E,S){var A,I,D,N,L,F,V,J,$;if(S==null&&(S=e),E*10<=y.length){if(D=y.slice(0,E).sort(S),!D.length)return D;for(I=D[D.length-1],V=y.slice(E),N=0,F=V.length;N<F;N++)A=V[N],S(A,I)<0&&(f(D,A,0,null,S),D.pop(),I=D[D.length-1]);return D}for(r(y,S),$=[],L=0,J=d(E,y.length);0<=J?L<J:L>J;0<=J?++L:--L)$.push(o(y,S));return $},x=function(y,E,S,A){var I,D,N;for(A==null&&(A=e),I=y[S];S>E;){if(N=S-1>>1,D=y[N],A(I,D)<0){y[S]=D,S=N;continue}break}return y[S]=I},T=function(y,E,S){var A,I,D,N,L;for(S==null&&(S=e),I=y.length,L=E,D=y[E],A=2*E+1;A<I;)N=A+1,N<I&&!(S(y[A],y[N])<0)&&(A=N),y[E]=y[A],E=A,A=2*E+1;return y[E]=D,x(y,L,E,S)},t=function(){y.push=h,y.pop=o,y.replace=c,y.pushpop=l,y.heapify=r,y.updateItem=_,y.nlargest=g,y.nsmallest=m;function y(E){this.cmp=E??e,this.nodes=[]}return y.prototype.push=function(E){return h(this.nodes,E,this.cmp)},y.prototype.pop=function(){return o(this.nodes,this.cmp)},y.prototype.peek=function(){return this.nodes[0]},y.prototype.contains=function(E){return this.nodes.indexOf(E)!==-1},y.prototype.replace=function(E){return c(this.nodes,E,this.cmp)},y.prototype.pushpop=function(E){return l(this.nodes,E,this.cmp)},y.prototype.heapify=function(){return r(this.nodes,this.cmp)},y.prototype.updateItem=function(E){return _(this.nodes,E,this.cmp)},y.prototype.clear=function(){return this.nodes=[]},y.prototype.empty=function(){return this.nodes.length===0},y.prototype.size=function(){return this.nodes.length},y.prototype.clone=function(){var E;return E=new y,E.nodes=this.nodes.slice(0),E},y.prototype.toArray=function(){return this.nodes.slice(0)},y.prototype.insert=y.prototype.push,y.prototype.top=y.prototype.peek,y.prototype.front=y.prototype.peek,y.prototype.has=y.prototype.contains,y.prototype.copy=y.prototype.clone,y}(),i!==null&&i.exports?i.exports=t:window.Heap=t}).call(Ui)})(Tg);(function(i){i.exports=Tg.exports})(hs);function oR(i,t,e){this.x=i,this.y=t,this.walkable=e===void 0?!0:e}var tu=oR,aR={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},Ke=aR,Eg=tu,bo=Ke;function $i(i,t,e){var n;typeof i!="object"?n=i:(t=i.length,n=i[0].length,e=i),this.width=n,this.height=t,this.nodes=this._buildNodes(n,t,e)}$i.prototype._buildNodes=function(i,t,e){var n,r,o=new Array(t);for(n=0;n<t;++n)for(o[n]=new Array(i),r=0;r<i;++r)o[n][r]=new Eg(r,n);if(e===void 0)return o;if(e.length!==t||e[0].length!==i)throw new Error("Matrix size does not fit");for(n=0;n<t;++n)for(r=0;r<i;++r)e[n][r]&&(o[n][r].walkable=!1);return o};$i.prototype.getNodeAt=function(i,t){return this.nodes[t][i]};$i.prototype.isWalkableAt=function(i,t){return this.isInside(i,t)&&this.nodes[t][i].walkable};$i.prototype.isInside=function(i,t){return i>=0&&i<this.width&&t>=0&&t<this.height};$i.prototype.setWalkableAt=function(i,t,e){this.nodes[t][i].walkable=e};$i.prototype.getNeighbors=function(i,t){var e=i.x,n=i.y,r=[],o=!1,h=!1,l=!1,c=!1,f=!1,d=!1,g=!1,m=!1,_=this.nodes;if(this.isWalkableAt(e,n-1)&&(r.push(_[n-1][e]),o=!0),this.isWalkableAt(e+1,n)&&(r.push(_[n][e+1]),l=!0),this.isWalkableAt(e,n+1)&&(r.push(_[n+1][e]),f=!0),this.isWalkableAt(e-1,n)&&(r.push(_[n][e-1]),g=!0),t===bo.Never)return r;if(t===bo.OnlyWhenNoObstacles)h=g&&o,c=o&&l,d=l&&f,m=f&&g;else if(t===bo.IfAtMostOneObstacle)h=g||o,c=o||l,d=l||f,m=f||g;else if(t===bo.Always)h=!0,c=!0,d=!0,m=!0;else throw new Error("Incorrect value of diagonalMovement");return h&&this.isWalkableAt(e-1,n-1)&&r.push(_[n-1][e-1]),c&&this.isWalkableAt(e+1,n-1)&&r.push(_[n-1][e+1]),d&&this.isWalkableAt(e+1,n+1)&&r.push(_[n+1][e+1]),m&&this.isWalkableAt(e-1,n+1)&&r.push(_[n+1][e-1]),r};$i.prototype.clone=function(){var i,t,e=this.width,n=this.height,r=this.nodes,o=new $i(e,n),h=new Array(n);for(i=0;i<n;++i)for(h[i]=new Array(e),t=0;t<e;++t)h[i][t]=new Eg(t,i,r[i][t].walkable);return o.nodes=h,o};var hR=$i,Ue={};function Nl(i){for(var t=[[i.x,i.y]];i.parent;)i=i.parent,t.push([i.x,i.y]);return t.reverse()}Ue.backtrace=Nl;function lR(i,t){var e=Nl(i),n=Nl(t);return e.concat(n.reverse())}Ue.biBacktrace=lR;function uR(i){var t,e=0,n,r,o,h;for(t=1;t<i.length;++t)n=i[t-1],r=i[t],o=n[0]-r[0],h=n[1]-r[1],e+=Math.sqrt(o*o+h*h);return e}Ue.pathLength=uR;function eu(i,t,e,n){var r=Math.abs,o=[],h,l,c,f,d,g;for(c=r(e-i),f=r(n-t),h=i<e?1:-1,l=t<n?1:-1,d=c-f;o.push([i,t]),!(i===e&&t===n);)g=2*d,g>-f&&(d=d-f,i=i+h),g<c&&(d=d+c,t=t+l);return o}Ue.interpolate=eu;function cR(i){var t=[],e=i.length,n,r,o,h,l,c;if(e<2)return t;for(l=0;l<e-1;++l)for(n=i[l],r=i[l+1],o=eu(n[0],n[1],r[0],r[1]),h=o.length,c=0;c<h-1;++c)t.push(o[c]);return t.push(i[e-1]),t}Ue.expandPath=cR;function fR(i,t){var e=t.length,n=t[0][0],r=t[0][1],o=t[e-1][0],h=t[e-1][1],l,c,f,d,g,m,_,x,T,y,E;for(l=n,c=r,g=[[l,c]],m=2;m<e;++m){for(x=t[m],f=x[0],d=x[1],T=eu(l,c,f,d),E=!1,_=1;_<T.length;++_)if(y=T[_],!i.isWalkableAt(y[0],y[1])){E=!0;break}E&&(lastValidCoord=t[m-1],g.push(lastValidCoord),l=lastValidCoord[0],c=lastValidCoord[1])}return g.push([o,h]),g}Ue.smoothenPath=fR;function dR(i){if(i.length<3)return i;var t=[],e=i[0][0],n=i[0][1],r=i[1][0],o=i[1][1],h=r-e,l=o-n,c,f,d,g,m,_;for(m=Math.sqrt(h*h+l*l),h/=m,l/=m,t.push([e,n]),_=2;_<i.length;_++)c=r,f=o,d=h,g=l,r=i[_][0],o=i[_][1],h=r-c,l=o-f,m=Math.sqrt(h*h+l*l),h/=m,l/=m,(h!==d||l!==g)&&t.push([c,f]);return t.push([r,o]),t}Ue.compressPath=dR;var ls={manhattan:function(i,t){return i+t},euclidean:function(i,t){return Math.sqrt(i*i+t*t)},octile:function(i,t){var e=Math.SQRT2-1;return i<t?e*i+t:e*t+i},chebyshev:function(i,t){return Math.max(i,t)}},pR=hs.exports,gR=Ue,Jh=ls,wo=Ke;function Ag(i){i=i||{},this.allowDiagonal=i.allowDiagonal,this.dontCrossCorners=i.dontCrossCorners,this.heuristic=i.heuristic||Jh.manhattan,this.weight=i.weight||1,this.diagonalMovement=i.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=wo.OnlyWhenNoObstacles:this.diagonalMovement=wo.IfAtMostOneObstacle:this.diagonalMovement=wo.Never),this.diagonalMovement===wo.Never?this.heuristic=i.heuristic||Jh.manhattan:this.heuristic=i.heuristic||Jh.octile}Ag.prototype.findPath=function(i,t,e,n,r){var o=new pR(function(D,N){return D.f-N.f}),h=r.getNodeAt(i,t),l=r.getNodeAt(e,n),c=this.heuristic,f=this.diagonalMovement,d=this.weight,g=Math.abs,m=Math.SQRT2,_,x,T,y,E,S,A,I;for(h.g=0,h.f=0,o.push(h),h.opened=!0;!o.empty();){if(_=o.pop(),_.closed=!0,_===l)return gR.backtrace(l);for(x=r.getNeighbors(_,f),y=0,E=x.length;y<E;++y)T=x[y],!T.closed&&(S=T.x,A=T.y,I=_.g+(S-_.x===0||A-_.y===0?1:m),(!T.opened||I<T.g)&&(T.g=I,T.h=T.h||d*c(g(S-e),g(A-n)),T.f=T.g+T.h,T.parent=_,T.opened?o.updateItem(T):(o.push(T),T.opened=!0)))}return[]};var iu=Ag,Sg=iu;function zo(i){Sg.call(this,i);var t=this.heuristic;this.heuristic=function(e,n){return t(e,n)*1e6}}zo.prototype=new Sg;zo.prototype.constructor=zo;var mR=zo,_R=Ue,Qh=Ke;function Cg(i){i=i||{},this.allowDiagonal=i.allowDiagonal,this.dontCrossCorners=i.dontCrossCorners,this.diagonalMovement=i.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Qh.OnlyWhenNoObstacles:this.diagonalMovement=Qh.IfAtMostOneObstacle:this.diagonalMovement=Qh.Never)}Cg.prototype.findPath=function(i,t,e,n,r){var o=[],h=this.diagonalMovement,l=r.getNodeAt(i,t),c=r.getNodeAt(e,n),f,d,g,m,_;for(o.push(l),l.opened=!0;o.length;){if(g=o.shift(),g.closed=!0,g===c)return _R.backtrace(c);for(f=r.getNeighbors(g,h),m=0,_=f.length;m<_;++m)d=f[m],!(d.closed||d.opened)&&(o.push(d),d.opened=!0,d.parent=g)}return[]};var vR=Cg,Ig=iu;function $o(i){Ig.call(this,i),this.heuristic=function(t,e){return 0}}$o.prototype=new Ig;$o.prototype.constructor=$o;var xR=$o,Hd=hs.exports,Xd=Ue,tl=ls,To=Ke;function Rg(i){i=i||{},this.allowDiagonal=i.allowDiagonal,this.dontCrossCorners=i.dontCrossCorners,this.diagonalMovement=i.diagonalMovement,this.heuristic=i.heuristic||tl.manhattan,this.weight=i.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=To.OnlyWhenNoObstacles:this.diagonalMovement=To.IfAtMostOneObstacle:this.diagonalMovement=To.Never),this.diagonalMovement===To.Never?this.heuristic=i.heuristic||tl.manhattan:this.heuristic=i.heuristic||tl.octile}Rg.prototype.findPath=function(i,t,e,n,r){var o=function(V,J){return V.f-J.f},h=new Hd(o),l=new Hd(o),c=r.getNodeAt(i,t),f=r.getNodeAt(e,n),d=this.heuristic,g=this.diagonalMovement,m=this.weight,_=Math.abs,x=Math.SQRT2,T,y,E,S,A,I,D,N,L=1,F=2;for(c.g=0,c.f=0,h.push(c),c.opened=L,f.g=0,f.f=0,l.push(f),f.opened=F;!h.empty()&&!l.empty();){for(T=h.pop(),T.closed=!0,y=r.getNeighbors(T,g),S=0,A=y.length;S<A;++S)if(E=y[S],!E.closed){if(E.opened===F)return Xd.biBacktrace(T,E);I=E.x,D=E.y,N=T.g+(I-T.x===0||D-T.y===0?1:x),(!E.opened||N<E.g)&&(E.g=N,E.h=E.h||m*d(_(I-e),_(D-n)),E.f=E.g+E.h,E.parent=T,E.opened?h.updateItem(E):(h.push(E),E.opened=L))}for(T=l.pop(),T.closed=!0,y=r.getNeighbors(T,g),S=0,A=y.length;S<A;++S)if(E=y[S],!E.closed){if(E.opened===L)return Xd.biBacktrace(E,T);I=E.x,D=E.y,N=T.g+(I-T.x===0||D-T.y===0?1:x),(!E.opened||N<E.g)&&(E.g=N,E.h=E.h||m*d(_(I-i),_(D-t)),E.f=E.g+E.h,E.parent=T,E.opened?l.updateItem(E):(l.push(E),E.opened=F))}}return[]};var nu=Rg,Pg=nu;function Vo(i){Pg.call(this,i);var t=this.heuristic;this.heuristic=function(e,n){return t(e,n)*1e6}}Vo.prototype=new Pg;Vo.prototype.constructor=Vo;var yR=Vo,zd=Ue,el=Ke;function Mg(i){i=i||{},this.allowDiagonal=i.allowDiagonal,this.dontCrossCorners=i.dontCrossCorners,this.diagonalMovement=i.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=el.OnlyWhenNoObstacles:this.diagonalMovement=el.IfAtMostOneObstacle:this.diagonalMovement=el.Never)}Mg.prototype.findPath=function(i,t,e,n,r){var o=r.getNodeAt(i,t),h=r.getNodeAt(e,n),l=[],c=[],f,d,g,m=this.diagonalMovement,_=0,x=1,T,y;for(l.push(o),o.opened=!0,o.by=_,c.push(h),h.opened=!0,h.by=x;l.length&&c.length;){for(g=l.shift(),g.closed=!0,f=r.getNeighbors(g,m),T=0,y=f.length;T<y;++T)if(d=f[T],!d.closed){if(d.opened){if(d.by===x)return zd.biBacktrace(g,d);continue}l.push(d),d.parent=g,d.opened=!0,d.by=_}for(g=c.shift(),g.closed=!0,f=r.getNeighbors(g,m),T=0,y=f.length;T<y;++T)if(d=f[T],!d.closed){if(d.opened){if(d.by===_)return zd.biBacktrace(d,g);continue}c.push(d),d.parent=g,d.opened=!0,d.by=x}}return[]};var bR=Mg,Dg=nu;function Yo(i){Dg.call(this,i),this.heuristic=function(t,e){return 0}}Yo.prototype=new Dg;Yo.prototype.constructor=Yo;var wR=Yo,il=ls,$d=tu,Eo=Ke;function Bg(i){i=i||{},this.allowDiagonal=i.allowDiagonal,this.dontCrossCorners=i.dontCrossCorners,this.diagonalMovement=i.diagonalMovement,this.heuristic=i.heuristic||il.manhattan,this.weight=i.weight||1,this.trackRecursion=i.trackRecursion||!1,this.timeLimit=i.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Eo.OnlyWhenNoObstacles:this.diagonalMovement=Eo.IfAtMostOneObstacle:this.diagonalMovement=Eo.Never),this.diagonalMovement===Eo.Never?this.heuristic=i.heuristic||il.manhattan:this.heuristic=i.heuristic||il.octile}Bg.prototype.findPath=function(i,t,e,n,r){var o=new Date().getTime(),h=function(T,y){return this.heuristic(Math.abs(y.x-T.x),Math.abs(y.y-T.y))}.bind(this),l=function(T,y){return T.x===y.x||T.y===y.y?1:Math.SQRT2},c=function(T,y,E,S,A){if(this.timeLimit>0&&new Date().getTime()-o>this.timeLimit*1e3)return 1/0;var I=y+h(T,d)*this.weight;if(I>E)return I;if(T==d)return S[A]=[T.x,T.y],T;var D,N,L,F,V=r.getNeighbors(T,this.diagonalMovement);for(L=0,D=1/0;F=V[L];++L){if(this.trackRecursion&&(F.retainCount=F.retainCount+1||1,F.tested!==!0&&(F.tested=!0)),N=c(F,y+l(T,F),E,S,A+1),N instanceof $d)return S[A]=[T.x,T.y],N;this.trackRecursion&&--F.retainCount===0&&(F.tested=!1),N<D&&(D=N)}return D}.bind(this),f=r.getNodeAt(i,t),d=r.getNodeAt(e,n),g=h(f,d),m,_,x;for(m=0;;++m){if(_=[],x=c(f,0,g,_,0),x===1/0)return[];if(x instanceof $d)return _;g=x}return[]};var TR=Bg,ER=hs.exports,Vd=Ue,Fg=ls;function ru(i){i=i||{},this.heuristic=i.heuristic||Fg.manhattan,this.trackJumpRecursion=i.trackJumpRecursion||!1}ru.prototype.findPath=function(i,t,e,n,r){var o=this.openList=new ER(function(f,d){return f.f-d.f}),h=this.startNode=r.getNodeAt(i,t),l=this.endNode=r.getNodeAt(e,n),c;for(this.grid=r,h.g=0,h.f=0,o.push(h),h.opened=!0;!o.empty();){if(c=o.pop(),c.closed=!0,c===l)return Vd.expandPath(Vd.backtrace(l));this._identifySuccessors(c)}return[]};ru.prototype._identifySuccessors=function(i){var t=this.grid,e=this.heuristic,n=this.openList,r=this.endNode.x,o=this.endNode.y,h,l,c,f,d,g=i.x,m=i.y,_,x,T,y,E,S=Math.abs;for(h=this._findNeighbors(i),f=0,d=h.length;f<d;++f)if(l=h[f],c=this._jump(l[0],l[1],g,m),c){if(_=c[0],x=c[1],E=t.getNodeAt(_,x),E.closed)continue;T=Fg.octile(S(_-g),S(x-m)),y=i.g+T,(!E.opened||y<E.g)&&(E.g=y,E.h=E.h||e(S(_-r),S(x-o)),E.f=E.g+E.h,E.parent=i,E.opened?n.updateItem(E):(n.push(E),E.opened=!0))}};var sa=ru,Lg=sa,AR=Ke;function gr(i){Lg.call(this,i)}gr.prototype=new Lg;gr.prototype.constructor=gr;gr.prototype._jump=function(i,t,e,n){var r=this.grid,o=i-e,h=t-n;if(!r.isWalkableAt(i,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(i,t).tested=!0),r.getNodeAt(i,t)===this.endNode)return[i,t];if(o!==0){if(r.isWalkableAt(i,t-1)&&!r.isWalkableAt(i-o,t-1)||r.isWalkableAt(i,t+1)&&!r.isWalkableAt(i-o,t+1))return[i,t]}else if(h!==0){if(r.isWalkableAt(i-1,t)&&!r.isWalkableAt(i-1,t-h)||r.isWalkableAt(i+1,t)&&!r.isWalkableAt(i+1,t-h))return[i,t];if(this._jump(i+1,t,i,t)||this._jump(i-1,t,i,t))return[i,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(i+o,t+h,i,t)};gr.prototype._findNeighbors=function(i){var t=i.parent,e=i.x,n=i.y,r=this.grid,o,h,l,c,f=[],d,g,m,_;if(t)o=t.x,h=t.y,l=(e-o)/Math.max(Math.abs(e-o),1),c=(n-h)/Math.max(Math.abs(n-h),1),l!==0?(r.isWalkableAt(e,n-1)&&f.push([e,n-1]),r.isWalkableAt(e,n+1)&&f.push([e,n+1]),r.isWalkableAt(e+l,n)&&f.push([e+l,n])):c!==0&&(r.isWalkableAt(e-1,n)&&f.push([e-1,n]),r.isWalkableAt(e+1,n)&&f.push([e+1,n]),r.isWalkableAt(e,n+c)&&f.push([e,n+c]));else for(d=r.getNeighbors(i,AR.Never),m=0,_=d.length;m<_;++m)g=d[m],f.push([g.x,g.y]);return f};var SR=gr,Og=sa,CR=Ke;function mr(i){Og.call(this,i)}mr.prototype=new Og;mr.prototype.constructor=mr;mr.prototype._jump=function(i,t,e,n){var r=this.grid,o=i-e,h=t-n;if(!r.isWalkableAt(i,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(i,t).tested=!0),r.getNodeAt(i,t)===this.endNode)return[i,t];if(o!==0&&h!==0){if(r.isWalkableAt(i-o,t+h)&&!r.isWalkableAt(i-o,t)||r.isWalkableAt(i+o,t-h)&&!r.isWalkableAt(i,t-h))return[i,t];if(this._jump(i+o,t,i,t)||this._jump(i,t+h,i,t))return[i,t]}else if(o!==0){if(r.isWalkableAt(i+o,t+1)&&!r.isWalkableAt(i,t+1)||r.isWalkableAt(i+o,t-1)&&!r.isWalkableAt(i,t-1))return[i,t]}else if(r.isWalkableAt(i+1,t+h)&&!r.isWalkableAt(i+1,t)||r.isWalkableAt(i-1,t+h)&&!r.isWalkableAt(i-1,t))return[i,t];return this._jump(i+o,t+h,i,t)};mr.prototype._findNeighbors=function(i){var t=i.parent,e=i.x,n=i.y,r=this.grid,o,h,l,c,f=[],d,g,m,_;if(t)o=t.x,h=t.y,l=(e-o)/Math.max(Math.abs(e-o),1),c=(n-h)/Math.max(Math.abs(n-h),1),l!==0&&c!==0?(r.isWalkableAt(e,n+c)&&f.push([e,n+c]),r.isWalkableAt(e+l,n)&&f.push([e+l,n]),r.isWalkableAt(e+l,n+c)&&f.push([e+l,n+c]),r.isWalkableAt(e-l,n)||f.push([e-l,n+c]),r.isWalkableAt(e,n-c)||f.push([e+l,n-c])):l===0?(r.isWalkableAt(e,n+c)&&f.push([e,n+c]),r.isWalkableAt(e+1,n)||f.push([e+1,n+c]),r.isWalkableAt(e-1,n)||f.push([e-1,n+c])):(r.isWalkableAt(e+l,n)&&f.push([e+l,n]),r.isWalkableAt(e,n+1)||f.push([e+l,n+1]),r.isWalkableAt(e,n-1)||f.push([e+l,n-1]));else for(d=r.getNeighbors(i,CR.Always),m=0,_=d.length;m<_;++m)g=d[m],f.push([g.x,g.y]);return f};var IR=mr,Ng=sa,RR=Ke;function _r(i){Ng.call(this,i)}_r.prototype=new Ng;_r.prototype.constructor=_r;_r.prototype._jump=function(i,t,e,n){var r=this.grid,o=i-e,h=t-n;if(!r.isWalkableAt(i,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(i,t).tested=!0),r.getNodeAt(i,t)===this.endNode)return[i,t];if(o!==0&&h!==0){if(this._jump(i+o,t,i,t)||this._jump(i,t+h,i,t))return[i,t]}else if(o!==0){if(r.isWalkableAt(i,t-1)&&!r.isWalkableAt(i-o,t-1)||r.isWalkableAt(i,t+1)&&!r.isWalkableAt(i-o,t+1))return[i,t]}else if(h!==0&&(r.isWalkableAt(i-1,t)&&!r.isWalkableAt(i-1,t-h)||r.isWalkableAt(i+1,t)&&!r.isWalkableAt(i+1,t-h)))return[i,t];return r.isWalkableAt(i+o,t)&&r.isWalkableAt(i,t+h)?this._jump(i+o,t+h,i,t):null};_r.prototype._findNeighbors=function(i){var t=i.parent,e=i.x,n=i.y,r=this.grid,o,h,l,c,f=[],d,g,m,_;if(t)if(o=t.x,h=t.y,l=(e-o)/Math.max(Math.abs(e-o),1),c=(n-h)/Math.max(Math.abs(n-h),1),l!==0&&c!==0)r.isWalkableAt(e,n+c)&&f.push([e,n+c]),r.isWalkableAt(e+l,n)&&f.push([e+l,n]),r.isWalkableAt(e,n+c)&&r.isWalkableAt(e+l,n)&&f.push([e+l,n+c]);else{var x;if(l!==0){x=r.isWalkableAt(e+l,n);var T=r.isWalkableAt(e,n+1),y=r.isWalkableAt(e,n-1);x&&(f.push([e+l,n]),T&&f.push([e+l,n+1]),y&&f.push([e+l,n-1])),T&&f.push([e,n+1]),y&&f.push([e,n-1])}else if(c!==0){x=r.isWalkableAt(e,n+c);var E=r.isWalkableAt(e+1,n),S=r.isWalkableAt(e-1,n);x&&(f.push([e,n+c]),E&&f.push([e+1,n+c]),S&&f.push([e-1,n+c])),E&&f.push([e+1,n]),S&&f.push([e-1,n])}}else for(d=r.getNeighbors(i,RR.OnlyWhenNoObstacles),m=0,_=d.length;m<_;++m)g=d[m],f.push([g.x,g.y]);return f};var PR=_r,kg=sa,MR=Ke;function vr(i){kg.call(this,i)}vr.prototype=new kg;vr.prototype.constructor=vr;vr.prototype._jump=function(i,t,e,n){var r=this.grid,o=i-e,h=t-n;if(!r.isWalkableAt(i,t))return null;if(this.trackJumpRecursion===!0&&(r.getNodeAt(i,t).tested=!0),r.getNodeAt(i,t)===this.endNode)return[i,t];if(o!==0&&h!==0){if(r.isWalkableAt(i-o,t+h)&&!r.isWalkableAt(i-o,t)||r.isWalkableAt(i+o,t-h)&&!r.isWalkableAt(i,t-h))return[i,t];if(this._jump(i+o,t,i,t)||this._jump(i,t+h,i,t))return[i,t]}else if(o!==0){if(r.isWalkableAt(i+o,t+1)&&!r.isWalkableAt(i,t+1)||r.isWalkableAt(i+o,t-1)&&!r.isWalkableAt(i,t-1))return[i,t]}else if(r.isWalkableAt(i+1,t+h)&&!r.isWalkableAt(i+1,t)||r.isWalkableAt(i-1,t+h)&&!r.isWalkableAt(i-1,t))return[i,t];return r.isWalkableAt(i+o,t)||r.isWalkableAt(i,t+h)?this._jump(i+o,t+h,i,t):null};vr.prototype._findNeighbors=function(i){var t=i.parent,e=i.x,n=i.y,r=this.grid,o,h,l,c,f=[],d,g,m,_;if(t)o=t.x,h=t.y,l=(e-o)/Math.max(Math.abs(e-o),1),c=(n-h)/Math.max(Math.abs(n-h),1),l!==0&&c!==0?(r.isWalkableAt(e,n+c)&&f.push([e,n+c]),r.isWalkableAt(e+l,n)&&f.push([e+l,n]),(r.isWalkableAt(e,n+c)||r.isWalkableAt(e+l,n))&&f.push([e+l,n+c]),!r.isWalkableAt(e-l,n)&&r.isWalkableAt(e,n+c)&&f.push([e-l,n+c]),!r.isWalkableAt(e,n-c)&&r.isWalkableAt(e+l,n)&&f.push([e+l,n-c])):l===0?r.isWalkableAt(e,n+c)&&(f.push([e,n+c]),r.isWalkableAt(e+1,n)||f.push([e+1,n+c]),r.isWalkableAt(e-1,n)||f.push([e-1,n+c])):r.isWalkableAt(e+l,n)&&(f.push([e+l,n]),r.isWalkableAt(e,n+1)||f.push([e+l,n+1]),r.isWalkableAt(e,n-1)||f.push([e+l,n-1]));else for(d=r.getNeighbors(i,MR.IfAtMostOneObstacle),m=0,_=d.length;m<_;++m)g=d[m],f.push([g.x,g.y]);return f};var DR=vr,nl=Ke,BR=SR,FR=IR,LR=PR,OR=DR;function NR(i){return i=i||{},i.diagonalMovement===nl.Never?new BR(i):i.diagonalMovement===nl.Always?new FR(i):i.diagonalMovement===nl.OnlyWhenNoObstacles?new LR(i):new OR(i)}var kR=NR,UR={Heap:hs.exports,Node:tu,Grid:hR,Util:Ue,DiagonalMovement:Ke,Heuristic:ls,AStarFinder:iu,BestFirstFinder:mR,BreadthFirstFinder:vR,DijkstraFinder:xR,BiAStarFinder:nu,BiBestFirstFinder:yR,BiBreadthFirstFinder:bR,BiDijkstraFinder:wR,IDAStarFinder:TR,JumpPointFinder:kR};(function(i){i.exports=UR})(wg);const Yd=Sb(wg.exports),Ug=(i,t)=>{const{width:e,height:n}=ee().views.map,r=new Yd.Grid(e,n);return Object.keys(ee().eAP).forEach(c=>{const f=bg(c);Ie.exports.some([...ee().eAP[c]],d=>{const g=de(d);if(g)return g.components.isBlocking&&!g.components.pathThrough})&&r.setWalkableAt(f.x,f.y,!1)}),r.setWalkableAt(i.x,i.y,!0),r.setWalkableAt(t.x,t.y,!0),new Yd.AStarFinder({}).findPath(i.x,i.y,t.x,t.y,r)},GR=()=>{const i=Xi(Ai.IsPlayer),t=Xi(Ai.HasAi);let e;i.entities.forEach(n=>{const r=de(n);r&&(e=r)}),t.entities.forEach(n=>{const r=de(n);if(!(r!=null&&r.components.position)||!(e!=null&&e.components.position))return;const o=Ug(r.components.position,e.components.position);if(!o[1])return;const h={x:o[1][0],y:o[1][1],z:r.components.position.z};Ne(r.id,{tryMove:h})})},jd=()=>{const i=Xi(Ai.IsInFov),t=Xi(Ai.IsRevealed),e=Xi(Ai.IsPlayer),{map:n}=ee().views;for(const r of t.entities){const o=de(r);if(!o)return;const{char:h,tint:l}=o.components.appearance,{x:c,y:f}=o.components.position;n==null||n.updateCell({0:{char:h,tint:1,alpha:1,tileSet:"tile",x:c,y:f},1:{char:h,tint:l,alpha:.35,tileSet:"ascii",x:c,y:f}})}for(const r of i.entities){const o=de(r);if(!o)return;const{char:h,tint:l}=o.components.appearance,{x:c,y:f}=o.components.position;n==null||n.updateCell({0:{char:h,tint:1118481,alpha:1,tileSet:"tile",x:c,y:f},1:{char:h,tint:l,alpha:1,tileSet:"ascii",x:c,y:f}})}for(const r of e.entities){const o=de(r);if(!o)return;const{char:h,tint:l}=o.components.appearance,{x:c,y:f}=o.components.position;n==null||n.updateCell({1:{char:h,tint:l,alpha:1,tileSet:"ascii",x:c,y:f}}),ee().toRender.forEach(d=>{const g=bg(d);n==null||n.updateCell({1:{char:"",tint:0,alpha:0,tileSet:"ascii",x:g.x,y:g.y}})}),ui(d=>d.toRender=new Set)}},qd=()=>{Xi(Ai.IsTryingToMove).entities.forEach(t=>{var d;const e=de(t);if(!e)return;const{x:n,y:r,z:o}=e.components.tryMove,{width:h,height:l}=ee().views.map;if(n<0||r<0||n>=h||r>=l)return;const c=br(e.components.tryMove),f=ee().eAP[c];for(const g of f)if((d=de(g))!=null&&d.components.isBlocking)return;yg(t,je.TryMove),tP(e),e.components.position.x=n,e.components.position.y=r,e.components.position.z=o,us(e)})},WR=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];function HR(i,t,e,n,r){const{x:o,y:h,z:l}=n,c=new Set,f=new Set;i.entities.forEach(_=>{const x=de(_);if(x){const T=x.components.position;T.z===l&&f.add(`${T.x},${T.y},${T.z}`)}});const d=(_,x)=>{const T=`${_},${x},${l}`;return!!f.has(T)},g=(_,x)=>c.add(`${_},${x},${l}`);function m(_,x,T,y,E,S,A){let I=0;if(y<E)return;let D=!1;for(let N=T;N<A&&!D;N++){let L=-N;for(let F=-N;F<=0;F++){let V=_+F*S.xx+L*S.xy,J=x+F*S.yx+L*S.yy,$=(F-.5)/(L+.5),Q=(F+.5)/(L-.5);if(!(!(V>=0&&J>=0&&V<t&&J<e)||y<Q)){if(E>$)break;if(Math.sqrt(F*F+L*L)<=A&&g(V,J),D)if(d(V,J)){I=Q;continue}else D=!1,y=I;else d(V,J)&&N<A&&(D=!0,m(_,x,N+1,y,$,S,A),I=Q)}}}}g(o,h);for(let _ of WR)m(o,h,1,1,0,_,r);return{fov:c}}const Kd=()=>{const i=Xi(Ai.IsInFov),t=Xi(Ai.IsOpaque),e=de(ee().playerEId);if(!e){console.log("no player entity");return}const n=e.components.position;if(!n)return;const r=HR(t,74,39,n,10);i.entities.forEach(o=>{yg(o,je.IsInFov)}),r.fov.forEach(o=>{const h=ee().eAP[o];h&&h.forEach(l=>{Ne(l,{isInFov:{},isRevealed:{}})})})},oa={appearance:{char:"?",tint:3355443,tileSet:"ascii"},position:{x:0,y:0,z:0}},XR={layer100:{}},zR={layer100:{},isBlocking:{},isOpaque:{}},Gg={layer200:{},isBlocking:{}},$R={ai:{},pathThrough:{}},VR=(i,t)=>{const e=na({wId:i});return ra(e.id,[oa,XR]),e.components.appearance.char="•",t&&(Ne(e.id,{position:t}),us(e)),e},YR=(i,t)=>{const e=na({wId:i});return ra(e.id,[oa,zR]),e.components.appearance.char="#",e.components.appearance.tint=8421504,t&&(Ne(e.id,{position:t}),us(e)),e},jR=(i,t)=>{const e=na({wId:i});return ra(e.id,[oa,Gg]),Ne(e.id,{appearance:{char:"@",tint:16711816,tileSet:"ascii"},isPlayer:{}}),t&&(Ne(e.id,{position:t}),us(e)),e},qR=(i,t)=>{const e=na({wId:i});return ra(e.id,[oa,Gg,$R]),Ne(e.id,{appearance:{char:"F",tint:16711816,tileSet:"ascii"}}),t&&(Ne(e.id,{position:t}),us(e)),e};function KR(i,t){const e={},n=Math.min(i.x,t.x),r=Math.max(i.x,t.x)+1;let o=n;for(;o<r;){const h={...t,x:o};e[br(h)]={...h,sprite:"FLOOR"},o++}return e}function ZR(i,t){const e={},n=Math.min(i.y,t.y),r=Math.max(i.y,t.y)+1;let o=n;for(;o<r;){const h={...i,y:o};e[br(h)]={...h,sprite:"FLOOR"},o++}return e}const JR=i=>{const{pos:t,width:e,height:n,minRoomSize:r=6,maxRoomSize:o=12,maxRoomCount:h=30}=i,{x:l,y:c,z:f}=t,d={...Wd({x:l,y:c,z:f,width:e,height:n,hasWalls:!1},{sprite:"WALL"}),rooms:[]};let g={};Ie.exports.times(h,()=>{let x=Ie.exports.random(r,o),T=Ie.exports.random(r,o),y=Ie.exports.random(l,e+l-x-1),E=Ie.exports.random(c,n+c-T-1);const S=Wd({x:y,y:E,z:f,width:x,height:T,hasWalls:!0},{sprite:"FLOOR"});d.rooms.some(A=>nR(A,S))||(d.rooms.push(S),g={...g,...S.tiles})});let m=null,_={};for(let x of d.rooms)m&&(_={..._,...KR(x.center,m.center),...ZR(x.center,m.center)}),m=x;return d.tiles={...d.tiles,...g,..._},d},QR=()=>{const i=JR({pos:{x:0,y:0,z:0},width:74,height:39,minRoomSize:8,maxRoomSize:18,maxRoomCount:100}),t=Object.values(i.tiles);for(const e of t)e.sprite==="WALL"&&YR(ee().wId,e),e.sprite==="FLOOR"&&VR(ee().wId,e);return i};window.skulltooth=window.skulltooth||{};window.skulltooth.getEngine=()=>iR();window.skulltooth.debug=!1;const _e={eAP:{},fps:0,toRender:new Set,turn:"WORLD",userInput:null,views:{},wId:"",playerEId:"",z:0};window.skulltooth.state=_e;const ui=i=>{i(_e)},ee=()=>_e,us=i=>{if(i.components.position){const t=br(i.components.position);_e.eAP[t]||(_e.eAP[t]=new Set),_e.eAP[t].add(i.id)}return _e},tP=i=>{if(i.components.position){const t=br(i.components.position);_e.eAP[t]&&_e.eAP[t].delete(i.id)}return _e},eP=async()=>{await VI(document.querySelector("#canvas"));const i=eR();ui(c=>{c.wId=i.id}),rR();const t=QR(),e=t.rooms[0].center,n=jR(ee().wId,e);ui(c=>{c.playerEId=n.id}),t.rooms.forEach((c,f)=>{f&&qR(ee().wId,c.center)}),new yo({width:12,height:2,x:0,y:0,layers:2,tileSets:["tile","text"],tints:[16777215,16711799],alphas:[1,1]}).updateRows([[{},{string:" skulltooth"}],[{tint:16711799},{string:"forcecrusher",tint:16777215}]]);const r=new yo({width:74,height:39,x:13,y:3,layers:3,tileSets:["tile","ascii","tile"],tints:[0,0,0],alphas:[1,1,0]}),o=new yo({width:12,height:1,x:0,y:42,layers:1,tileSets:["text"],tints:[14540253],alphas:[1]}).updateRows([[{string:"FPS: calc..."}]]);new yo({width:12,height:1,x:0,y:43,layers:1,tileSets:["text"],tints:[16777215],alphas:[1]}).updateRows([[{string:"TAG: db42bce"}]]),ui(c=>{c.views.fps=o,c.views.map=r});const h=t.rooms[0].center,l=t.rooms[1].center;Ug(h,l),Wg(),document.addEventListener("keydown",c=>{ui(f=>{f.userInput=c})}),document.addEventListener("mousedown",c=>{const f=c.x-_e.views.map.layers[0].x,d=c.layerY-_e.views.map.layers[0].y,g=_e.z,m=$I(f,d,g);_e.eAP[m]&&window.skulltooth.debug===!0&&_e.eAP[m].forEach(_=>{console.log(de(_))})})};let rl=0,Ao=Date.now(),So=[];function Wg(){var i;requestAnimationFrame(Wg),ee().userInput&&ee().turn==="PLAYER"&&(sR(),qd(),Kd(),jd(),ui(t=>{t.turn="WORLD"})),ee().turn==="WORLD"&&(GR(),qd(),Kd(),jd(),ui(t=>{t.turn="PLAYER"})),Ao||(Ao=Date.now()),Date.now()-Ao>1e3&&(So.unshift(rl),So.length>3&&So.pop(),isNaN(ee().fps)||(i=ee().views.fps)==null||i.updateRow({string:`FPS: ${ee().fps}     `,layer:0,x:0,y:0,tileSet:"text"}),Ao=Date.now(),rl=0),ui(t=>t.fps=Math.round(Ie.exports.mean(So))),rl++}eP();
